var wysihtml5,Base,Handlebars;Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&function(){var n=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return n.get.call(this)},set:function(t){return n.set.call(this,t)}})}();Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"});
/**
 * @license wysihtml5x v0.4.15
 * https://github.com/Edicy/wysihtml5
 *
 * Author: Christopher Blum (https://github.com/tiff)
 * Secondary author of extended features: Oliver Pulges (https://github.com/pulges)
 *
 * Copyright (C) 2012 XING AG
 * Licensed under the MIT license (MIT)
 *
 */
wysihtml5={version:"0.4.15",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"﻿",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46},function(n,t){typeof define=="function"&&define.amd?define(n):t.rangy=n()}(function(){function t(n,t){var i=typeof n[t];return i==ut||!!(i==b&&n[t])||i=="unknown"}function f(n,t){return!!(typeof n[t]==b&&n[t])}function k(n,t){return typeof n[t]!=u}function c(n){return function(t,i){for(var r=i.length;r--;)if(!n(t,i[r]))return!1;return!0}}function d(n){return n&&l(n,st)&&a(n,ot)}function g(n){return f(n,"body")?n.body:n.getElementsByTagName("body")[0]}function v(n){f(window,"console")&&t(window.console,"log")&&window.console.log(n)}function nt(n,t){t?window.alert(n):v(n)}function i(t){n.initialized=!0;n.supported=!1;nt("Rangy is not supported on this page in your browser. Reason: "+t,n.config.alertOnFail)}function ct(t){nt("Rangy warning: "+t,n.config.alertOnWarn)}function tt(n){return n.message||n.description||String(n)}function y(){var f,e,s,u,y,p,w,c,b;if(!n.initialized){if(e=!1,s=!1,t(document,"createRange")&&(f=document.createRange(),l(f,et)&&a(f,ft)&&(e=!0)),u=g(document),!u||u.nodeName.toLowerCase()!="body"){i("No body element found");return}if(u&&t(u,"createTextRange")&&(f=u.createTextRange(),d(f)&&(s=!0)),!e&&!s){i("Neither Range nor TextRange are available");return}n.initialized=!0;n.features={implementsDomRange:e,implementsTextRange:s};for(w in r)(y=r[w])instanceof h&&y.init(y,n);for(c=0,b=o.length;c<b;++c)try{o[c](n)}catch(k){p="Rangy init listener threw an exception. Continuing. Detail: "+tt(k);v(p)}}}function lt(n){n=n||window;y();for(var t=0,i=s.length;t<i;++t)s[t](n)}function h(n,t,i){this.name=n;this.dependencies=t;this.initialized=!1;this.supported=!1;this.initializer=i}function it(t,i,u,f){var e=new h(i,u,function(t){if(!t.initialized){t.initialized=!0;try{f(n,t);t.supported=!0}catch(r){var u="Module '"+i+"' failed to load: "+tt(r);v(u)}}});r[i]=e}function rt(){}function at(){}var b="object",ut="function",u="undefined",ft=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],et=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],ot=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],st=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],l=c(t),ht=c(f),a=c(k),r={},n={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:f,isHostProperty:k,areHostMethods:l,areHostObjects:ht,areHostProperties:a,isTextRange:d,getBody:g},features:{},modules:r,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==u?!0:rangyAutoInitialize}},e,o,s,p,w;if(n.fail=i,n.warn=ct,{}.hasOwnProperty?n.util.extend=function(t,i,r){var f,u;for(var e in i)i.hasOwnProperty(e)&&(f=t[e],u=i[e],r&&f!==null&&typeof f=="object"&&u!==null&&typeof u=="object"&&n.util.extend(f,u,!0),t[e]=u);return i.hasOwnProperty("toString")&&(t.toString=i.toString),t}:i("hasOwnProperty not supported"),function(){var r=document.createElement("div"),i,t;r.appendChild(document.createElement("span"));i=[].slice;try{i.call(r.childNodes,0)[0].nodeType==1&&(t=function(n){return i.call(n,0)})}catch(u){}t||(t=function(n){for(var i=[],t=0,r=n.length;t<r;++t)i[t]=n[t];return i});n.util.toArray=t}(),t(document,"addEventListener")?e=function(n,t,i){n.addEventListener(t,i,!1)}:t(document,"attachEvent")?e=function(n,t,i){n.attachEvent("on"+t,i)}:i("Document does not have required addEventListener or attachEvent method"),n.util.addListener=e,o=[],n.init=y,n.addInitListener=function(t){n.initialized?t(n):o.push(t)},s=[],n.addShimListener=function(n){s.push(n)},n.shim=n.createMissingNativeApi=lt,h.prototype={init:function(){for(var u=this.dependencies||[],i=0,f=u.length,n,t;i<f;++i){if(t=u[i],n=r[t],!n||!(n instanceof h))throw new Error("required module '"+t+"' not found");if(n.init(),!n.supported)throw new Error("required module '"+t+"' not supported");}this.initializer(this)},fail:function(n){this.initialized=!0;this.supported=!1;throw new Error("Module '"+this.name+"' failed to load: "+n);},warn:function(t){n.warn("Module "+this.name+": "+t)},deprecationNotice:function(t,i){n.warn("DEPRECATED: "+t+" in module "+this.name+"is deprecated. Please use "+i+" instead")},createError:function(n){return new Error("Error in Rangy "+this.name+" module: "+n)}},n.createModule=function(t){var i,r,u;arguments.length==2?(i=arguments[1],r=[]):(i=arguments[2],r=arguments[1]);u=it(!1,t,r,i);n.initialized&&u.init()},n.createCoreModule=function(n,t,i){it(!0,n,t,i)},n.RangePrototype=rt,n.rangePrototype=new rt,n.selectionPrototype=new at,p=!1,w=function(){p||(p=!0,!n.initialized&&n.config.autoInitialize&&y())},typeof window==u){i("No window found");return}if(typeof document==u){i("No document found");return}return t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",w,!1),e(window,"load",w),n.createCoreModule("DomUtil",[],function(n,t){function rt(n){var t;return typeof n.namespaceURI==r||(t=n.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function ut(n){var t=n.parentNode;return t.nodeType==1?t:null}function f(n){for(var t=0;n=n.previousSibling;)++t;return t}function ft(n){switch(n.nodeType){case 7:case 10:return 0;case 3:case 8:return n.length;default:return n.childNodes.length}}function y(n,t){for(var r=[],i=n;i;i=i.parentNode)r.push(i);for(i=t;i;i=i.parentNode)if(c(r,i))return i;return null}function p(n,t,i){for(var r=i?t:t.parentNode;r;){if(r===n)return!0;r=r.parentNode}return!1}function et(n,t){return p(n,t,!0)}function e(n,t,i){for(var u,r=i?n:n.parentNode;r;){if(u=r.parentNode,u===t)return r;r=u}return null}function w(n){var t=n.nodeType;return t==3||t==4||t==8}function ot(n){if(!n)return!1;var t=n.nodeType;return t==3||t==8}function b(n,t){var i=t.nextSibling,r=t.parentNode;return i?r.insertBefore(n,i):r.appendChild(n),n}function st(n,t,i){var u=n.cloneNode(!1),e,r;if(u.deleteData(0,t),n.deleteData(t,n.length-t),b(u,n),i)for(e=0;r=i[e++];)r.node==n&&r.offset>t?(r.node=u,r.offset-=t):r.node==n.parentNode&&r.offset>f(n)&&++r.offset;return u}function o(n){if(n.nodeType==9)return n;if(typeof n.ownerDocument!=r)return n.ownerDocument;if(typeof n.document!=r)return n.document;if(n.parentNode)return o(n.parentNode);throw t.createError("getDocument: no document found for node");}function k(n){var i=o(n);if(typeof i.defaultView!=r)return i.defaultView;if(typeof i.parentWindow!=r)return i.parentWindow;throw t.createError("Cannot get a window object for node");}function d(n){if(typeof n.contentDocument!=r)return n.contentDocument;if(typeof n.contentWindow!=r)return n.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element");}function ht(n){if(typeof n.contentWindow!=r)return n.contentWindow;if(typeof n.contentDocument!=r)return n.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element");}function g(n){return n&&i.isHostMethod(n,"setTimeout")&&i.isHostObject(n,"document")}function ct(n,t,r){var u;if(n?i.isHostProperty(n,"nodeType")?u=n.nodeType==1&&n.tagName.toLowerCase()=="iframe"?d(n):o(n):g(n)&&(u=n.document):u=document,!u)throw t.createError(r+"(): Parameter must be a Window object or DOM node");return u}function lt(n){for(var t;t=n.parentNode;)n=t;return n}function at(n,i,r,u){var h,o,c,l,s;if(n==r)return i===u?0:i<u?-1:1;if(h=e(r,n,!0))return i<=f(h)?-1:1;if(h=e(n,r,!0))return f(h)<u?-1:1;if(o=y(n,r),!o)throw new Error("comparePoints error: nodes have no common ancestor");if(c=n===o?o:e(n,o,!0),l=r===o?o:e(r,o,!0),c===l)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");else for(s=o.firstChild;s;){if(s===c)return-1;if(s===l)return 1;s=s.nextSibling}}function l(n){var t;try{return t=n.parentNode,!1}catch(i){return!0}}function nt(n){if(!n)return"[No node]";if(s&&l(n))return"[Broken node]";if(w(n))return'"'+n.data+'"';if(n.nodeType==1){var t=n.id?' id="'+n.id+'"':"";return"<"+n.nodeName+t+">[index:"+f(n)+",length:"+n.childNodes.length+"]["+(n.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return n.nodeName}function vt(n){for(var t=o(n).createDocumentFragment(),i;i=n.firstChild;)t.appendChild(i);return t}function tt(n){this.root=n;this._next=n}function yt(n){return new tt(n)}function it(n,t){this.node=n;this.offset=t}function v(n){this.code=this[n];this.codeName=n;this.message="DOMException: "+this.codeName}var r="undefined",i=n.util,u,h,c,s,a;i.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method");i.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");u=document.createElement("div");i.areHostMethods(u,["insertBefore","appendChild","cloneNode"]||!i.areHostObjects(u,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation");i.isHostProperty(u,"innerHTML")||t.fail("Element is missing innerHTML property");h=document.createTextNode("test");i.areHostMethods(h,["splitText","deleteData","insertData","appendData","cloneNode"]||!i.areHostObjects(u,["previousSibling","nextSibling","childNodes","parentNode"])||!i.areHostProperties(h,["data"]))||t.fail("Incomplete Text Node implementation");c=function(n,t){for(var i=n.length;i--;)if(n[i]===t)return!0;return!1};s=!1,function(){var t=document.createElement("b"),i;t.innerHTML="1";i=t.firstChild;t.innerHTML="<br>";s=l(i);n.features.crashyTextNodes=s}();typeof getComputedStyle!=r?a=function(n,t){return k(n).getComputedStyle(n,null)[t]}:typeof document.documentElement.currentStyle!=r?a=function(n,t){return n.currentStyle[t]}:t.fail("No means of obtaining computed style properties found");tt.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next,t,i;if(this._current)if(t=n.firstChild,t)this._next=t;else{for(i=null;n!==this.root&&!(i=n.nextSibling);)n=n.parentNode;this._next=i}return this._current},detach:function(){this._current=this._next=this.root=null}};it.prototype={equals:function(n){return!!n&&this.node===n.node&&this.offset==n.offset},inspect:function(){return"[DomPosition("+nt(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};v.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};v.prototype.toString=function(){return this.message};n.dom={arrayContains:c,isHtmlNamespace:rt,parentElement:ut,getNodeIndex:f,getNodeLength:ft,getCommonAncestor:y,isAncestorOf:p,isOrIsAncestorOf:et,getClosestAncestorIn:e,isCharacterDataNode:w,isTextOrCommentNode:ot,insertAfter:b,splitDataNode:st,getDocument:o,getWindow:k,getIframeWindow:ht,getIframeDocument:d,getBody:i.getBody,isWindow:g,getContentDocument:ct,getRootContainer:lt,comparePoints:at,isBrokenNode:l,inspectNode:nt,getComputedStyleProperty:a,fragmentFromNodeChildren:vt,createIterator:yt,DomPosition:it};n.DOMException=v}),n.createCoreModule("DomRange",["DomUtil"],function(n){function v(n,t){return n.nodeType!=3&&(l(n,t.startContainer)||l(n,t.endContainer))}function e(n){return n.document||w(n.startContainer)}function yt(n){return new vt(n.parentNode,s(n))}function ut(n){return new vt(n.parentNode,s(n)+1)}function pt(n,r,u){var f=n.nodeType==11?n.firstChild:n;return i(r)?u==r.length?t.insertAfter(n,r):r.parentNode.insertBefore(n,u==0?r:nt(r,u)):u>=r.childNodes.length?r.appendChild(n):r.insertBefore(n,r.childNodes[u]),f}function wt(n,t,i){if(r(n),r(t),e(t)!=e(n))throw new f("WRONG_DOCUMENT_ERR");var o=u(n.startContainer,n.startOffset,t.endContainer,t.endOffset),s=u(n.endContainer,n.endOffset,t.startContainer,t.startOffset);return i?o<=0&&s>=0:o<0&&s>0}function bt(n){for(var i,t,u=e(n.range).createDocumentFragment(),r;t=n.next();){if(i=n.isPartiallySelectedSubtree(),t=t.cloneNode(!i),i&&(r=n.getSubtreeIterator(),t.appendChild(bt(r)),r.detach()),t.nodeType==10)throw new f("HIERARCHY_REQUEST_ERR");u.appendChild(t)}return u}function b(n,i,r){var e,o,u,f;for(r=r||{stop:!1};u=n.next();)if(n.isPartiallySelectedSubtree()){if(i(u)===!1){r.stop=!0;return}if(f=n.getSubtreeIterator(),b(f,i,r),f.detach(),r.stop)return}else for(e=t.createIterator(u);o=e.next();)if(i(o)===!1){r.stop=!0;return}}function kt(n){for(var t;n.next();)n.isPartiallySelectedSubtree()?(t=n.getSubtreeIterator(),kt(t),t.detach()):n.remove()}function dt(n){for(var t,r=e(n.range).createDocumentFragment(),i;t=n.next();){if(n.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=n.getSubtreeIterator(),t.appendChild(dt(i)),i.detach()):n.remove(),t.nodeType==10)throw new f("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function gi(n,t,r){var f=!!(t&&t.length),e,s=!!r,u;return f&&(e=new RegExp("^("+t.join("|")+")$")),u=[],b(new o(n,!1),function(t){var o,h;(!f||e.test(t.nodeType))&&(!s||r(t))&&((o=n.startContainer,t==o&&i(o)&&n.startOffset==o.length)||(h=n.endContainer,t==h&&i(h)&&n.endOffset==0)||u.push(t))}),u}function gt(n){var i=typeof n.getName=="undefined"?"Range":n.getName();return"["+i+"("+t.inspectNode(n.startContainer)+":"+n.startOffset+", "+t.inspectNode(n.endContainer)+":"+n.endOffset+")]"}function o(n,t){if(this.range=n,this.clonePartiallySelectedTextNodes=t,!n.collapsed){this.sc=n.startContainer;this.so=n.startOffset;this.ec=n.endContainer;this.eo=n.endOffset;var r=n.commonAncestorContainer;this.sc===this.ec&&i(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!i(this.sc)?this.sc.childNodes[this.so]:tt(this.sc,r,!0),this._last=this.ec===r&&!i(this.ec)?this.ec.childNodes[this.eo-1]:tt(this.ec,r,!0))}}function ft(n){return function(t,i){for(var u,r=i?t:t.parentNode;r;){if(u=r.nodeType,rt(n,u))return r;r=r.parentNode}return null}}function y(n,t){if(rr(n,t))throw new f("INVALID_NODE_TYPE_ERR");}function p(n,t){if(!rt(t,n.nodeType))throw new f("INVALID_NODE_TYPE_ERR");}function ot(n,t){if(t<0||t>(i(n)?n.length:n.childNodes.length))throw new f("INDEX_SIZE_ERR");}function st(n,t){if(et(n,!0)!==et(t,!0))throw new f("WRONG_DOCUMENT_ERR");}function h(n){if(ir(n,!0))throw new f("NO_MODIFICATION_ALLOWED_ERR");}function k(n,t){if(!n)throw new f(t);}function ii(n){return di&&t.isBrokenNode(n)||!rt(ti,n.nodeType)&&!et(n,!0)}function ri(n,t){return t<=(i(n)?n.length:n.childNodes.length)}function ui(n){return!!n.startContainer&&!!n.endContainer&&!ii(n.startContainer)&&!ii(n.endContainer)&&ri(n.startContainer,n.startOffset)&&ri(n.endContainer,n.endOffset)}function r(n){if(!ui(n))throw new Error("Range error: Range is no longer valid after DOM mutation ("+n.inspect()+")");}function ei(n,t){r(n);var u=n.startContainer,o=n.startOffset,f=n.endContainer,e=n.endOffset,h=u===f;i(f)&&e>0&&e<f.length&&nt(f,e,t);i(u)&&o>0&&o<u.length&&(u=nt(u,o,t),h?(e-=o,f=u):f==u.parentNode&&e>=s(u)&&e++,o=0);n.setStartAndEnd(u,o,f,e)}function oi(n){r(n);var t=n.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(n.cloneContents()),t.innerHTML}function vi(n){n.START_TO_START=lt;n.START_TO_END=si;n.END_TO_END=ur;n.END_TO_START=hi;n.NODE_BEFORE=ci;n.NODE_AFTER=li;n.NODE_BEFORE_AND_AFTER=ai;n.NODE_INSIDE=at}function yi(n){vi(n);vi(n.prototype)}function pi(n,t){return function(){var l;r(this);var i=this.startContainer,f=this.startOffset,s=this.commonAncestorContainer,u=new o(this,!0),c,e;return i!==s&&(c=tt(i,s,!0),e=ut(c),i=e.node,f=e.offset),b(u,h),u.reset(),l=n(u),u.detach(),t(this,i,f,i,f),l}}function wi(t,f){function e(n,t){return function(i){p(i,ni);p(a(i),ti);var r=(n?yt:ut)(i);(t?c:l)(this,r.node,r.offset)}}function c(n,t,i){var r=n.endContainer,e=n.endOffset;(t!==n.startContainer||i!==n.startOffset)&&((a(t)!=a(r)||u(t,i,r,e)==1)&&(r=t,e=i),f(n,t,i,r,e))}function l(n,t,i){var r=n.startContainer,e=n.startOffset;(t!==n.endContainer||i!==n.endOffset)&&((a(t)!=a(r)||u(t,i,r,e)==-1)&&(r=t,e=i),f(n,r,e,t,i))}var w=function(){};w.prototype=n.rangePrototype;t.prototype=new w;g.extend(t.prototype,{setStart:function(n,t){y(n,!0);ot(n,t);c(this,n,t)},setEnd:function(n,t){y(n,!0);ot(n,t);l(this,n,t)},setStartAndEnd:function(){var n=arguments,i=n[0],r=n[1],u=i,t=r;switch(n.length){case 3:t=n[2];break;case 4:u=n[2];t=n[3]}f(this,i,r,u,t)},setBoundary:function(n,t,i){this["set"+(i?"Start":"End")](n,t)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(n){r(this);n?f(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):f(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(n){y(n,!0);f(this,n,0,n,it(n))},selectNode:function(n){y(n,!1);p(n,ni);var t=yt(n),i=ut(n);f(this,t.node,t.offset,i.node,i.offset)},extractContents:pi(dt,f),deleteContents:pi(kt,f),canSurroundContents:function(){r(this);h(this.startContainer);h(this.endContainer);var n=new o(this,!0),t=n._first&&v(n._first,this)||n._last&&v(n._last,this);return n.detach(),!t},splitBoundaries:function(){ei(this)},splitBoundariesPreservingPositions:function(n){ei(this,n)},normalizeBoundaries:function(){var o,h;r(this);var u=this.startContainer,e=this.startOffset,n=this.endContainer,t=this.endOffset,c=function(i){var r=i.nextSibling;r&&r.nodeType==i.nodeType&&(n=i,t=i.length,i.appendData(r.data),r.parentNode.removeChild(r))},l=function(i){var r=i.previousSibling,o,f;r&&r.nodeType==i.nodeType&&(u=i,o=i.length,e=r.length,i.insertData(0,r.data),r.parentNode.removeChild(r),u==n?(t+=e,n=u):n==i.parentNode&&(f=s(i),t==f?(n=i,t=o):t>f&&t--))},a=!0;i(n)?n.length==t&&c(n):(t>0&&(o=n.childNodes[t-1],o&&i(o)&&c(o)),a=!this.collapsed);a?i(u)?e==0&&l(u):e<u.childNodes.length&&(h=u.childNodes[e],h&&i(h)&&l(h)):(u=n,e=t);f(this,u,e,n,t)},collapseToPoint:function(n,t){y(n,!0);ot(n,t);this.setStartAndEnd(n,t)}});yi(t)}function bi(n){n.collapsed=n.startContainer===n.endContainer&&n.startOffset===n.endOffset;n.commonAncestorContainer=n.collapsed?n.startContainer:t.getCommonAncestor(n.startContainer,n.endContainer)}function ki(n,i,r,u,f){n.startContainer=i;n.startOffset=r;n.endContainer=u;n.endOffset=f;n.document=t.getDocument(i);bi(n)}function c(n){this.startContainer=n;this.startOffset=0;this.endContainer=n;this.endOffset=0;this.document=n;bi(this)}var t=n.dom,g=n.util,vt=t.DomPosition,f=n.DOMException,i=t.isCharacterDataNode,s=t.getNodeIndex,l=t.isOrIsAncestorOf,w=t.getDocument,u=t.comparePoints,nt=t.splitDataNode,tt=t.getClosestAncestorIn,it=t.getNodeLength,rt=t.arrayContains,a=t.getRootContainer,di=n.features.crashyTextNodes,ht,d,fi;o.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next;return n&&(this._next=n!==this._last?n.nextSibling:null,i(n)&&this.clonePartiallySelectedTextNodes&&(n===this.ec&&(n=n.cloneNode(!0)).deleteData(this.eo,n.length-this.eo),this._current===this.sc&&(n=n.cloneNode(!0)).deleteData(0,this.so))),n},remove:function(){var n=this._current,t,r;i(n)&&(n===this.sc||n===this.ec)?(t=n===this.sc?this.so:0,r=n===this.ec?this.eo:n.length,t!=r&&n.deleteData(t,r-t)):n.parentNode&&n.parentNode.removeChild(n)},isPartiallySelectedSubtree:function(){var n=this._current;return v(n,this.range)},getSubtreeIterator:function(){var n;if(this.isSingleCharacterDataNode)n=this.range.cloneRange(),n.collapse(!1);else{n=new c(e(this.range));var t=this._current,i=t,r=0,u=t,f=it(t);l(t,this.sc)&&(i=this.sc,r=this.so);l(t,this.ec)&&(u=this.ec,f=this.eo);ki(n,i,r,u,f)}return new o(n,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var ni=[1,3,4,5,7,8,10],ti=[2,9,11],nr=[1,3,4,5,7,8,10,11],tr=[1,3,4,5,7,8];var et=ft([9,11]),ir=ft([5,6,10,12]),rr=ft([6,10,12]);ht=document.createElement("style");d=!1;try{ht.innerHTML="<b>x<\/b>";d=ht.firstChild.nodeType==3}catch(fr){}n.features.htmlParsingConforms=d;fi=d?function(n){var u=this.startContainer,e=w(u),r;if(!u)throw new f("INVALID_STATE_ERR");return r=null,u.nodeType==1?r=u:i(u)&&(r=t.parentElement(u)),r=r===null||r.nodeName=="HTML"&&t.isHtmlNamespace(w(r).documentElement)&&t.isHtmlNamespace(r)?e.createElement("body"):r.cloneNode(!1),r.innerHTML=n,t.fragmentFromNodeChildren(r)}:function(n){var r=e(this),i=r.createElement("body");return i.innerHTML=n,t.fragmentFromNodeChildren(i)};var ct=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],lt=0,si=1,ur=2,hi=3,ci=0,li=1,ai=2,at=3;g.extend(n.rangePrototype,{compareBoundaryPoints:function(n,t){r(this);st(this.startContainer,t.startContainer);var i,f,e,o,s=n==hi||n==lt?"start":"end",h=n==si||n==lt?"start":"end";return i=this[s+"Container"],f=this[s+"Offset"],e=t[h+"Container"],o=t[h+"Offset"],u(i,f,e,o)},insertNode:function(n){if(r(this),p(n,nr),h(this.startContainer),l(n,this.startContainer))throw new f("HIERARCHY_REQUEST_ERR");var t=pt(n,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var n,t,u;return r(this),this.collapsed?e(this).createDocumentFragment():this.startContainer===this.endContainer&&i(this.startContainer)?(n=this.startContainer.cloneNode(!0),n.data=n.data.slice(this.startOffset,this.endOffset),t=e(this).createDocumentFragment(),t.appendChild(n),t):(u=new o(this,!0),n=bt(u),u.detach(),n)},canSurroundContents:function(){r(this);h(this.startContainer);h(this.endContainer);var n=new o(this,!0),t=n._first&&v(n._first,this)||n._last&&v(n._last,this);return n.detach(),!t},surroundContents:function(n){if(p(n,tr),!this.canSurroundContents())throw new f("INVALID_STATE_ERR");var t=this.extractContents();if(n.hasChildNodes())while(n.lastChild)n.removeChild(n.lastChild);pt(n,this.startContainer,this.startOffset);n.appendChild(t);this.selectNode(n)},cloneRange:function(){r(this);for(var t=new c(e(this)),i=ct.length,n;i--;)n=ct[i],t[n]=this[n];return t},toString:function(){var n,t,u;return r(this),n=this.startContainer,n===this.endContainer&&i(n)?n.nodeType==3||n.nodeType==4?n.data.slice(this.startOffset,this.endOffset):"":(t=[],u=new o(this,!0),b(u,function(n){(n.nodeType==3||n.nodeType==4)&&t.push(n.data)}),u.detach(),t.join(""))},compareNode:function(n){var t,i,e,u;if(r(this),t=n.parentNode,i=s(n),!t)throw new f("NOT_FOUND_ERR");return e=this.comparePoint(t,i),u=this.comparePoint(t,i+1),e<0?u>0?ai:ci:u>0?li:at},comparePoint:function(n,t){return(r(this),k(n,"HIERARCHY_REQUEST_ERR"),st(n,this.startContainer),u(n,t,this.startContainer,this.startOffset)<0)?-1:u(n,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:fi,toHtml:function(){return oi(this)},intersectsNode:function(n,t){var i,f,o,h;return(r(this),k(n,"NOT_FOUND_ERR"),w(n)!==e(this))?!1:(i=n.parentNode,f=s(n),k(i,"NOT_FOUND_ERR"),o=u(i,f,this.endContainer,this.endOffset),h=u(i,f+1,this.startContainer,this.startOffset),t?o<=0&&h>=0:o<0&&h>0)},isPointInRange:function(n,t){return r(this),k(n,"HIERARCHY_REQUEST_ERR"),st(n,this.startContainer),u(n,t,this.startContainer,this.startOffset)>=0&&u(n,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(n){return wt(this,n,!1)},intersectsOrTouchesRange:function(n){return wt(this,n,!0)},intersection:function(n){if(this.intersectsRange(n)){var i=u(this.startContainer,this.startOffset,n.startContainer,n.startOffset),r=u(this.endContainer,this.endOffset,n.endContainer,n.endOffset),t=this.cloneRange();return i==-1&&t.setStart(n.startContainer,n.startOffset),r==1&&t.setEnd(n.endContainer,n.endOffset),t}return null},union:function(n){if(this.intersectsOrTouchesRange(n)){var t=this.cloneRange();return u(n.startContainer,n.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(n.startContainer,n.startOffset),u(n.endContainer,n.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(n.endContainer,n.endOffset),t}throw new f("Ranges do not intersect");},containsNode:function(n,t){return t?this.intersectsNode(n,!1):this.compareNode(n)==at},containsNodeContents:function(n){return this.comparePoint(n,0)>=0&&this.comparePoint(n,it(n))<=0},containsRange:function(n){var t=this.intersection(n);return t!==null&&n.equals(t)},containsNodeText:function(n){var t=this.cloneRange(),i,r;return t.selectNode(n),i=t.getNodes([3]),i.length>0?(t.setStart(i[0],0),r=i.pop(),t.setEnd(r,r.length),this.containsRange(t)):this.containsNodeContents(n)},getNodes:function(n,t){return r(this),gi(this,n,t)},getDocument:function(){return e(this)},collapseBefore:function(n){this.setEndBefore(n);this.collapse(!1)},collapseAfter:function(n){this.setStartAfter(n);this.collapse(!0)},getBookmark:function(i){var o=e(this),r=n.createRange(o);i=i||t.getBody(o);r.selectNodeContents(i);var u=this.intersection(r),f=0,s=0;return u&&(r.setEnd(u.startContainer,u.startOffset),f=r.toString().length,s=f+u.toString().length),{start:f,end:s,containerNode:i}},moveToBookmark:function(n){var o=n.containerNode,t=0;this.setStart(o,0);this.collapse(!0);for(var s=[o],i,u=!1,h=!1,r,f,e;!h&&(i=s.pop());)if(i.nodeType==3)r=t+i.length,!u&&n.start>=t&&n.start<=r&&(this.setStart(i,n.start-t),u=!0),u&&n.end>=t&&n.end<=r&&(this.setEnd(i,n.end-t),h=!0),t=r;else for(e=i.childNodes,f=e.length;f--;)s.push(e[f])},getName:function(){return"DomRange"},equals:function(n){return c.rangesEqual(this,n)},isValid:function(){return ui(this)},inspect:function(){return gt(this)},detach:function(){}});wi(c,ki);g.extend(c,{rangeProperties:ct,RangeIterator:o,copyComparisonConstants:yi,createPrototypeRange:wi,inspect:gt,toHtml:oi,getRangeDocument:e,rangesEqual:function(n,t){return n.startContainer===t.startContainer&&n.startOffset===t.startOffset&&n.endContainer===t.endContainer&&n.endOffset===t.endOffset}});n.DomRange=c}),n.createCoreModule("WrappedRange",["DomRange"],function(n,t){var o,r,i=n.dom,y=n.util,u=i.DomPosition,f=n.DomRange,e=i.getBody,s=i.getContentDocument,h=i.isCharacterDataNode,a,v;if(n.features.implementsDomRange&&function(){function h(n){for(var i=b.length,t;i--;)t=b[i],n[t]=n.nativeRange[t];n.collapsed=n.startContainer===n.endContainer&&n.startOffset===n.endOffset}function k(n,t,i,r,u){var f=n.startContainer!==t||n.startOffset!=i,e=n.endContainer!==r||n.endOffset!=u,o=!n.equals(n.nativeRange);(f||e||o)&&(n.setEnd(r,u),n.setStart(t,i))}var r,b=f.rangeProperties,l,c,u,a,v,p,w;o=function(n){if(!n)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=n;h(this)};f.createPrototypeRange(o,k);r=o.prototype;r.selectNode=function(n){this.nativeRange.selectNode(n);h(this)};r.cloneContents=function(){return this.nativeRange.cloneContents()};r.surroundContents=function(n){this.nativeRange.surroundContents(n);h(this)};r.collapse=function(n){this.nativeRange.collapse(n);h(this)};r.cloneRange=function(){return new o(this.nativeRange.cloneRange())};r.refresh=function(){h(this)};r.toString=function(){return this.nativeRange.toString()};c=document.createTextNode("test");e(document).appendChild(c);u=document.createRange();u.setStart(c,0);u.setEnd(c,0);try{u.setStart(c,1);r.setStart=function(n,t){this.nativeRange.setStart(n,t);h(this)};r.setEnd=function(n,t){this.nativeRange.setEnd(n,t);h(this)};l=function(n){return function(t){this.nativeRange[n](t);h(this)}}}catch(d){r.setStart=function(n,t){try{this.nativeRange.setStart(n,t)}catch(i){this.nativeRange.setEnd(n,t);this.nativeRange.setStart(n,t)}h(this)};r.setEnd=function(n,t){try{this.nativeRange.setEnd(n,t)}catch(i){this.nativeRange.setStart(n,t);this.nativeRange.setEnd(n,t)}h(this)};l=function(n,t){return function(i){try{this.nativeRange[n](i)}catch(r){this.nativeRange[t](i);this.nativeRange[n](i)}h(this)}}}r.setStartBefore=l("setStartBefore","setEndBefore");r.setStartAfter=l("setStartAfter","setEndAfter");r.setEndBefore=l("setEndBefore","setStartBefore");r.setEndAfter=l("setEndAfter","setStartAfter");r.selectNodeContents=function(n){this.setStartAndEnd(n,0,i.getNodeLength(n))};u.selectNodeContents(c);u.setEnd(c,3);a=document.createRange();a.selectNodeContents(c);a.setEnd(c,4);a.setStart(c,2);r.compareBoundaryPoints=u.compareBoundaryPoints(u.START_TO_END,a)==-1&&u.compareBoundaryPoints(u.END_TO_START,a)==1?function(n,t){return t=t.nativeRange||t,n==t.START_TO_END?n=t.END_TO_START:n==t.END_TO_START&&(n=t.START_TO_END),this.nativeRange.compareBoundaryPoints(n,t)}:function(n,t){return this.nativeRange.compareBoundaryPoints(n,t.nativeRange||t)};v=document.createElement("div");v.innerHTML="123";p=v.firstChild;w=e(document);w.appendChild(v);u.setStart(p,1);u.setEnd(p,2);u.deleteContents();p.data=="13"&&(r.deleteContents=function(){this.nativeRange.deleteContents();h(this)},r.extractContents=function(){var n=this.nativeRange.extractContents();return h(this),n});w.removeChild(v);w=null;y.isHostMethod(u,"createContextualFragment")&&(r.createContextualFragment=function(n){return this.nativeRange.createContextualFragment(n)});e(document).removeChild(c);r.getName=function(){return"WrappedRange"};n.WrappedRange=o;n.createNativeRange=function(n){return n=s(n,t,"createNativeRange"),n.createRange()}}(),n.features.implementsTextRange){var p=function(n){var e=n.parentElement(),t=n.duplicate(),r,f,u;return t.collapse(!0),r=t.parentElement(),t=n.duplicate(),t.collapse(!1),f=t.parentElement(),u=r==f?r:i.getCommonAncestor(r,f),u==e?u:i.getCommonAncestor(e,u)},w=function(n){return n.compareEndPoints("StartToEnd",n)==0},c=function(n,t,r,f,e){var c=n.duplicate(),o,k,s,g,y,it;if(c.collapse(r),o=c.parentElement(),i.isOrIsAncestorOf(t,o)||(o=t),!o.canHaveHTML)return k=new u(o.parentNode,i.getNodeIndex(o)),{boundaryPosition:k,nodeInfo:{nodeIndex:k.offset,containerElement:k.node}};s=i.getDocument(o).createElement("span");s.parentNode&&s.parentNode.removeChild(s);for(var p,rt=r?"StartToStart":"StartToEnd",w,d,nt,b,l=e&&e.containerElement==o?e.nodeIndex:0,tt=o.childNodes.length,a=tt,v=a;;){if(v==tt?o.appendChild(s):o.insertBefore(s,o.childNodes[v]),c.moveToElementText(s),p=c.compareEndPoints(rt,n),p==0||l==a)break;else if(p==-1)if(a==l+1)break;else l=v;else a=a==l+1?l:v;v=Math.floor((l+a)/2);o.removeChild(s)}if(b=s.nextSibling,p==-1&&b&&h(b)){if(c.setEndPoint(r?"EndToStart":"EndToEnd",n),/[\r\n]/.test(b.data))for(y=c.duplicate(),it=y.text.replace(/\r\n/g,"\r").length,g=y.moveStart("character",it);(p=y.compareEndPoints("StartToEnd",y))==-1;)g++,y.moveStart("character",1);else g=c.text.length;nt=new u(b,g)}else w=(f||!r)&&s.previousSibling,d=(f||r)&&s.nextSibling,nt=d&&h(d)?new u(d,0):w&&h(w)?new u(w,w.data.length):new u(o,i.getNodeIndex(s));return s.parentNode.removeChild(s),{boundaryPosition:nt,nodeInfo:{nodeIndex:v,containerElement:o}}},l=function(n,t){var u,f,s=n.offset,l=i.getDocument(n.node),r,c,o=e(l).createTextRange(),a=h(n.node);return a?(u=n.node,f=u.parentNode):(c=n.node.childNodes,u=s<c.length?c[s]:null,f=n.node),r=l.createElement("span"),r.innerHTML="&#feff;",u?f.insertBefore(r,u):f.appendChild(r),o.moveToElementText(r),o.collapse(!t),f.removeChild(r),a&&o[t?"moveStart":"moveEnd"]("character",s),o};r=function(n){this.textRange=n;this.refresh()};r.prototype=new f(document);r.prototype.refresh=function(){var n,t,i,r=p(this.textRange);w(this.textRange)?t=n=c(this.textRange,r,!0,!0).boundaryPosition:(i=c(this.textRange,r,!0,!1),n=i.boundaryPosition,t=c(this.textRange,r,!1,!1,i.nodeInfo).boundaryPosition);this.setStart(n.node,n.offset);this.setEnd(t.node,t.offset)};r.prototype.getName=function(){return"WrappedTextRange"};f.copyComparisonConstants(r);a=function(n){if(n.collapsed)return l(new u(n.startContainer,n.startOffset),!0);var i=l(new u(n.startContainer,n.startOffset),!0),r=l(new u(n.endContainer,n.endOffset),!1),t=e(f.getRangeDocument(n)).createTextRange();return t.setEndPoint("StartToStart",i),t.setEndPoint("EndToEnd",r),t};r.rangeToTextRange=a;r.prototype.toTextRange=function(){return a(this)};n.WrappedTextRange=r;(!n.features.implementsDomRange||n.config.preferTextRange)&&(v=function(){return this}(),typeof v.Range=="undefined"&&(v.Range=r),n.createNativeRange=function(n){return n=s(n,t,"createNativeRange"),e(n).createTextRange()},n.WrappedRange=r)}n.createRange=function(i){return i=s(i,t,"createRange"),new n.WrappedRange(n.createNativeRange(i))};n.createRangyRange=function(n){return n=s(n,t,"createRangyRange"),new f(n)};n.createIframeRange=function(i){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),n.createRange(i)};n.createIframeRangyRange=function(i){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),n.createRangyRange(i)};n.addShimListener(function(t){var i=t.document;typeof i.createRange=="undefined"&&(i.createRange=function(){return n.createRange(i)});i=t=null})}),n.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(n,t){function yt(n){return typeof n=="string"?/^backward(s)?$/i.test(n):!!n}function ft(n,i){if(n){if(f.isWindow(n))return n;if(n instanceof h)return n.win;var r=f.getContentDocument(n,t,i);return f.getWindow(r)}return window}function bi(n){return ft(n,"getWinSelection").getSelection()}function fi(n){return ft(n,"getDocSelection").document.selection}function ei(n){var t=!1;return n.anchorNode&&(t=f.comparePoints(n.anchorNode,n.anchorOffset,n.focusNode,n.focusOffset)==1),t}function nt(n,t,i){var r=i?"end":"start",u=i?"start":"end";n.anchorNode=t[r+"Container"];n.anchorOffset=t[r+"Offset"];n.focusNode=t[u+"Container"];n.focusOffset=t[u+"Offset"]}function ki(n){var t=n.nativeSelection;n.anchorNode=t.anchorNode;n.anchorOffset=t.anchorOffset;n.focusNode=t.focusNode;n.focusOffset=t.focusOffset}function v(n){n.anchorNode=n.focusNode=null;n.anchorOffset=n.focusOffset=0;n.rangeCount=0;n.isCollapsed=!0;n._ranges.length=0}function kt(t){var i;return t instanceof k?(i=n.createNativeRange(t.getDocument()),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset)):t instanceof at?i=t.nativeRange:r.implementsDomRange&&t instanceof f.getWindow(t.startContainer).Range&&(i=t),i}function di(n){if(!n.length||n[0].nodeType!=1)return!1;for(var t=1,i=n.length;t<i;++t)if(!f.isAncestorOf(n[0],n[t]))return!1;return!0}function dt(n){var i=n.getNodes();if(!di(i))throw t.createError("getSingleElementFromRange: range "+n.inspect()+" did not consist of a single element");return i[0]}function gt(n){return!!n&&typeof n.text!="undefined"}function ci(n,t){var i=new at(t);n._ranges=[i];nt(n,i,!1);n.rangeCount=1;n.isCollapsed=i.collapsed}function tt(t){var i,u,f,r;if(t._ranges.length=0,t.docSelection.type=="None")v(t);else if(i=t.docSelection.createRange(),gt(i))ci(t,i);else{for(t.rangeCount=i.length,f=e(i.item(0)),r=0;r<t.rangeCount;++r)u=n.createRange(f),u.selectNode(i.item(r)),t._ranges.push(u);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed;nt(t,t._ranges[t.rangeCount-1],!1)}}function li(n,i){for(var r=n.docSelection.createRange(),o=dt(i),s=e(r.item(0)),u=a(s).createControlRange(),f=0,h=r.length;f<h;++f)u.add(r.item(f));try{u.add(o)}catch(c){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}u.select();tt(n)}function h(n,t,i){this.nativeSelection=n;this.docSelection=t;this._ranges=[];this.win=i;this.refresh()}function ai(n){n.win=n.anchorNode=n.focusNode=n._ranges=null;n.rangeCount=n.anchorOffset=n.focusOffset=0;n.detached=!0}function ni(n,t){for(var i=b.length,r,u;i--;)if(r=b[i],u=r.selection,t=="deleteAll")ai(u);else if(r.win==n)return t=="delete"?(b.splice(i,1),!0):u;return t=="deleteAll"&&(b.length=0),null}function vi(n,i){for(var o=e(i[0].startContainer),u=a(o).createControlRange(),r=0,f,s=i.length;r<s;++r){f=dt(i[r]);try{u.add(f)}catch(h){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)");}}u.select();tt(n)}function yi(n,t){if(n.win.document!=e(t))throw new rt("WRONG_DOCUMENT_ERR");}function pi(t){return function(i,r){var u;this.rangeCount?(u=this.getRangeAt(0),u["set"+(t?"Start":"End")](i,r)):(u=n.createRange(this.win.document),u.setStartAndEnd(i,r));this.setSingleRange(u,this.isBackward())}}function wi(n){var i=[],u=new ui(n.anchorNode,n.anchorOffset),f=new ui(n.focusNode,n.focusOffset),e=typeof n.getName=="function"?n.getName():"Selection",t,r;if(typeof n.rangeCount!="undefined")for(t=0,r=n.rangeCount;t<r;++t)i[t]=k.inspect(n.getRangeAt(t));return"["+e+"(Ranges: "+i.join(", ")+")(anchor: "+u.inspect()+", focus: "+f.inspect()+"]"}var et,o,p,g,wt,s,hi,st,b,ht,i,ti,ct,ii,it;n.config.checkSelectionRanges=!0;var ri="boolean",lt="number",f=n.dom,y=n.util,c=y.isHostMethod,k=n.DomRange,at=n.WrappedRange,rt=n.DOMException,ui=f.DomPosition,d,ut,r=n.features,l="Control",e=f.getDocument,a=f.getBody,vt=k.rangesEqual;et=c(window,"getSelection");o=y.isHostObject(document,"selection");r.implementsWinGetSelection=et;r.implementsDocSelection=o;p=o&&(!et||n.config.preferTextRange);p?(d=fi,n.isSelectionValid=function(n){var t=ft(n,"isSelectionValid").document,i=t.selection;return i.type!="None"||e(i.createRange().parentElement())==t}):et?(d=bi,n.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected.");n.getNativeSelection=d;var u=d(),oi=n.createNativeRange(document),pt=a(document),w=y.areHostProperties(u,["anchorNode","focusNode","anchorOffset","focusOffset"]);r.selectionHasAnchorAndFocus=w;g=c(u,"extend");r.selectionHasExtend=g;wt=typeof u.rangeCount==lt;r.selectionHasRangeCount=wt;var ot=!1,si=!0,bt=g?function(t,i){var u=k.getRangeDocument(i),r=n.createRange(u);r.collapseToPoint(i.endContainer,i.endOffset);t.addRange(kt(r));t.extend(i.startContainer,i.startOffset)}:null;if(y.areHostMethods(u,["addRange","getRangeAt","removeAllRanges"])&&typeof u.rangeCount==lt&&r.implementsDomRange&&function(){var t=window.getSelection(),i,h,e,u,r,c,o;if(t){var s=t.rangeCount,l=s>1,f=[],v=ei(t);for(i=0;i<s;++i)f[i]=t.getRangeAt(i);for(h=a(document),e=h.appendChild(document.createElement("div")),e.contentEditable="false",u=e.appendChild(document.createTextNode("   ")),r=document.createRange(),r.setStart(u,1),r.collapse(!0),t.addRange(r),si=t.rangeCount==1,t.removeAllRanges(),l||(c=window.navigator.appVersion.match(/Chrome\/(.*?) /),c&&parseInt(c[1])>=36?ot=!1:(o=r.cloneRange(),r.setStart(u,0),o.setEnd(u,3),o.setStart(u,2),t.addRange(r),t.addRange(o),ot=t.rangeCount==2)),h.removeChild(e),t.removeAllRanges(),i=0;i<s;++i)i==0&&v?bt?bt(t,f[i]):(n.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(f[i])):t.addRange(f[i])}}(),r.selectionSupportsMultipleRanges=ot,r.collapsedNonEditableSelectionsSupported=si,s=!1,pt&&c(pt,"createControlRange")&&(hi=pt.createControlRange(),y.areHostProperties(hi,["item","add"])&&(s=!0)),r.implementsControlRange=s,ut=w?function(n){return n.anchorNode===n.focusNode&&n.anchorOffset===n.focusOffset}:function(n){return n.rangeCount?n.getRangeAt(n.rangeCount-1).collapsed:!1},c(u,"getRangeAt")?st=function(n,t){try{return n.getRangeAt(t)}catch(i){return null}}:w&&(st=function(t){var r=e(t.anchorNode),i=n.createRange(r);return i.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),i}),h.prototype=n.selectionPrototype,b=[],ht=function(n){if(n&&n instanceof h)return n.refresh(),n;n=ft(n,"getNativeSelection");var t=ni(n),i=d(n),r=o?fi(n):null;return t?(t.nativeSelection=i,t.docSelection=r,t.refresh()):(t=new h(i,r,n),b.push({win:n,selection:t})),t},n.getSelection=ht,n.getIframeSelection=function(i){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),n.getSelection(f.getIframeWindow(i))},i=h.prototype,!p&&w&&y.areHostMethods(u,["removeAllRanges","addRange"]))i.removeAllRanges=function(){this.nativeSelection.removeAllRanges();v(this)},ti=function(n,t){bt(n.nativeSelection,t);n.refresh()},i.addRange=wt?function(t,i){var u,r;s&&o&&this.docSelection.type==l?li(this,t):yt(i)&&g?ti(this,t):(ot?u=this.rangeCount:(this.removeAllRanges(),u=0),this.nativeSelection.addRange(kt(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==u+1?(n.config.checkSelectionRanges&&(r=st(this.nativeSelection,this.rangeCount-1),r&&!vt(r,t)&&(t=new at(r))),this._ranges[this.rangeCount-1]=t,nt(this,t,it(this.nativeSelection)),this.isCollapsed=ut(this)):this.refresh())}:function(n,t){yt(t)&&g?ti(this,n):(this.nativeSelection.addRange(kt(n)),this.refresh())},i.setRanges=function(n){if(s&&o&&n.length>1)vi(this,n);else{this.removeAllRanges();for(var t=0,i=n.length;t<i;++t)this.addRange(n[t])}};else if(c(u,"empty")&&c(oi,"select")&&s&&p)i.removeAllRanges=function(){var n,t,i;try{this.docSelection.empty();this.docSelection.type!="None"&&(this.anchorNode?n=e(this.anchorNode):this.docSelection.type==l&&(t=this.docSelection.createRange(),t.length&&(n=e(t.item(0)))),n&&(i=a(n).createTextRange(),i.select(),this.docSelection.empty()))}catch(r){}v(this)},i.addRange=function(t){this.docSelection.type==l?li(this,t):(n.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,nt(this,t,!1))},i.setRanges=function(n){this.removeAllRanges();var t=n.length;t>1?vi(this,n):t&&this.addRange(n[0])};else return t.fail("No means of selecting a Range or TextRange was found"),!1;if(i.getRangeAt=function(n){if(n<0||n>=this.rangeCount)throw new rt("INDEX_SIZE_ERR");else return this._ranges[n].cloneRange()},p)ct=function(t){var i;n.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=a(t.win.document).createTextRange(),i.collapse(!0));t.docSelection.type==l?tt(t):gt(i)?ci(t,i):v(t)};else if(c(u,"getRangeAt")&&typeof u.rangeCount==lt)ct=function(t){if(s&&o&&t.docSelection.type==l)tt(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,r=t.rangeCount;i<r;++i)t._ranges[i]=new n.WrappedRange(t.nativeSelection.getRangeAt(i));nt(t,t._ranges[t.rangeCount-1],it(t.nativeSelection));t.isCollapsed=ut(t)}else v(t)};else if(w&&typeof u.isCollapsed==ri&&typeof oi.collapsed==ri&&r.implementsDomRange)ct=function(n){var t,i=n.nativeSelection;i.anchorNode?(t=st(i,0),n._ranges=[t],n.rangeCount=1,ki(n),n.isCollapsed=ut(n)):v(n)};else return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;i.refresh=function(n){var i=n?this._ranges.slice(0):null,r=this.anchorNode,u=this.anchorOffset,t;if(ct(this),n){if((t=i.length,t!=this._ranges.length)||this.anchorNode!=r||this.anchorOffset!=u)return!0;while(t--)if(!vt(i[t],this._ranges[t]))return!0;return!1}};ii=function(n,t){var r=n.getAllRanges(),i,u;for(n.removeAllRanges(),i=0,u=r.length;i<u;++i)vt(t,r[i])||n.addRange(r[i]);n.rangeCount||v(n)};i.removeRange=s&&o?function(n){var t,o;if(this.docSelection.type==l){var i=this.docSelection.createRange(),s=dt(n),h=e(i.item(0)),r=a(h).createControlRange(),u,f=!1;for(t=0,o=i.length;t<o;++t)u=i.item(t),u!==s||f?r.add(i.item(t)):f=!0;r.select();tt(this)}else ii(this,n)}:function(n){ii(this,n)};!p&&w&&r.implementsDomRange?(it=ei,i.isBackward=function(){return it(this)}):it=i.isBackward=function(){return!1};i.isBackwards=i.isBackward;i.toString=function(){for(var t=[],n=0,i=this.rangeCount;n<i;++n)t[n]=""+this._ranges[n];return t.join("")};i.collapse=function(t,i){yi(this,t);var r=n.createRange(t);r.collapseToPoint(t,i);this.setSingleRange(r);this.isCollapsed=!0};i.collapseToStart=function(){if(this.rangeCount){var n=this._ranges[0];this.collapse(n.startContainer,n.startOffset)}else throw new rt("INVALID_STATE_ERR");};i.collapseToEnd=function(){if(this.rangeCount){var n=this._ranges[this.rangeCount-1];this.collapse(n.endContainer,n.endOffset)}else throw new rt("INVALID_STATE_ERR");};i.selectAllChildren=function(t){yi(this,t);var i=n.createRange(t);i.selectNodeContents(t);this.setSingleRange(i)};i.deleteFromDocument=function(){var t,i,n,r,u;if(s&&o&&this.docSelection.type==l){for(t=this.docSelection.createRange();t.length;)i=t.item(0),t.remove(i),i.parentNode.removeChild(i);this.refresh()}else if(this.rangeCount&&(n=this.getAllRanges(),n.length)){for(this.removeAllRanges(),r=0,u=n.length;r<u;++r)n[r].deleteContents();this.addRange(n[u-1])}};i.eachRange=function(n,t){for(var i=0,r=this._ranges.length;i<r;++i)if(n(this.getRangeAt(i)))return t};i.getAllRanges=function(){var n=[];return this.eachRange(function(t){n.push(t)}),n};i.setSingleRange=function(n,t){this.removeAllRanges();this.addRange(n,t)};i.callMethodOnEachRange=function(n,t){var i=[];return this.eachRange(function(r){i.push(r[n].apply(r,t))}),i};i.setStart=pi(!0);i.setEnd=pi(!1);n.rangePrototype.select=function(n){ht(this.getDocument()).setSingleRange(this,n)};i.changeEachRange=function(n){var t=[],i=this.isBackward();this.eachRange(function(i){n(i);t.push(i)});this.removeAllRanges();i&&t.length==1?this.addRange(t[0],"backward"):this.setRanges(t)};i.containsNode=function(n,t){return this.eachRange(function(i){return i.containsNode(n,t)},!0)||!1};i.getBookmark=function(n){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[n])}};i.moveToBookmark=function(t){for(var i=[],f=0,u,r;u=t.rangeBookmarks[f++];)r=n.createRange(this.win),r.moveToBookmark(u),i.push(r);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)};i.toHtml=function(){var n=[];return this.eachRange(function(t){n.push(k.toHtml(t))}),n.join("")};r.implementsTextRange&&(i.getNativeTextRange=function(){var r,i;if(r=this.docSelection){if(i=r.createRange(),gt(i))return i;throw t.createError("getNativeTextRange: selection is a control selection");}else{if(this.rangeCount>0)return n.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range");}});i.getName=function(){return"WrappedSelection"};i.inspect=function(){return wi(this)};i.detach=function(){ni(this.win,"delete");ai(this)};h.detachAll=function(){ni(null,"deleteAll")};h.inspect=wi;h.isDirectionBackward=yt;n.Selection=h;n.selectionPrototype=i;n.addShimListener(function(n){typeof n.getSelection=="undefined"&&(n.getSelection=function(){return ht(n)});n=null})}),n},this),function(n,t){typeof define=="function"&&define.amd?define(["rangy"],n):n(t.rangy)}(function(n){n.createModule("SaveRestore",["WrappedRange"],function(n,t){function i(n,t){return(t||document).getElementById(n)}function u(n,t){var f="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),i,r=c.getDocument(n.startContainer),u=n.cloneRange();return u.collapse(t),i=r.createElement("span"),i.id=f,i.style.lineHeight="0",i.style.display="none",i.className="rangySelectionBoundary",i.appendChild(r.createTextNode(l)),u.insertNode(i),i}function f(n,r,u,f){var e=i(u,n);e?(r[f?"setStartBefore":"setEndBefore"](e),e.parentNode.removeChild(e)):t.warn("Marker element has been removed. Cannot restore selection.")}function a(n,t){return t.compareBoundaryPoints(n.START_TO_START,n)}function e(t,i){var f,r,e=n.DomRange.getRangeDocument(t),o=t.toString();return t.collapsed?(r=u(t,!1),{document:e,markerId:r.id,collapsed:!0}):(r=u(t,!1),f=u(t,!0),{document:e,startMarkerId:f.id,endMarkerId:r.id,collapsed:!1,backward:i,toString:function(){return"original text: '"+o+"', new text: '"+t.toString()+"'"}})}function o(r,u){var h=r.document,o,e,s;return typeof u=="undefined"&&(u=!0),o=n.createRange(h),r.collapsed?(e=i(r.markerId,h),e?(e.style.display="inline",s=e.previousSibling,s&&s.nodeType==3?(e.parentNode.removeChild(e),o.collapseToPoint(s,s.length)):(o.collapseBefore(e),e.parentNode.removeChild(e))):t.warn("Marker element has been removed. Cannot restore selection.")):(f(h,o,r.startMarkerId,!0),f(h,o,r.endMarkerId,!1)),u&&o.normalizeBoundaries(),o}function s(t,r){var o=[],f,s,u,h;for(t=t.slice(0),t.sort(a),u=0,h=t.length;u<h;++u)o[u]=e(t[u],r);for(u=h-1;u>=0;--u)f=t[u],s=n.DomRange.getRangeDocument(f),f.collapsed?f.collapseAfter(i(o[u].markerId,s)):(f.setEndBefore(i(o[u].endMarkerId,s)),f.setStartAfter(i(o[u].startMarkerId,s)));return o}function v(i){if(!n.isSelectionValid(i))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var r=n.getSelection(i),u=r.getAllRanges(),f=u.length==1&&r.isBackward(),e=s(u,f);return f?r.setSingleRange(u[0],"backward"):r.setRanges(u),{win:i,rangeInfos:e,restored:!1}}function h(n){for(var i=[],r=n.length,t=r-1;t>=0;t--)i[t]=o(n[t],!0);return i}function y(t,i){if(!t.restored){var r=t.rangeInfos,u=n.getSelection(t.win),f=h(r),e=r.length;e==1&&i&&n.features.selectionHasExtend&&r[0].backward?(u.removeAllRanges(),u.addRange(f[0],!0)):u.setRanges(f);t.restored=!0}}function r(n,t){var r=i(t,n);r&&r.parentNode.removeChild(r)}function p(n){for(var u=n.rangeInfos,i=0,f=u.length,t;i<f;++i)t=u[i],t.collapsed?r(n.doc,t.markerId):(r(n.doc,t.startMarkerId),r(n.doc,t.endMarkerId))}var c=n.dom,l="﻿";n.util.extend(n,{saveRange:e,restoreRange:o,saveRanges:s,restoreRanges:h,saveSelection:v,restoreSelection:y,removeMarkerElement:r,removeMarkers:p})})},this);Base=function(){};Base.extend=function(n,t){var u=Base.prototype.extend,r,f,i;return Base._prototyping=!0,r=new this,u.call(r,n),r.base=function(){},delete Base._prototyping,f=r.constructor,i=r.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(arguments[0]!=null)return(arguments[0].extend||u).call(arguments[0],r)},i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=r,i.toString=this.toString,i.valueOf=function(n){return n=="object"?i:f.valueOf()},u.call(i,t),typeof i.init=="function"&&i.init(),i};Base.prototype={extend:function(n,t){var r,f,u,i;if(arguments.length>1)r=this[n],r&&typeof t=="function"&&(!r.valueOf||r.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)&&(f=t.valueOf(),t=function(){var t=this.base||Base.prototype.base,n;return this.base=r,n=f.apply(this,arguments),this.base=t,n},t.valueOf=function(n){return n=="object"?t:f},t.toString=Base.toString),this[n]=t;else if(n){u=Base.prototype.extend;Base._prototyping||typeof this=="function"||(u=this.extend||u);for(var e={toSource:null},o=["constructor","toString","valueOf"],s=Base._prototyping?0:1;i=o[s++];)n[i]!=e[i]&&u.call(this,i,n[i]);for(i in n)e[i]||u.call(this,i,n[i])}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(n,t,i){for(var r in n)this.prototype[r]===undefined&&t.call(i,n[r],r,n)},implement:function(){for(var n=0;n<arguments.length;n++)typeof arguments[n]=="function"?arguments[n](this.prototype):this.prototype.extend(arguments[n]);return this},toString:function(){return String(this.valueOf())}});wysihtml5.browser=function(){function o(n){return+(/ipad|iphone|ipod/.test(n)&&n.match(/ os (\d+).+? like mac os x/)||[undefined,0])[1]}function s(n){return+(n.match(/android (\d+)/)||[undefined,0])[1]}function n(n,t){var i=-1,r;return(navigator.appName=="Microsoft Internet Explorer"?r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):navigator.appName=="Netscape"&&(r=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),r&&r.exec(navigator.userAgent)!=null&&(i=parseFloat(RegExp.$1)),i===-1)?!1:n?t?t==="<"?n<i:t===">"?n>i:t==="<="?n<=i:t===">="?n>=i:void 0:n===i:!0}var t=navigator.userAgent,i=document.createElement("div"),r=t.indexOf("Gecko")!==-1&&t.indexOf("KHTML")===-1,f=t.indexOf("AppleWebKit/")!==-1,e=t.indexOf("Chrome/")!==-1,u=t.indexOf("Opera/")!==-1;return{USER_AGENT:t,supported:function(){var n=this.USER_AGENT.toLowerCase(),t="contentEditable"in i,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,u=document.querySelector&&document.querySelectorAll,f=this.isIos()&&o(n)<5||this.isAndroid()&&s(n)<4||n.indexOf("opera mobi")!==-1||n.indexOf("hpwos/")!==-1;return t&&r&&u&&!f},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return this.USER_AGENT.indexOf("Android")!==-1},supportsSandboxedIframes:function(){return n()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return n()},hasCurrentStyleProperty:function(){return"currentStyle"in i},hasHistoryIssue:function(){return r&&navigator.platform.substr(0,3)==="Mac"},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(n){return"placeholder"in n},supportsEvent:function(n){return"on"+n in i||function(){return i.setAttribute("on"+n,"return;"),typeof i["on"+n]=="function"}()},supportsEventsInIframeCorrectly:function(){return!u},supportsHTML5Tags:function(n){var t=n.createElement("div"),i="<article>foo<\/article>";return t.innerHTML=i,t.innerHTML.toLowerCase()===i},supportsCommand:function(){var t={formatBlock:n(10,"<="),insertUnorderedList:n(),insertOrderedList:n()},i={insertHTML:r};return function(n,r){var u=t[r];if(!u){try{return n.queryCommandSupported(r)}catch(f){}try{return n.queryCommandEnabled(r)}catch(e){return!!i[r]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||u||f},supportsGetAttributeCorrectly:function(){var n=document.createElement("td");return n.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return r||n()||u},autoScrollsToCaret:function(){return!f},autoClosesUnclosedTags:function(){var r=i.cloneNode(!1),n,t;return r.innerHTML="<p><div><\/div>",t=r.innerHTML.toLowerCase(),n=t==="<p><\/p><div><\/div>"||t==="<p><div><\/div><\/p>",this.autoClosesUnclosedTags=function(){return n},n},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return u},supportsSpeechApiOn:function(n){var i=t.match(/Chrome\/(\d+)/)||[undefined,0];return i[1]>=11&&("onwebkitspeechchange"in n||"speech"in n)},crashesWhenDefineProperty:function(t){return n(9)&&(t==="XMLHttpRequest"||t==="XDomainRequest")},doesAsyncFocus:function(){return n()},hasProblemsSettingCaretAfterImg:function(){return n()},hasUndoInContextMenu:function(){return r||e||u},hasInsertNodeIssue:function(){return u},hasIframeFocusIssue:function(){return n()},createsNestedInvalidMarkupAfterPaste:function(){return f},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModenPaste:function(){return!("clipboardData"in window)}}}();wysihtml5.lang.array=function(n){return{contains:function(t){if(Array.isArray(t)){for(var i=t.length;i--;)if(wysihtml5.lang.array(n).indexOf(t[i])!==-1)return!0;return!1}return wysihtml5.lang.array(n).indexOf(t)!==-1},indexOf:function(t){if(n.indexOf)return n.indexOf(t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1},without:function(t){t=wysihtml5.lang.array(t);for(var r=[],i=0,u=n.length;i<u;i++)t.contains(n[i])||r.push(n[i]);return r},get:function(){for(var t=0,r=n.length,i=[];t<r;t++)i.push(n[t]);return i},map:function(t,i){if(Array.prototype.map)return n.map(t,i);for(var u=n.length>>>0,f=new Array(u),r=0;r<u;r++)f[r]=t.call(i,n[r],r,n);return f},unique:function(){for(var i=[],r=n.length,t=0;t<r;)wysihtml5.lang.array(i).contains(n[t])||i.push(n[t]),t++;return i}}};wysihtml5.lang.Dispatcher=Base.extend({on:function(n,t){return this.events=this.events||{},this.events[n]=this.events[n]||[],this.events[n].push(t),this},off:function(n,t){this.events=this.events||{};var i=0,r,u;if(n){for(r=this.events[n]||[],u=[];i<r.length;i++)r[i]!==t&&t&&u.push(r[i]);this.events[n]=u}else this.events={};return this},fire:function(n,t){this.events=this.events||{};for(var r=this.events[n]||[],i=0;i<r.length;i++)r[i].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}});wysihtml5.lang.object=function(n){return{merge:function(t){for(var i in t)n[i]=t[i];return this},get:function(){return n},clone:function(t){var r={},i;if(n===null||!wysihtml5.lang.object(n).isPlainObject())return n;for(i in n)n.hasOwnProperty(i)&&(r[i]=t?wysihtml5.lang.object(n[i]).clone(t):n[i]);return r},isArray:function(){return Object.prototype.toString.call(n)==="[object Array]"},isFunction:function(){return Object.prototype.toString.call(n)==="[object Function]"},isPlainObject:function(){return Object.prototype.toString.call(n)==="[object Object]"}}},function(){var n=/^\s+/,t=/\s+$/,i=/[&<>\t"]/g,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};wysihtml5.lang.string=function(u){return u=String(u),{trim:function(){return u.replace(n,"").replace(t,"")},interpolate:function(n){for(var t in n)u=this.replace("#{"+t+"}").by(n[t]);return u},replace:function(n){return{by:function(t){return u.split(n).join(t)}}},escapeHTML:function(n,t){var f=u.replace(i,function(n){return r[n]});return n&&(f=f.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&(f=f.replace(/  /gi,"&nbsp; ")),f}}}}(),function(n){function o(n,t){return l(n,t)?n:(n===n.ownerDocument.documentElement&&(n=n.ownerDocument.body),f(n,t))}function s(n){return n.replace(t,function(n,t){var i=(t.match(r)||[])[1]||"",s=e[i],f,o;return t=t.replace(r,""),t.split(s).length>t.split(i).length&&(t=t+i,i=""),f=t,o=t,t.length>u&&(o=o.substr(0,u)+"..."),f.substr(0,4)==="www."&&(f="http://"+f),'<a href="'+f+'">'+o+"<\/a>"+i})}function h(n){var t=n._wysihtml5_tempElement;return t||(t=n._wysihtml5_tempElement=n.createElement("div")),t}function c(t){var r=t.parentNode,u=n.lang.string(t.data).escapeHTML(),i=h(r.ownerDocument);for(i.innerHTML="<span><\/span>"+s(u),i.removeChild(i.firstChild);i.firstChild;)r.insertBefore(i.firstChild,t);r.removeChild(t)}function l(t,r){for(var u;t.parentNode;){if((t=t.parentNode,u=t.nodeName,t.className&&n.lang.array(t.className.split(" ")).contains(r))||i.contains(u))return!0;if(u==="body")return!1}return!1}function f(r,u){if(!i.contains(r.nodeName)&&(!r.className||!n.lang.array(r.className.split(" ")).contains(u))){if(r.nodeType===n.TEXT_NODE&&r.data.match(t)){c(r);return}for(var o=n.lang.array(r.childNodes).get(),s=o.length,e=0;e<s;e++)f(o[e],u);return r}}var i=n.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),t=/((https?:\/\/|www\.)[^\s<]{3,})/gi,r=/([^\w\/\-](,?))$/i,u=100,e={")":"(","]":"[","}":"{"};n.dom.autoLink=o;n.dom.autoLink.URL_REG_EXP=t}(wysihtml5),function(n){var t=n.dom;t.addClass=function(n,i){var r=n.classList;if(r)return r.add(i);t.hasClass(n,i)||(n.className+=" "+i)};t.removeClass=function(n,t){var i=n.classList;if(i)return i.remove(t);n.className=n.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")};t.hasClass=function(n,t){var r=n.classList,i;return r?r.contains(t):(i=n.className,i.length>0&&(i==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)))}}(wysihtml5);wysihtml5.dom.contains=function(){var n=document.documentElement;return n.contains?function(n,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),n!==t&&n.contains(t)}:n.compareDocumentPosition?function(n,t){return!!(n.compareDocumentPosition(t)&16)}:void 0}();wysihtml5.dom.convertToList=function(){function n(n,t){var i=n.createElement("li");return t.appendChild(i),i}function t(n,t){return n.createElement(t)}function i(i,r,u){if(i.nodeName==="UL"||i.nodeName==="OL"||i.nodeName==="MENU")return i;for(var l=i.ownerDocument,h=t(l,r),v=i.querySelectorAll("br"),b=v.length,a,y,o,s,c,p,w,f,e=0;e<b;e++)for(s=v[e];(c=s.parentNode)&&c!==i&&c.lastChild===s;){if(wysihtml5.dom.getStyle("display").from(c)==="block"){c.removeChild(s);break}wysihtml5.dom.insert(s).after(s.parentNode)}for(a=wysihtml5.lang.array(i.childNodes).get(),y=a.length,e=0;e<y;e++){if(f=f||n(l,h),o=a[e],p=wysihtml5.dom.getStyle("display").from(o)==="block",w=o.nodeName==="BR",p&&(!u||!wysihtml5.dom.hasClass(o,u))){f=f.firstChild?n(l,h):f;f.appendChild(o);f=null;continue}if(w){f=f.firstChild?null:f;continue}f.appendChild(o)}return a.length===0&&n(l,h),i.parentNode.replaceChild(h,i),h}return i}();wysihtml5.dom.copyAttributes=function(n){return{from:function(t){return{to:function(i){for(var r,u=0,f=n.length;u<f;u++)r=n[u],typeof t[r]!="undefined"&&t[r]!==""&&(i[r]=t[r]);return{andTo:arguments.callee}}}}}},function(n){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],i=function(t){return r(t)?parseInt(n.getStyle("width").from(t),10)<t.offsetWidth:!1},r=function(i){for(var r=0,u=t.length;r<u;r++)if(n.getStyle(t[r]).from(i)==="border-box")return t[r]};n.copyStyles=function(r){return{from:function(u){i(u)&&(r=wysihtml5.lang.array(r).without(t));for(var o="",s=r.length,f=0,e;f<s;f++)e=r[f],o+=e+":"+n.getStyle(e).from(u)+";";return{to:function(t){n.setStyles(o).on(t);return{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(n){n.dom.delegate=function(t,i,r,u){return n.dom.observe(t,r,function(r){for(var f=r.target,e=n.lang.array(t.querySelectorAll(i));f&&f!==t;){if(e.contains(f)){u.call(f,r);break}f=f.parentNode}})}}(wysihtml5),function(n){n.dom.domNode=function(t){var i=[n.ELEMENT_NODE,n.TEXT_NODE],r=function(t){return t.nodeType===n.TEXT_NODE&&/^\s*$/g.test(t.data)};return{prev:function(u){var f=t.previousSibling,e=u&&u.nodeTypes?u.nodeTypes:i;return f?!n.lang.array(e).contains(f.nodeType)||u&&u.ignoreBlankTexts&&r(f)?n.dom.domNode(f).prev(u):f:null},next:function(u){var f=t.nextSibling,e=u&&u.nodeTypes?u.nodeTypes:i;return f?!n.lang.array(e).contains(f.nodeType)||u&&u.ignoreBlankTexts&&r(f)?n.dom.domNode(f).next(u):f:null}}}}(wysihtml5);wysihtml5.dom.getAsDom=function(){var t=function(n,t){var i=t.createElement("div");i.style.display="none";t.body.appendChild(i);try{i.innerHTML=n}catch(r){}return t.body.removeChild(i),i},i=function(t){if(!t._wysihtml5_supportsHTML5Tags){for(var i=0,r=n.length;i<r;i++)t.createElement(n[i]);t._wysihtml5_supportsHTML5Tags=!0}},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,r){r=r||document;var u;return typeof n=="object"&&n.nodeType?(u=r.createElement("div"),u.appendChild(n)):wysihtml5.browser.supportsHTML5Tags(r)?(u=r.createElement("div"),u.innerHTML=n):(i(r),u=t(n,r)),u}}();wysihtml5.dom.getParentElement=function(){function n(n,t){return!t||!t.length?!0:typeof t=="string"?n===t:wysihtml5.lang.array(t).contains(n)}function t(n){return n.nodeType===wysihtml5.ELEMENT_NODE}function i(n,t,i){var r=(n.className||"").match(i)||[];return t?r[r.length-1]===t:!!r.length}function r(n,t,i){var r=(n.getAttribute("style")||"").match(i)||[];return t?r[r.length-1]===t:!!r.length}return function(u,f,e,o){var s=f.cssStyle||f.styleRegExp,h=f.className||f.classRegExp;for(e=e||50;e--&&u&&u.nodeName!=="BODY"&&(!o||u!==o);){if(t(u)&&n(u.nodeName,f.nodeName)&&(!s||r(u,f.cssStyle,f.styleRegExp))&&(!h||i(u,f.className,f.classRegExp)))return u;u=u.parentNode}return null}}();wysihtml5.dom.getStyle=function(){function i(n){return n.replace(t,function(n){return n.charAt(1).toUpperCase()})}var n={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},t=/\-[a-z]/g;return function(t){return{from:function(r){var f,e,l,a;if(r.nodeType===wysihtml5.ELEMENT_NODE){var o=r.ownerDocument,s=n[t]||i(t),u=r.style,h=r.currentStyle,c=u[s];if(c)return c;if(h)try{return h[s]}catch(v){}return f=o.defaultView||o.parentWindow,e=(t==="height"||t==="width")&&r.nodeName==="TEXTAREA",f.getComputedStyle?(e&&(l=u.overflow,u.overflow="hidden"),a=f.getComputedStyle(r,null).getPropertyValue(t),e&&(u.overflow=l||""),a):void 0}}}}}();wysihtml5.dom.getTextNodes=function(n,t){var i=[];for(n=n.firstChild;n;n=n.nextSibling)n.nodeType==3?t&&/^\s*$/.test(n.innerText||n.textContent)||i.push(n):i=i.concat(wysihtml5.dom.getTextNodes(n,t));return i};wysihtml5.dom.hasElementWithTagName=function(){function i(n){return n._wysihtml5_identifier||(n._wysihtml5_identifier=t++)}var n={},t=1;return function(t,r){var f=i(t)+":"+r,u=n[f];return u||(u=n[f]=t.getElementsByTagName(r)),u.length>0}}(),function(n){function r(n){return n._wysihtml5_identifier||(n._wysihtml5_identifier=i++)}var t={},i=1;n.dom.hasElementWithClassName=function(i,u){if(!n.browser.supportsNativeGetElementsByClassName())return!!i.querySelector("."+u);var e=r(i)+":"+u,f=t[e];return f||(f=t[e]=i.getElementsByClassName(u)),f.length>0}}(wysihtml5);wysihtml5.dom.insert=function(n){return{after:function(t){t.parentNode.insertBefore(n,t.nextSibling)},before:function(t){t.parentNode.insertBefore(n,t)},into:function(t){t.appendChild(n)}}};wysihtml5.dom.insertCSS=function(n){return n=n.join("\n"),{into:function(t){var i=t.createElement("style"),r,u;if(i.type="text/css",i.styleSheet?i.styleSheet.cssText=n:i.appendChild(t.createTextNode(n)),r=t.querySelector("head link"),r){r.parentNode.insertBefore(i,r);return}u=t.querySelector("head");u&&u.appendChild(i)}}},function(n){n.dom.lineBreaks=function(t){function i(n){return n.nodeName==="BR"}function r(t){return i(t)?!0:n.dom.getStyle("display").from(t)==="block"?!0:!1}return{add:function(){var i=t.ownerDocument,u=n.dom.domNode(t).next({ignoreBlankTexts:!0}),f=n.dom.domNode(t).prev({ignoreBlankTexts:!0});u&&!r(u)&&n.dom.insert(i.createElement("br")).after(t);f&&!r(f)&&n.dom.insert(i.createElement("br")).before(t)},remove:function(){var r=n.dom.domNode(t).next({ignoreBlankTexts:!0}),u=n.dom.domNode(t).prev({ignoreBlankTexts:!0});r&&i(r)&&r.parentNode.removeChild(r);u&&i(u)&&u.parentNode.removeChild(u)}}}}(wysihtml5);wysihtml5.dom.observe=function(n,t,i){t=typeof t=="string"?[t]:t;for(var r,u,f=0,e=t.length;f<e;f++)u=t[f],n.addEventListener?n.addEventListener(u,i,!1):(r=function(t){"target"in t||(t.target=t.srcElement);t.preventDefault=t.preventDefault||function(){this.returnValue=!1};t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0};i.call(n,t)},n.attachEvent("on"+u,r));return{stop:function(){for(var u,f=0,e=t.length;f<e;f++)u=t[f],n.removeEventListener?n.removeEventListener(u,i,!1):n.detachEvent("on"+u,r)}}};wysihtml5.dom.parse=function(n,t){function a(n,t){var o,s;wysihtml5.lang.object(i).merge(l).merge(t.rules).get();var c=t.context||n.ownerDocument||document,h=c.createDocumentFragment(),a=typeof n=="string",y=!1,r,u,e;for(t.clearInternals===!0&&(y=!0),r=a?wysihtml5.dom.getAsDom(n,c):n,i.selectors&&v(r,i.selectors);r.firstChild;)e=r.firstChild,u=f(e,t.cleanUp,y,t.uneditableClass),u&&h.appendChild(u),e!==u&&r.removeChild(e);if(t.unjoinNbsps)for(o=wysihtml5.dom.getTextNodes(h),s=o.length;s--;)o[s].nodeValue=o[s].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return r.innerHTML="",r.appendChild(h),a?wysihtml5.quirks.getCorrectInnerHTML(r):r}function f(n,t,i,u){var a=n.nodeType,l=n.childNodes,v=l.length,y=c[a],o=0,s,e,h;if(u&&a===1&&wysihtml5.dom.hasClass(n,u))return n;if(e=y&&y(n,i),!e){if(e===!1){for(s=n.ownerDocument.createDocumentFragment(),o=v;o--;)l[o]&&(h=f(l[o],t,i,u),h&&(l[o]===h&&o--,s.insertBefore(h,s.firstChild)));return wysihtml5.dom.getStyle("display").from(n)==="block"&&s.appendChild(n.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(n.nodeName.toLowerCase())&&n.parentNode.lastChild!==n&&(n.nextSibling&&n.nextSibling.nodeType===3&&/^\s/.test(n.nextSibling.nodeValue)||s.appendChild(n.ownerDocument.createTextNode(" "))),s.normalize&&s.normalize(),s}return null}for(o=0;o<v;o++)l[o]&&(h=f(l[o],t,i,u),h&&(l[o]===h&&o--,e.appendChild(h)));if(t&&e.nodeName.toLowerCase()===r&&(!e.childNodes.length||/^\s*$/gi.test(e.innerHTML)&&(i||n.className!=="_wysihtml5-temp-placeholder"&&n.className!=="rangySelectionBoundary")||!e.attributes.length)){for(s=e.ownerDocument.createDocumentFragment();e.firstChild;)s.appendChild(e.firstChild);return s.normalize&&s.normalize(),s}return e.normalize&&e.normalize(),e}function v(n,t){var i,r,u,f;for(i in t)if(t.hasOwnProperty(i))for(wysihtml5.lang.object(t[i]).isFunction()?r=t[i]:typeof t[i]=="string"&&h[t[i]]&&(r=h[t[i]]),u=n.querySelectorAll(i),f=u.length;f--;)r(u[f])}function y(n,t){var u,f,s=i.tags,e=n.nodeName.toLowerCase(),o=n.scopeName,h;if(n._wysihtml5||(n._wysihtml5=1,n.className==="wysihtml5-temp"))return null;if(o&&o!="HTML"&&(e=o+":"+e),"outerHTML"in n&&(wysihtml5.browser.autoClosesUnclosedTags()||n.nodeName!=="P"||n.outerHTML.slice(-4).toLowerCase()==="<\/p>"||(e="div")),e in s){if(u=s[e],!u||u.remove)return null;if(u.unwrap)return!1;u=typeof u=="string"?{rename_tag:u}:u}else if(n.firstChild)u={rename_tag:r};else return null;if(u.one_of_type&&!p(n,i,u.one_of_type,t))if(u.remove_action){if(u.remove_action==="unwrap")return!1;if(u.remove_action==="rename")h=u.remove_action_rename_to||r;else return null}else return null;return f=n.ownerDocument.createElement(h||u.rename_tag||e),g(n,f,u,t),b(n,f,u),n=null,f.normalize&&f.normalize(),f}function p(n,t,i,r){var f,u;if(n.nodeName==="SPAN"&&!r&&(n.className==="_wysihtml5-temp-placeholder"||n.className==="rangySelectionBoundary"))return!0;for(u in i)if(i.hasOwnProperty(u)&&t.type_definitions&&t.type_definitions[u]&&(f=t.type_definitions[u],w(n,f)))return!0;return!1}function w(n,t){var r=n.getAttribute("class"),f=n.getAttribute("style"),v,i,e,c,l,o,h,a;if(t.methods)for(o in t.methods)if(t.methods.hasOwnProperty(o)&&s[o]&&s[o](n))return!0;if(r&&t.classes)for(r=r.replace(/^\s+/g,"").replace(/\s+$/g,"").split(u),v=r.length,h=0;h<v;h++)if(t.classes[r[h]])return!0;if(f&&t.styles){f=f.split(";");for(i in t.styles)if(t.styles.hasOwnProperty(i))for(a=f.length;a--;)if(l=f[a].split(":"),l[0].replace(/\s/g,"").toLowerCase()===i&&(t.styles[i]===!0||t.styles[i]===1||wysihtml5.lang.array(t.styles[i]).contains(l[1].replace(/\s/g,"").toLowerCase())))return!0}if(t.attrs)for(e in t.attrs)if(t.attrs.hasOwnProperty(e)&&(c=wysihtml5.dom.getAttribute(n,e),typeof c=="string"&&c.search(t.attrs[e])>-1))return!0;return!1}function b(n,t,i){var r,u;if(i&&i.keep_styles)for(r in i.keep_styles)if(i.keep_styles.hasOwnProperty(r)){if(u=r==="float"?n.style.styleFloat||n.style.cssFloat:n.style[r],i.keep_styles[r]instanceof RegExp&&!i.keep_styles[r].test(u))continue;r==="float"?t.style[n.style.styleFloat?"styleFloat":"cssFloat"]=u:n.style[r]&&(t.style[r]=u)}}function k(n,t){var r=[];for(var i in t)t.hasOwnProperty(i)&&i.indexOf(n)===0&&r.push(i);return r}function o(n,t,i,r){var f=it[i],u;return f&&(t||n==="alt"&&r=="IMG")&&(u=f(t),typeof u=="string")?u:!1}function d(n,t){var a=wysihtml5.lang.object(i.attributes||{}).clone(),s=wysihtml5.lang.object(a).merge(wysihtml5.lang.object(t||{}).clone()).get(),h={},c=wysihtml5.dom.getAttributes(n),r,u,e,f,l;for(r in s)if(/\*$/.test(r))for(e=k(r.slice(0,-1),c),f=0,l=e.length;f<l;f++)u=o(e[f],c[e[f]],s[r],n.nodeName),u!==!1&&(h[e[f]]=u);else u=o(r,c[r],s[r],n.nodeName),u!==!1&&(h[r]=u);return h}function g(n,t,r,f){var e={},nt=r.set_class,w=r.add_class,b=r.add_style,tt=r.set_attributes,h=i.classes,c=0,o=[],k=[],l=[],a=[],p,v,g,s,y;if(tt&&(e=wysihtml5.lang.object(tt).clone()),e=wysihtml5.lang.object(e).merge(d(n,r.check_attributes)).get(),nt&&o.push(nt),w)for(s in w)(y=ut[w[s]],y)&&(g=y(wysihtml5.dom.getAttribute(n,s)),typeof g=="string"&&o.push(g));if(b)for(s in b)(y=rt[b[s]],y)&&(newStyle=y(wysihtml5.dom.getAttribute(n,s)),typeof newStyle=="string"&&k.push(newStyle));if(typeof h=="string"&&h==="any"&&n.getAttribute("class"))if(i.classes_blacklist){for(a=n.getAttribute("class"),a&&(o=o.concat(a.split(u))),p=o.length;c<p;c++)v=o[c],i.classes_blacklist[v]||l.push(v);l.length&&(e["class"]=wysihtml5.lang.array(l).unique().join(" "))}else e["class"]=n.getAttribute("class");else{for(f||(h["_wysihtml5-temp-placeholder"]=1,h._rangySelectionBoundary=1,h["wysiwyg-tmp-selected-cell"]=1),a=n.getAttribute("class"),a&&(o=o.concat(a.split(u))),p=o.length;c<p;c++)v=o[c],h[v]&&l.push(v);l.length&&(e["class"]=wysihtml5.lang.array(l).unique().join(" "))}e["class"]&&f&&(e["class"]=e["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(e["class"])&&delete e["class"]);k.length&&(e.style=wysihtml5.lang.array(k).unique().join(" "));for(s in e)try{t.setAttribute(s,e[s])}catch(it){}e.src&&(typeof e.width!="undefined"&&t.setAttribute("width",e.width),typeof e.height!="undefined"&&t.setAttribute("height",e.height))}function nt(n){var t=n.nextSibling,i;if(t&&t.nodeType===wysihtml5.TEXT_NODE)t.data=n.data.replace(e,"")+t.data.replace(e,"");else return i=n.data.replace(e,""),n.ownerDocument.createTextNode(i)}function tt(n){if(i.comments)return n.ownerDocument.createComment(n.nodeValue)}var c={"1":y,"3":nt,"8":tt},r="span",u=/\s+/,l={tags:{},classes:{}},i={},e=/\uFEFF/g,it={url:function(){var n=/^https?:\/\//i;return function(t){return!t||!t.match(n)?null:t.replace(n,function(n){return n.toLowerCase()})}}(),src:function(){var n=/^(\/|https?:\/\/)/i;return function(t){return!t||!t.match(n)?null:t.replace(n,function(n){return n.toLowerCase()})}}(),href:function(){var n=/^(#|\/|https?:\/\/|mailto:)/i;return function(t){return!t||!t.match(n)?null:t.replace(n,function(n){return n.toLowerCase()})}}(),alt:function(){var n=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(n,""):""}}(),numbers:function(){var n=/\D/g;return function(t){return t=(t||"").replace(n,""),t||null}}(),any:function(){return function(n){return n}}()},rt={align_text:function(){var n={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(t){return n[String(t).toLowerCase()]}}()},ut={align_img:function(){var n={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return n[String(t).toLowerCase()]}}(),align_text:function(){var n={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return n[String(t).toLowerCase()]}}(),clear_br:function(){var n={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return n[String(t).toLowerCase()]}}(),size_font:function(){var n={"1":"wysiwyg-font-size-xx-small","2":"wysiwyg-font-size-small","3":"wysiwyg-font-size-medium","4":"wysiwyg-font-size-large","5":"wysiwyg-font-size-x-large","6":"wysiwyg-font-size-xx-large","7":"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return n[String(t).charAt(0)]}}()},s={has_visible_contet:function(){var n,t=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(i){if(n=(i.innerText||i.textContent).replace(/\s/g,""),n&&n.length>0)return!0;for(var r=t.length;r--;)if(i.querySelector(t[r]))return!0;return i.offsetWidth&&i.offsetWidth>0&&i.offsetHeight&&i.offsetHeight>0?!0:!1}}()},h={unwrap:function(n){wysihtml5.dom.unwrap(n)},remove:function(n){n.parentNode.removeChild(n)}};return a(n,t)};wysihtml5.dom.removeEmptyTextNodes=function(n){for(var t,r=wysihtml5.lang.array(n.childNodes).get(),u=r.length,i=0;i<u;i++)t=r[i],t.nodeType===wysihtml5.TEXT_NODE&&t.data===""&&t.parentNode.removeChild(t)};wysihtml5.dom.renameElement=function(n,t){for(var i=n.ownerDocument.createElement(t),r;r=n.firstChild;)i.appendChild(r);return wysihtml5.dom.copyAttributes(["align","className"]).from(n).to(i),n.parentNode.replaceChild(i,n),i};wysihtml5.dom.replaceWithChildNodes=function(n){if(n.parentNode){if(!n.firstChild){n.parentNode.removeChild(n);return}for(var t=n.ownerDocument.createDocumentFragment();n.firstChild;)t.appendChild(n.firstChild);n.parentNode.replaceChild(t,n);n=t=null}},function(n){function t(t){return n.getStyle("display").from(t)==="block"}function i(n){return n.nodeName==="BR"}function r(n){var t=n.ownerDocument.createElement("br");n.appendChild(t)}function u(n,u){if(n.nodeName.match(/^(MENU|UL|OL)$/)){var c=n.ownerDocument,o=c.createDocumentFragment(),s=wysihtml5.dom.domNode(n).prev({ignoreBlankTexts:!0}),e,l,a,v,h,f;if(u)for(!s||t(s)||i(s)||r(o);f=n.firstElementChild||n.firstChild;){for(l=f.lastChild;e=f.firstChild;)a=e===l,v=a&&!t(e)&&!i(e),o.appendChild(e),v&&r(o);f.parentNode.removeChild(f)}else while(f=n.firstElementChild||n.firstChild){if(f.querySelector&&f.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))while(e=f.firstChild)o.appendChild(e);else{for(h=c.createElement("p");e=f.firstChild;)h.appendChild(e);o.appendChild(h)}f.parentNode.removeChild(f)}n.parentNode.replaceChild(o,n)}}n.resolveList=u}(wysihtml5.dom),function(n){var t=document,i=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],r=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],u=["referrer","write","open","close"];n.dom.Sandbox=Base.extend({constructor:function(t,i){this.callback=t||n.EMPTY_FUNCTION;this.config=n.lang.object({}).merge(i).get();this.editableArea=this._createIframe()},insertInto:function(n){typeof n=="string"&&(n=t.getElementById(n));n.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var n=this.getIframe();n.parentNode.removeChild(n)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet");},_createIframe:function(){var r=this,i=t.createElement("iframe");i.className="wysihtml5-sandbox";n.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(i);return n.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(i.src="javascript:'<html><\/html>'"),i.onload=function(){i.onreadystatechange=i.onload=null;r._onLoadIframe(i)},i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&(i.onreadystatechange=i.onload=null,r._onLoadIframe(i))},i},_onLoadIframe:function(f){var e,o;if(n.dom.contains(t.documentElement,f)){var c=this,h=f.contentWindow,s=f.contentWindow.document,l=t.characterSet||t.charset||"utf-8",a=this._getHtml({charset:l,stylesheets:this.config.stylesheets});if(s.open("text/html","replace"),s.write(a),s.close(),this.getWindow=function(){return f.contentWindow},this.getDocument=function(){return f.contentWindow.document},h.onerror=function(n,t,i){throw new Error("wysihtml5.Sandbox: "+n,t,i);},!n.browser.supportsSandboxedIframes()){for(e=0,o=i.length;e<o;e++)this._unset(h,i[e]);for(e=0,o=r.length;e<o;e++)this._unset(h,r[e],n.EMPTY_FUNCTION);for(e=0,o=u.length;e<o;e++)this._unset(s,u[e]);this._unset(s,"cookie","",!0)}this.loaded=!0;setTimeout(function(){c.callback(c)},0)}},_getHtml:function(t){var i=t.stylesheets,u="",r=0,f;if(i=typeof i=="string"?[i]:i,i)for(f=i.length;r<f;r++)u+='<link rel="stylesheet" href="'+i[r]+'">';return t.stylesheets=u,n.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}<\/head><body><\/body><\/html>').interpolate(t)},_unset:function(t,i,r,u){try{t[i]=r}catch(e){}try{t.__defineGetter__(i,function(){return r})}catch(e){}if(u)try{t.__defineSetter__(i,function(){})}catch(e){}if(!n.browser.crashesWhenDefineProperty(i))try{var f={get:function(){return r}};u&&(f.set=function(){});Object.defineProperty(t,i,f)}catch(e){}}})}(wysihtml5),function(n){var t=document;n.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(t,i,r){this.callback=t||n.EMPTY_FUNCTION;this.config=n.lang.object({}).merge(i).get();this.element=r?this._bindElement(r):this._createElement()},_createElement:function(){var n=t.createElement("div");return n.className="wysihtml5-sandbox",this._loadElement(n),n},_bindElement:function(n){return n.className=n.className&&n.className!=""?n.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(n,!0),n},_loadElement:function(n,t){var i=this,r;t||(r=this._getHtml(),n.innerHTML=r);this.getWindow=function(){return n.ownerDocument.defaultView};this.getDocument=function(){return n.ownerDocument};this.loaded=!0;setTimeout(function(){i.callback(i)},0)},_getHtml:function(){return""}})}(wysihtml5),function(){var n={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(i){for(var r in t)i.setAttribute(n[r]||r,t[r])}}}}();wysihtml5.dom.setStyles=function(n){return{on:function(t){var r=t.style,i;if(typeof n=="string"){r.cssText+=";"+n;return}for(i in n)i==="float"?(r.cssFloat=n[i],r.styleFloat=n[i]):r[i]=n[i]}}},function(n){n.simulatePlaceholder=function(t,i,r){var e="placeholder",u=function(){var t=i.element.offsetWidth>0&&i.element.offsetHeight>0;i.hasPlaceholderSet()&&(i.clear(),i.element.focus(),t&&setTimeout(function(){var n=i.selection.getSelection();n.focusNode&&n.anchorNode||i.selection.selectNode(i.element.firstChild||i.element)},0));i.placeholderSet=!1;n.removeClass(i.element,e)},f=function(){i.isEmpty()&&(i.placeholderSet=!0,i.setValue(r),n.addClass(i.element,e))};t.on("set_placeholder",f).on("unset_placeholder",u).on("focus:composer",u).on("paste:composer",u).on("blur:composer",f);f()}}(wysihtml5.dom),function(n){var t=document.documentElement;"textContent"in t?(n.setTextContent=function(n,t){n.textContent=t},n.getTextContent=function(n){return n.textContent}):"innerText"in t?(n.setTextContent=function(n,t){n.innerText=t},n.getTextContent=function(n){return n.innerText}):(n.setTextContent=function(n,t){n.nodeValue=t},n.getTextContent=function(n){return n.nodeValue})}(wysihtml5.dom);wysihtml5.dom.getAttribute=function(n,t){var f=!wysihtml5.browser.supportsGetAttributeCorrectly(),i,r,u;return t=t.toLowerCase(),i=n.nodeName,i=="IMG"&&t=="src"&&wysihtml5.dom.isLoadedImage(n)===!0?n.src:f&&"outerHTML"in n?(r=n.outerHTML.toLowerCase(),u=r.indexOf(" "+t+"=")!=-1,u?n.getAttribute(t):null):n.getAttribute(t)};wysihtml5.dom.getAttributes=function(n){var r=!wysihtml5.browser.supportsGetAttributeCorrectly(),u=n.nodeName,i=[];for(var t in n.attributes)(n.attributes.hasOwnProperty&&n.attributes.hasOwnProperty(t)||!n.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(n.attributes,t))&&n.attributes[t].specified&&(u=="IMG"&&n.attributes[t].name.toLowerCase()=="src"&&wysihtml5.dom.isLoadedImage(n)===!0?i.src=n.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(n.attributes[t].name.toLowerCase())&&r?n.attributes[t].value!==1&&(i[n.attributes[t].name]=n.attributes[t].value):i[n.attributes[t].name]=n.attributes[t].value);return i};wysihtml5.dom.isLoadedImage=function(n){try{return n.complete&&!n.mozMatchesSelector(":-moz-broken")}catch(t){if(n.complete&&n.readyState==="complete")return!0}},function(n){function e(n,t){for(var u,f=[],i,r=0,e=n.length;r<e;r++)if(i=n[r].querySelectorAll(t),i)for(u=i.length;u--;f.unshift(i[u]));return f}function u(n){n.parentNode.removeChild(n)}function r(n,t){n.parentNode.insertBefore(t,n.nextSibling)}function o(n,t){for(var i=n.nextSibling;i.nodeType!=1;)if(i=i.nextSibling,!t||t==i.tagName.toLowerCase())return i;return null}var t=n.dom,f=function(n){this.el=n;this.isColspan=!1;this.isRowspan=!1;this.firstCol=!0;this.lastCol=!0;this.firstRow=!0;this.lastRow=!0;this.isReal=!0;this.spanCollection=[];this.modified=!1},i=function(n,i){n?(this.cell=n,this.table=t.getParentElement(n,{nodeName:["TABLE"]})):i&&(this.table=i,this.cell=this.table.querySelectorAll("th, td")[0])};i.prototype={addSpannedCellToMap:function(n,t,i,r,u,e){for(var s,h=[],c=i+(e?parseInt(e,10)-1:0),l=r+(u?parseInt(u,10)-1:0),o=i;o<=c;o++)for(typeof t[o]=="undefined"&&(t[o]=[]),s=r;s<=l;s++)t[o][s]=new f(n),t[o][s].isColspan=u&&parseInt(u,10)>1,t[o][s].isRowspan=e&&parseInt(e,10)>1,t[o][s].firstCol=s==r,t[o][s].lastCol=s==l,t[o][s].firstRow=o==i,t[o][s].lastRow=o==c,t[o][s].isReal=s==r&&o==i,t[o][s].spanCollection=h,h.push(t[o][s])},setCellAsModified:function(n){if(n.modified=!0,n.spanCollection.length>0)for(var t=0,i=n.spanCollection.length;t<i;t++)n.spanCollection[t].modified=!0},setTableMap:function(){for(var r=[],c=this.getTableRows(),l,s,o,u,i,e,h,n=0;n<c.length;n++)for(l=c[n],s=this.getRowCells(l),i=0,typeof r[n]=="undefined"&&(r[n]=[]),o=0;o<s.length;o++){for(u=s[o];typeof r[n][i]!="undefined";)i++;e=t.getAttribute(u,"colspan");h=t.getAttribute(u,"rowspan");e||h?(this.addSpannedCellToMap(u,r,n,i,e,h),i=i+(e?parseInt(e,10):1)):(r[n][i]=new f(u),i++)}return this.map=r,r},getRowCells:function(t){var i=this.table.querySelectorAll("table"),r=i?e(i,"th, td"):[],u=t.querySelectorAll("th, td");return r.length>0?n.lang.array(u).without(r):u},getTableRows:function(){var t=this.table.querySelectorAll("table"),i=t?e(t,"tr"):[],r=this.table.querySelectorAll("tr");return i.length>0?n.lang.array(r).without(i):r},getMapIndex:function(n){for(var t,r=this.map.length,u=this.map&&this.map[0]?this.map[0].length:0,i=0;i<r;i++)for(t=0;t<u;t++)if(this.map[i][t].el===n)return{row:i,col:t};return!1},getElementAtIndex:function(n){return(this.setTableMap(),this.map[n.row]&&this.map[n.row][n.col]&&this.map[n.row][n.col].el)?this.map[n.row][n.col].el:null},getMapElsTo:function(n){var r=[],u,f,t,e,i,o;if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(n),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(u=this.idx_start,this.idx_start=this.idx_end,this.idx_end=u),this.idx_start.col>this.idx_end.col&&(f=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=f),this.idx_start!=null&&this.idx_end!=null)for(t=this.idx_start.row,e=this.idx_end.row;t<=e;t++)for(i=this.idx_start.col,o=this.idx_end.col;i<=o;i++)r.push(this.map[t][i].el);return r},orderSelectionEnds:function(n){var t,i;return this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(n),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(t=this.idx_start,this.idx_start=this.idx_end,this.idx_end=t),this.idx_start.col>this.idx_end.col&&(i=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=i),{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(n,t,i){for(var u,f=this.table.ownerDocument,e=f.createDocumentFragment(),r,o=0;o<t;o++){if(r=f.createElement(n),i)for(u in i)i.hasOwnProperty(u)&&r.setAttribute(u,i[u]);r.appendChild(document.createTextNode(" "));e.appendChild(r)}return e},correctColIndexForUnreals:function(n,t){for(var u=this.map[t],r=-1,i=0,f=n;i<n;i++)u[i].isReal&&r++;return r},getLastNewCellOnRow:function(n,t){for(var f=this.getRowCells(n),i,r,u=0,e=f.length;u<e;u++)if(i=f[u],r=this.getMapIndex(i),r===!1||typeof t!="undefined"&&r.row!=t)return i;return null},removeEmptyTable:function(){var n=this.table.querySelectorAll("td, th");return n&&n.length!=0?!1:(u(this.table),!0)},splitRowToCells:function(n){var i,u,f;n.isColspan&&(i=parseInt(t.getAttribute(n.el,"colspan")||1,10),u=n.el.tagName.toLowerCase(),i>1&&(f=this.createCells(u,i-1),r(n.el,f)),n.el.removeAttribute("colspan"))},getRealRowEl:function(n,i){var r=null,f=null,u,e;for(i=i||this.idx,u=0,e=this.map[i.row].length;u<e;u++)if(f=this.map[i.row][u],f.isReal&&(r=t.getParentElement(f.el,{nodeName:["TR"]}),r))return r;return r===null&&n&&(r=t.getParentElement(this.map[i.row][i.col].el,{nodeName:["TR"]})||null),r},injectRowAt:function(n,i,u,f,e){var o=this.getRealRowEl(!1,{row:n,col:i}),s=this.createCells(f,u),h,c;o?(h=this.correctColIndexForUnreals(i,n),h>=0?r(this.getRowCells(o)[h],s):o.insertBefore(s,o.firstChild)):(c=this.table.ownerDocument.createElement("tr"),c.appendChild(s),r(t.getParentElement(e.el,{nodeName:["TR"]}),c))},canMerge:function(n){var r,u,t,f,i,e;for(this.to=n,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(r=this.idx_start,this.idx_start=this.idx_end,this.idx_end=r),this.idx_start.col>this.idx_end.col&&(u=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=u),t=this.idx_start.row,f=this.idx_end.row;t<=f;t++)for(i=this.idx_start.col,e=this.idx_end.col;i<=e;i++)if(this.map[t][i].isColspan||this.map[t][i].isRowspan)return!1;return!0},decreaseCellSpan:function(n,i){var r=parseInt(t.getAttribute(n.el,i),10)-1;r>=1?n.el.setAttribute(i,r):(n.el.removeAttribute(i),i=="colspan"&&(n.isColspan=!1),i=="rowspan"&&(n.isRowspan=!1),n.firstCol=!0,n.lastCol=!0,n.firstRow=!0,n.lastRow=!0,n.isReal=!0)},removeSurplusLines:function(){var n,f,i,e,r,o,s,h;if(this.setTableMap(),this.map){for(i=0,e=this.map.length;i<e;i++){for(n=this.map[i],s=!0,r=0,o=n.length;r<o;r++)if(f=n[r],!(t.getAttribute(f.el,"rowspan")&&parseInt(t.getAttribute(f.el,"rowspan"),10)>1&&f.firstRow!==!0)){s=!1;break}if(s)for(r=0;r<o;r++)this.decreaseCellSpan(n[r],"rowspan")}for(h=this.getTableRows(),i=0,e=h.length;i<e;i++)n=h[i],n.childNodes.length==0&&/^\s*$/.test(n.textContent||n.innerText)&&u(n)}},fillMissingCells:function(){var e=0,o=0,u=null,i,n,t;if(this.setTableMap(),this.map){for(e=this.map.length,i=0;i<e;i++)this.map[i].length>o&&(o=this.map[i].length);for(n=0;n<e;n++)for(t=0;t<o;t++)this.map[n]&&!this.map[n][t]&&t>0&&(this.map[n][t]=new f(this.createCells("td",1)),u=this.map[n][t-1],u&&u.el&&u.el.parent&&r(this.map[n][t-1].el,this.map[n][t].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){var r,i,u;if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var n=this.map[this.idx.row][this.idx.col],f=t.getAttribute(n.el,"colspan")?parseInt(t.getAttribute(n.el,"colspan"),10):1,e=n.el.tagName.toLowerCase();if(n.isRowspan){if(r=parseInt(t.getAttribute(n.el,"rowspan"),10),r>1)for(i=1,u=r-1;i<=u;i++)this.injectRowAt(this.idx.row+i,this.idx.col,f,e,n);n.el.removeAttribute("rowspan")}this.splitRowToCells(n)}},merge:function(n){var r,f,t,e,i,o;if(this.rectify())if(this.canMerge(n)){for(r=this.idx_end.row-this.idx_start.row+1,f=this.idx_end.col-this.idx_start.col+1,t=this.idx_start.row,e=this.idx_end.row;t<=e;t++)for(i=this.idx_start.col,o=this.idx_end.col;i<=o;i++)t==this.idx_start.row&&i==this.idx_start.col?(r>1&&this.map[t][i].el.setAttribute("rowspan",r),f>1&&this.map[t][i].el.setAttribute("colspan",f)):(/^\s*<br\/?>\s*$/.test(this.map[t][i].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[t][i].el.innerHTML),u(this.map[t][i].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(n){var s=this.getMapIndex(n.el),u=s.row+1,f={row:u,col:s.col},i,e,o;u<this.map.length&&(i=this.getRealRowEl(!1,f),i!==null&&(e=this.correctColIndexForUnreals(f.col,f.row),e>=0?r(this.getRowCells(i)[e],n.el):(o=this.getLastNewCellOnRow(i,u),o!==null?r(o,n.el):i.insertBefore(n.el,i.firstChild)),parseInt(t.getAttribute(n.el,"rowspan"),10)>2?n.el.setAttribute("rowspan",parseInt(t.getAttribute(n.el,"rowspan"),10)-1):n.el.removeAttribute("rowspan")))},removeRowCell:function(n){n.isReal?n.isRowspan?this.collapseCellToNextRow(n):u(n.el):parseInt(t.getAttribute(n.el,"rowspan"),10)>2?n.el.setAttribute("rowspan",parseInt(t.getAttribute(n.el,"rowspan"),10)-1):n.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var i=[],t,n,r;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(t=this.map[this.idx.row],n=0,r=t.length;n<r;n++)t[n].isReal&&i.push(t[n].el);return i},getColumnElementsByCell:function(){var t=[],n,i;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(n=0,i=this.map.length;n<i;n++)this.map[n][this.idx.col]&&this.map[n][this.idx.col].isReal&&t.push(this.map[n][this.idx.col].el);return t},removeRow:function(){var r=t.getParentElement(this.cell,{nodeName:["TR"]}),i,n,f;if(r){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(i=this.map[this.idx.row],n=0,f=i.length;n<f;n++)i[n].modified||(this.setCellAsModified(i[n]),this.removeRowCell(i[n]));u(r)}},removeColCell:function(n){n.isColspan?parseInt(t.getAttribute(n.el,"colspan"),10)>2?n.el.setAttribute("colspan",parseInt(t.getAttribute(n.el,"colspan"),10)-1):n.el.removeAttribute("colspan"):n.isReal&&u(n.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var n=0,t=this.map.length;n<t;n++)this.map[n][this.idx.col].modified||(this.setCellAsModified(this.map[n][this.idx.col]),this.removeColCell(this.map[n][this.idx.col]))},remove:function(n){if(this.rectify()){switch(n){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(n){var s=this.table.ownerDocument,u,f,i,o,e;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),n=="below"&&t.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(t.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(u=this.map[this.idx.row],f=s.createElement("tr"),i=0,o=u.length;i<o;i++)u[i].modified||(this.setCellAsModified(u[i]),this.addRowCell(u[i],f,n));switch(n){case"below":r(this.getRealRowEl(!0),f);break;case"above":e=t.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]});e&&e.parentNode.insertBefore(f,e)}}},addRowCell:function(n,i,r){var u=n.isColspan?{colspan:t.getAttribute(n.el,"colspan")}:null;n.isReal?r!="above"&&n.isRowspan?n.el.setAttribute("rowspan",parseInt(t.getAttribute(n.el,"rowspan"),10)+1):i.appendChild(this.createCells("td",1,u)):r!="above"&&n.isRowspan&&n.lastRow?i.appendChild(this.createCells("td",1,u)):c.isRowspan&&n.el.attr("rowspan",parseInt(t.getAttribute(n.el,"rowspan"),10)+1)},add:function(n){this.rectify()&&((n=="below"||n=="above")&&this.addRow(n),(n=="before"||n=="after")&&this.addColumn(n))},addColCell:function(n,i,u){var f,e=n.el.tagName.toLowerCase();switch(u){case"before":f=!n.isColspan||n.firstCol;break;case"after":f=!n.isColspan||n.lastCol||n.isColspan&&c.el==this.cell}if(f){switch(u){case"before":n.el.parentNode.insertBefore(this.createCells(e,1),n.el);break;case"after":r(n.el,this.createCells(e,1))}n.isRowspan&&this.handleCellAddWithRowspan(n,i+1,u)}else n.el.setAttribute("colspan",parseInt(t.getAttribute(n.el,"colspan"),10)+1)},addColumn:function(n){var u,r,i,f;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),n=="after"&&t.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(t.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(i=0,f=this.map.length;i<f;i++)u=this.map[i],u[this.idx.col]&&(r=u[this.idx.col],r.modified||(this.setCellAsModified(r),this.addColCell(r,i,n)))},handleCellAddWithRowspan:function(n,i,u){for(var a=parseInt(t.getAttribute(this.cell,"rowspan"),10)-1,e=t.getParentElement(n.el,{nodeName:["TR"]}),h=n.el.tagName.toLowerCase(),f,s,v=this.table.ownerDocument,l,c=0;c<a;c++)if(f=this.correctColIndexForUnreals(this.idx.col,i+c),e=o(e,"tr"),e)if(f>0)switch(u){case"before":s=this.getRowCells(e);f>0&&this.map[i+c][this.idx.col].el!=s[f]&&f==s.length-1?r(s[f],this.createCells(h,1)):s[f].parentNode.insertBefore(this.createCells(h,1),s[f]);break;case"after":r(this.getRowCells(e)[f],this.createCells(h,1))}else e.insertBefore(this.createCells(h,1),e.firstChild);else l=v.createElement("tr"),l.appendChild(this.createCells(h,1)),this.table.appendChild(l)}};t.table={getCellsBetween:function(n,t){var r=new i(n);return r.getMapElsTo(t)},addCells:function(n,t){var r=new i(n);r.add(t)},removeCells:function(n,t){var r=new i(n);r.remove(t)},mergeCellsBetween:function(n,t){var r=new i(n);r.merge(t)},unmergeCell:function(n){var t=new i(n);t.unmerge()},orderSelectionEnds:function(n,t){var r=new i(n);return r.orderSelectionEnds(t)},indexOf:function(n){var t=new i(n);return t.setTableMap(),t.getMapIndex(n)},findCell:function(n,t){var r=new i(null,n);return r.getElementAtIndex(t)},findRowByCell:function(n){var t=new i(n);return t.getRowElementsByCell()},findColumnByCell:function(n){var t=new i(n);return t.getColumnElementsByCell()},canMerge:function(n,t){var r=new i(n);return r.canMerge(t)}}}(wysihtml5);wysihtml5.dom.query=function(n,t){var f=[],i,r,e,u;for(n.nodeType&&(n=[n]),r=0,e=n.length;r<e;r++)if(i=n[r].querySelectorAll(t),i)for(u=i.length;u--;f.unshift(i[u]));return f};wysihtml5.dom.compareDocumentPosition=function(){var n=document.documentElement;return n.compareDocumentPosition?function(n,t){return n.compareDocumentPosition(t)}:function(n,t){var e,o,u;if(e=n.nodeType===9?n:n.ownerDocument,o=t.nodeType===9?t:t.ownerDocument,n===t)return 0;if(n===t.ownerDocument)return 20;if(n.ownerDocument===t)return 10;if(e!==o)return 1;if(n.nodeType===2&&n.childNodes&&wysihtml5.lang.array(n.childNodes).indexOf(t)!==-1)return 20;if(t.nodeType===2&&t.childNodes&&wysihtml5.lang.array(t.childNodes).indexOf(n)!==-1)return 10;for(var i=n,r=[],f=null;i;){if(i==t)return 10;r.push(i);i=i.parentNode}for(i=t,f=null;i;){if(i==n)return 20;if(u=wysihtml5.lang.array(r).indexOf(i),u!==-1){var s=r[u],h=wysihtml5.lang.array(s.childNodes).indexOf(r[u-1]),c=wysihtml5.lang.array(s.childNodes).indexOf(f);return h>c?2:4}f=i;i=i.parentNode}return 1}}();wysihtml5.dom.unwrap=function(n){if(n.parentNode){while(n.lastChild)wysihtml5.dom.insert(n.lastChild).after(n);n.parentNode.removeChild(n)}};wysihtml5.dom.getPastedHtml=function(n){var t;return n.clipboardData&&(wysihtml5.lang.array(n.clipboardData.types).contains("text/html")?t=n.clipboardData.getData("text/html"):wysihtml5.lang.array(n.clipboardData.types).contains("text/plain")&&(t=wysihtml5.lang.string(n.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),t};wysihtml5.dom.getPastedHtmlWithDiv=function(n,t){var u=n.selection.getBookmark(),r=n.element.ownerDocument,i=r.createElement("DIV");r.body.appendChild(i);i.style.width="1px";i.style.height="1px";i.style.overflow="hidden";i.setAttribute("contenteditable","true");i.focus();setTimeout(function(){n.selection.setBookmark(u);t(i.innerHTML);i.parentNode.removeChild(i)},0)};wysihtml5.quirks.cleanPastedHTML=function(){var n=function(n){var t=wysihtml5.lang.string(n).trim(),i=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+i+"$).)*$","i")},t=function(t,i){var r=wysihtml5.lang.object(t).clone(!0),u,f;for(u in r.tags)if(r.tags.hasOwnProperty(u)&&r.tags[u].keep_styles)for(f in r.tags[u].keep_styles)r.tags[u].keep_styles.hasOwnProperty(f)&&i[f]&&(r.tags[u].keep_styles[f]=n(i[f]));return r},i=function(n,t){var r,i,u;if(!n)return null;for(i=0,u=n.length;i<u;i++)if(n[i].condition||(r=n[i].set),n[i].condition&&n[i].condition.test(t))return n[i].set;return r};return function(n,r){var u={color:wysihtml5.dom.getStyle("color").from(r.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(r.referenceNode)},f=t(i(r.rules,n)||{},u);return wysihtml5.dom.parse(n,{rules:f,cleanUp:!0,context:r.referenceNode.ownerDocument,uneditableClass:r.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}();wysihtml5.quirks.ensureProperClearing=function(){var n=function(){var n=this;setTimeout(function(){var t=n.innerHTML.toLowerCase();(t=="<p>&nbsp;<\/p>"||t=="<p>&nbsp;<\/p><p>&nbsp;<\/p>")&&(n.innerHTML="")},0)};return function(t){wysihtml5.dom.observe(t.element,["cut","keydown"],n)}}(),function(n){var t="%7E";n.quirks.getCorrectInnerHTML=function(i){var r=i.innerHTML,f,e,o,s,u;if(r.indexOf(t)===-1)return r;for(f=i.querySelectorAll("[href*='~'], [src*='~']"),u=0,s=f.length;u<s;u++)e=f[u].href||f[u].src,o=n.lang.string(e).replace("~").by(t),r=n.lang.string(r).replace(o).by(e);return r}}(wysihtml5),function(n){var t="wysihtml5-quirks-redraw";n.quirks.redraw=function(i){n.dom.addClass(i,t);n.dom.removeClass(i,t);try{var r=i.ownerDocument;r.execCommand("italic",!1,null);r.execCommand("italic",!1,null)}catch(u){}}}(wysihtml5);wysihtml5.quirks.tableCellsSelection=function(n,t){function c(){return r.observe(n,"mousedown",function(n){var t=wysihtml5.dom.getParentElement(n.target,{nodeName:["TD","TH"]});t&&l(t)}),i}function l(s){i.start=s;i.end=s;i.cells=[s];i.table=r.getParentElement(i.start,{nodeName:["TABLE"]});i.table&&(f(),r.addClass(s,u),e=r.observe(n,"mousemove",a),o=r.observe(n,"mouseup",v),t.fire("tableselectstart").fire("tableselectstart:composer"))}function f(){var t,i;if(n&&(t=n.querySelectorAll("."+u),t.length>0))for(i=0;i<t.length;i++)r.removeClass(t[i],u)}function s(n){for(var t=0;t<n.length;t++)r.addClass(n[t],u)}function a(n){var e=null,u=r.getParentElement(n.target,{nodeName:["TD","TH"]}),o;u&&i.table&&i.start&&(e=r.getParentElement(u,{nodeName:["TABLE"]}),e&&e===i.table&&(f(),o=i.end,i.end=u,i.cells=r.table.getCellsBetween(i.start,u),i.cells.length>1&&t.composer.selection.deselect(),s(i.cells),i.end!==o&&t.fire("tableselectchange").fire("tableselectchange:composer")))}function v(){e.stop();o.stop();t.fire("tableselect").fire("tableselect:composer");setTimeout(function(){h()},0)}function h(){var u=r.observe(n.ownerDocument,"click",function(n){u.stop();r.getParentElement(n.target,{nodeName:["TABLE"]})!=i.table&&(f(),i.table=null,i.start=null,i.end=null,t.fire("tableunselect").fire("tableunselect:composer"))})}function y(n,u){i.start=n;i.end=u;i.table=r.getParentElement(i.start,{nodeName:["TABLE"]});selectedCells=r.table.getCellsBetween(i.start,i.end);s(selectedCells);h();t.fire("tableselect").fire("tableselect:composer")}var r=wysihtml5.dom,i={table:null,start:null,end:null,cells:null,select:y},u="wysiwyg-tmp-selected-cell",e=null,o=null;return c()},function(n){var t=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,i=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,r=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,u=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,f=function(n){return new RegExp("(^|\\s|;)"+n+"\\s*:\\s*[^;$]+","gi")};n.quirks.styleParser={parseColor:function(e,o){var v=f(o),c=e.match(v),a=10,h,s,l;if(c){for(l=c.length;l--;)c[l]=n.lang.string(c[l].split(":")[1]).trim();if(h=c[c.length-1],t.test(h))s=h.match(t);else if(i.test(h))s=h.match(i);else if(r.test(h))s=h.match(r),a=16;else if(u.test(h))return s=h.match(u),s.shift(),s.push(1),n.lang.array(s).map(function(n,t){return t<3?parseInt(n,16)*16+parseInt(n,16):parseFloat(n)});if(s)return s.shift(),s[3]||s.push(1),n.lang.array(s).map(function(n,t){return t<3?parseInt(n,a):parseFloat(n)})}return!1},unparseColor:function(n,t){if(t){if(t=="hex")return n[0].toString(16).toUpperCase()+n[1].toString(16).toUpperCase()+n[2].toString(16).toUpperCase();if(t=="hash")return"#"+n[0].toString(16).toUpperCase()+n[1].toString(16).toUpperCase()+n[2].toString(16).toUpperCase();if(t=="rgb")return"rgb("+n[0]+","+n[1]+","+n[2]+")";if(t=="rgba")return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")";if(t=="csv")return n[0]+","+n[1]+","+n[2]+","+n[3]}return n[3]&&n[3]!==1?"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")":"rgb("+n[0]+","+n[1]+","+n[2]+")"},parseFontSize:function(t){var i=t.match(f("font-size"));return i?n.lang.string(i[i.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(n){function u(n){var t=0;if(n.parentNode)do t+=n.offsetTop||0,n=n.offsetParent;while(n);return t}function i(n,t){for(var i=0;t!==n;)if(i++,t=t.parentNode,!t)throw new Error("not a descendant of ancestor!");return i}function r(n){if(!n.canSurroundContents())for(var t=n.commonAncestorContainer,r=i(t,n.startContainer),u=i(t,n.endContainer);!n.canSurroundContents();)r>u?(n.setStartBefore(n.startContainer),r=i(t,n.startContainer)):(n.setEndAfter(n.endContainer),u=i(t,n.endContainer))}var t=n.dom;n.Selection=Base.extend({constructor:function(n,t,i){window.rangy.init();this.editor=n;this.composer=n.composer;this.doc=this.composer.doc;this.contain=t;this.unselectableClass=i||!1},getBookmark:function(){var n=this.getRange();return n&&r(n),n&&n.cloneRange()},setBookmark:function(n){n&&this.setSelection(n)},setBefore:function(n){var t=rangy.createRange(this.doc);return t.setStartBefore(n),t.setEndBefore(n),this.setSelection(t)},setAfter:function(n){var t=rangy.createRange(this.doc);return t.setStartAfter(n),t.setEndAfter(n),this.setSelection(t)},selectNode:function(i,r){var u=rangy.createRange(this.doc),e=i.nodeType===n.ELEMENT_NODE,f="canHaveHTML"in i?i.canHaveHTML:i.nodeName!=="IMG",s=e?i.innerHTML:i.data,o=s===""||s===n.INVISIBLE_SPACE,h=t.getStyle("display").from(i),c=h==="block"||h==="list-item";if(o&&e&&f&&!r)try{i.innerHTML=n.INVISIBLE_SPACE}catch(l){}f?u.selectNodeContents(i):u.selectNode(i);f&&o&&e?u.collapse(c):f&&o&&(u.setStartAfter(i),u.setEndAfter(i));this.setSelection(u)},getSelectedNode:function(n){var i,t;return n&&this.doc.selection&&this.doc.selection.type==="Control"&&(t=this.doc.selection.createRange(),t&&t.length)?t.item(0):(i=this.getSelection(this.doc),i.focusNode===i.anchorNode?i.focusNode:(t=this.getRange(this.doc),t?t.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var n=this.getRange();r(n);this.setSelection(n)},getSelectedOwnNodes:function(){for(var t=this.getOwnRanges(),i=[],n=0,r=t.length;n<r;n++)i.push(t[n].commonAncestorContainer||this.doc.body);return i},findNodesInSelection:function(t){for(var u=this.getOwnRanges(),i=[],f,r=0,e=u.length;r<e;r++)f=u[r].getNodes([1],function(i){return n.lang.array(t).contains(i.nodeName)}),i=i.concat(f);return i},containsUneditable:function(){for(var t=this.getOwnUneditables(),i=this.getSelection(),n=0,r=t.length;n<r;n++)if(i.containsNode(t[n]))return!0;return!1},deleteContents:function(){for(var n=this.getOwnRanges(),t=n.length;t--;)n[t].deleteContents();this.setSelection(n[0])},getPreviousNode:function(t,i){var f,r,u;return(t||(f=this.getSelection(),t=f.anchorNode),t===this.contain)?!1:(r=t.previousSibling,r===this.contain)?!1:(r&&r.nodeType!==3&&r.nodeType!==1?r=this.getPreviousNode(r,i):r&&r.nodeType===3&&/^\s*$/.test(r.textContent)?r=this.getPreviousNode(r,i):i&&r&&r.nodeType===1&&!n.lang.array(["BR","HR","IMG"]).contains(r.nodeName)&&/^[\s]*$/.test(r.innerHTML)?r=this.getPreviousNode(r,i):r||t===this.contain||(u=t.parentNode,u!==this.contain&&(r=this.getPreviousNode(u,i))),r!==this.contain?r:!1)},getSelectionParentsByTag:function(){for(var i=this.getSelectedOwnNodes(),r,u=[],t=0,f=i.length;t<f;t++)r=i[t].nodeName&&i[t].nodeName==="LI"?i[t]:n.dom.getParentElement(i[t],{nodeName:["LI"]},!1,this.contain),r&&u.push(r);return u.length?u:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var t=this.getRange(),i=t.startContainer,r=t.startOffset,n=rangy.createRange(this.doc);return n.selectNodeContents(i),n.setStart(i,r),n}},caretIsLastInSelection:function(){var i=rangy.createRange(this.doc),r=this.getSelection(),n=this.getRangeToNodeEnd().cloneContents(),t=n.textContent;return/^\s*$/.test(t)},caretIsFirstInSelection:function(){var t=rangy.createRange(this.doc),i=this.getSelection(),u=this.getRange(),r=u.startContainer;return r.nodeType===n.TEXT_NODE?this.isCollapsed()&&r.nodeType===n.TEXT_NODE&&/^\s*$/.test(r.data.substr(0,u.startOffset)):(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===i.anchorNode||t.endContainer===i.anchorNode)&&t.startOffset===i.anchorOffset)},caretIsInTheBeginnig:function(t){var r=this.getSelection(),i=r.anchorNode,u=r.anchorOffset;return t?u===0&&(i.nodeName&&i.nodeName===t.toUpperCase()||n.dom.getParentElement(i.parentNode,{nodeName:t},1)):u===0&&!this.getPreviousNode(i,!0)},caretIsBeforeUneditable:function(){var r=this.getSelection(),f=r.anchorNode,e=r.anchorOffset,i,t,n,u;if(e===0&&(i=this.getPreviousNode(f,!0),i))for(t=this.getOwnUneditables(),n=0,u=t.length;n<u;n++)if(i===t[n])return t[n];return!1},executeAndRestoreRangy:function(n){var i=this.doc.defaultView||this.doc.parentWindow,t=rangy.saveSelection(i);if(t)try{n()}catch(r){setTimeout(function(){throw r;},0)}else n();rangy.restoreSelection(t)},executeAndRestore:function(i,r){var e=this.doc.body,b=r&&e.scrollTop,k=r&&e.scrollLeft,l="_wysihtml5-temp-placeholder",p='<span class="'+l+'">'+n.INVISIBLE_SPACE+"<\/span>",f=this.getRange(!0),u,h,a,v,w,y,s,o,c;if(!f){i(e,e);return}f.collapsed||(s=f.cloneRange(),y=s.createContextualFragment(p),s.collapse(!1),s.insertNode(y),s.detach());w=f.createContextualFragment(p);f.insertNode(w);y&&(u=this.contain.querySelectorAll("."+l),f.setStartBefore(u[0]),f.setEndAfter(u[u.length-1]));this.setSelection(f);try{i(f.startContainer,f.endContainer)}catch(d){setTimeout(function(){throw d;},0)}if(u=this.contain.querySelectorAll("."+l),u&&u.length)for(o=rangy.createRange(this.doc),a=u[0].nextSibling,u.length>1&&(v=u[u.length-1].previousSibling),v&&a?(o.setStartBefore(a),o.setEndAfter(v)):(h=this.doc.createTextNode(n.INVISIBLE_SPACE),t.insert(h).after(u[0]),o.setStartBefore(h),o.setEndAfter(h)),this.setSelection(o),c=u.length;c--;)u[c].parentNode.removeChild(u[c]);else this.contain.focus();r&&(e.scrollTop=b,e.scrollLeft=k);try{u.parentNode.removeChild(u)}catch(g){}},set:function(n,t){var i=rangy.createRange(this.doc);i.setStart(n,t||0);this.setSelection(i)},insertHTML:function(n){var u=rangy.createRange(this.doc),t=this.doc.createElement("DIV"),r=this.doc.createDocumentFragment(),i;for(t.innerHTML=n,i=t.lastChild;t.firstChild;)r.appendChild(t.firstChild);this.insertNode(r);i&&this.setAfter(i)},insertNode:function(n){var t=this.getRange();t&&t.insertNode(n)},surround:function(n){var i=this.getOwnRanges(),t,u=[],r;if(i.length==0)return u;for(r=i.length;r--;){t=this.doc.createElement(n.nodeName);u.push(t);n.className&&(t.className=n.className);n.cssStyle&&t.setAttribute("style",n.cssStyle);try{i[r].surroundContents(t);this.selectNode(t)}catch(f){t.appendChild(i[r].extractContents());i[r].insertNode(t)}}return u},deblockAndSurround:function(t){var r=this.doc.createElement("div"),e=rangy.createRange(this.doc),u,f,i;if(r.className=t.className,this.composer.commands.exec("formatBlock",t.nodeName,t.className),u=this.contain.querySelectorAll("."+t.className),u[0])for(u[0].parentNode.insertBefore(r,u[0]),e.setStartBefore(u[0]),e.setEndAfter(u[u.length-1]),f=e.extractContents();f.firstChild;)if(i=f.firstChild,i.nodeType==1&&n.dom.hasClass(i,t.className)){while(i.firstChild)r.appendChild(i.firstChild);i.nodeName!=="BR"&&r.appendChild(this.doc.createElement("br"));f.removeChild(i)}else r.appendChild(i);else r=null;return r},scrollIntoView:function(){var t=this.doc,f=t.documentElement.scrollHeight>t.documentElement.offsetHeight,i=t._wysihtml5ScrollIntoViewElement=t._wysihtml5ScrollIntoViewElement||function(){var i=t.createElement("span");return i.innerHTML=n.INVISIBLE_SPACE,i}(),r;f&&(this.insertNode(i),r=u(i),i.parentNode.removeChild(i),r>=t.body.scrollTop+t.documentElement.offsetHeight-5&&(t.body.scrollTop=r))},selectLine:function(){n.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var t=this.doc.defaultView,n=t.getSelection();n.modify("move","left","lineboundary");n.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var n=this.doc.selection.createRange(),t=n.boundingTop,e=this.doc.body.scrollWidth,o,f,i,r,u;if(n.moveToPoint){for(t===0&&(i=this.doc.createElement("span"),this.insertNode(i),t=i.offsetTop,i.parentNode.removeChild(i)),t+=1,r=-10;r<e;r+=2)try{n.moveToPoint(r,t);break}catch(s){}for(o=t,f=this.doc.selection.createRange(),u=e;u>=0;u--)try{f.moveToPoint(u,o);break}catch(h){}n.setEndPoint("EndToEnd",f);n.select()}},getText:function(){var n=this.getSelection();return n?n.toString():""},getNodes:function(n,t){var i=this.getRange();return i?i.getNodes([n],t):[]},fixRangeOverflow:function(n){var t,i;this.contain&&this.contain.firstChild&&n&&(t=n.compareNode(this.contain),t!==2?(t===1&&n.setStartBefore(this.contain.firstChild),t===0&&n.setEndAfter(this.contain.lastChild),t===3&&(n.setStartBefore(this.contain.firstChild),n.setEndAfter(this.contain.lastChild))):this._detectInlineRangeProblems(n)&&(i=n.endContainer.previousElementSibling,i&&n.setEnd(i,this._endOffsetForNode(i))))},_endOffsetForNode:function(n){var t=document.createRange();return t.selectNodeContents(n),t.endOffset},_detectInlineRangeProblems:function(n){var i=t.compareDocumentPosition(n.startContainer,n.endContainer);return n.endOffset==0&&i&4},getRange:function(n){var t=this.getSelection(),i=t&&t.rangeCount&&t.getRangeAt(0);return n!==!0&&this.fixRangeOverflow(i),i},getOwnUneditables:function(){var i=t.query(this.contain,"."+this.unselectableClass),r=t.query(i,"."+this.unselectableClass);return n.lang.array(i).without(r)},getOwnRanges:function(){var n=[],e=this.getRange(),f,i,r,u,o,t,s;if(e&&n.push(e),this.unselectableClass&&this.contain&&e&&(i=this.getOwnUneditables(),i.length>0))for(u=0,o=i.length;u<o;u++)for(f=[],t=0,s=n.length;t<s;t++){if(n[t])switch(n[t].compareNode(i[u])){case 2:break;case 3:r=n[t].cloneRange();r.setEndBefore(i[u]);f.push(r);r=n[t].cloneRange();r.setStartAfter(i[u]);f.push(r);break;default:f.push(n[t])}n=f}return n},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(n){var t=this.doc.defaultView||this.doc.parentWindow,i=rangy.getSelection(t);return i.setSingleRange(n)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(t){var f=this.getRange(),i=f.commonAncestorContainer,r=f.startContainer,u=f.endContainer;if((i.nodeType===n.TEXT_NODE&&(i=i.parentNode),r.nodeType===n.TEXT_NODE&&!/^\s*$/.test(r.data.substr(f.startOffset)))||u.nodeType===n.TEXT_NODE&&!/^\s*$/.test(u.data.substr(f.endOffset)))return!1;while(r&&r!==i){if(r.nodeType!==n.TEXT_NODE&&!n.dom.contains(i,r)||n.dom.domNode(r).prev({ignoreBlankTexts:!0}))return!1;r=r.parentNode}while(u&&u!==i){if(u.nodeType!==n.TEXT_NODE&&!n.dom.contains(i,u)||n.dom.domNode(u).next({ignoreBlankTexts:!0}))return!1;u=u.parentNode}return n.lang.array(t).contains(i.nodeName)?i:!1},deselect:function(){var n=this.getSelection();n&&n.removeAllRanges()}})}(wysihtml5),function(n,t){function v(n,t,i){if(!n.className)return!1;var r=n.className.match(i)||[];return r[r.length-1]===t}function y(n,t){if(!n.getAttribute||!n.getAttribute("style"))return!1;var i=n.getAttribute("style").match(t);return n.getAttribute("style").match(t)?!0:!1}function f(n,t,i){n.getAttribute("style")?(o(n,i),n.getAttribute("style")&&!/^\s*$/.test(n.getAttribute("style"))?n.setAttribute("style",t+";"+n.getAttribute("style")):n.setAttribute("style",t)):n.setAttribute("style",t)}function p(n,t,i){n.className?(e(n,i),n.className+=" "+t):n.className=t}function e(n,t){n.className&&(n.className=n.className.replace(t,""))}function o(n,t){var i,u=[],r;if(n.getAttribute("style")){for(i=n.getAttribute("style").split(";"),r=i.length;r--;)i[r].match(t)||/^\s*$/.test(i[r])||u.push(i[r]);u.length?n.setAttribute("style",u.join(";")):n.removeAttribute("style")}}function s(n,t){var i=[],e=t.split(";"),u=n.getAttribute("style"),f,r,o;if(u){for(u=u.replace(/\s/gi,"").toLowerCase(),i.push(new RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi")),f=e.length;f-->0;)/^\s*$/.test(e[f])||i.push(new RegExp("(^|\\s|;)"+e[f].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(r=0,o=i.length;r<o;r++)if(u.match(i[r]))return i[r]}return!1}function w(i,r,u,f){return u?s(i,u):f?n.dom.hasClass(i,f):t.dom.arrayContains(r,i.tagName.toLowerCase())}function h(n,t,i,r){for(var u=n.length;u--;)if(!w(n[u],t,i,r))return!1;return n.length?!0:!1}function b(n,t,i){var r=s(n,t);return r?(o(n,r),"remove"):(f(n,t,i),"change")}function k(n,t){return n.className.replace(u," ")==t.className.replace(u," ")}function d(n){for(var t=n.parentNode;n.firstChild;)t.insertBefore(n.firstChild,n);t.removeChild(n)}function g(n,t){if(n.attributes.length!=t.attributes.length)return!1;for(var r=0,e=n.attributes.length,i,u,f;r<e;++r)if(i=n.attributes[r],f=i.name,f!="class"&&((u=t.attributes.getNamedItem(f),i.specified!=u.specified)||i.specified&&i.nodeValue!==u.nodeValue))return!1;return!0}function c(n,i){return t.dom.isCharacterDataNode(n)?i==0?!!n.previousSibling:i==n.length?!!n.nextSibling:!0:i>0&&i<n.childNodes.length}function i(n,r,u,f){var e,o;if(t.dom.isCharacterDataNode(r)&&(u==0?(u=t.dom.getNodeIndex(r),r=r.parentNode):u==r.length?(u=t.dom.getNodeIndex(r)+1,r=r.parentNode):e=t.dom.splitDataNode(r,u)),!e&&(!f||r!==f)){for(e=r.cloneNode(!1),e.id&&e.removeAttribute("id");o=r.childNodes[u];)e.appendChild(o);t.dom.insertAfter(e,r)}return r==n?e:i(n,e.parentNode,t.dom.getNodeIndex(e),f)}function r(t){this.isElementMerge=t.nodeType==n.ELEMENT_NODE;this.firstTextNode=this.isElementMerge?t.lastChild:t;this.textNodes=[this.firstTextNode]}function l(n,t,i,r,u,f,e){this.tagNames=n||[a];this.cssClass=t||(t===!1?!1:"");this.similarClassRegExp=i;this.cssStyle=u||"";this.similarStyleRegExp=f;this.normalize=r;this.applyToAnyTagName=!1;this.container=e}var a="span",u=/\s+/g;r.prototype={doMerge:function(){for(var r=[],i,n,u,t=0,f=this.textNodes.length;t<f;++t)i=this.textNodes[t],n=i.parentNode,r[t]=i.data,t&&(n.removeChild(i),n.hasChildNodes()||n.parentNode.removeChild(n));return this.firstTextNode.data=u=r.join(""),u},getLength:function(){for(var n=this.textNodes.length,t=0;n--;)t+=this.textNodes[n].length;return t},toString:function(){for(var t=[],n=0,i=this.textNodes.length;n<i;++n)t[n]="'"+this.textNodes[n].data+"'";return"[Merge("+t.join(",")+")]"}};l.prototype={getAncestorWithClass:function(i){for(var r;i;){if(r=this.cssClass?v(i,this.cssClass,this.similarClassRegExp):this.cssStyle!==""?!1:!0,i.nodeType==n.ELEMENT_NODE&&i.getAttribute("contenteditable")!="false"&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&r)return i;i=i.parentNode}return!1},getAncestorWithStyle:function(i){for(var r;i;){if(r=this.cssStyle?y(i,this.similarStyleRegExp):!1,i.nodeType==n.ELEMENT_NODE&&i.getAttribute("contenteditable")!="false"&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&r)return i;i=i.parentNode}return!1},getMatchingAncestor:function(n){var t=this.getAncestorWithClass(n),i=!1;return t?this.cssStyle&&(i="class"):(t=this.getAncestorWithStyle(n),t&&(i="style")),{element:t,type:i}},postApply:function(n,t){for(var l,a=n[0],u=n[n.length-1],o=[],i,h=a,v=u,y=0,p=u.length,f,s,e=0,c=n.length;e<c;++e)f=n[e],s=null,f&&f.parentNode&&(s=this.getAdjacentMergeableTextNode(f.parentNode,!1)),s?(i||(i=new r(s),o.push(i)),i.textNodes.push(f),f===a&&(h=i.firstTextNode,y=h.length),f===u&&(v=i.firstTextNode,p=i.getLength())):i=null;if(u&&u.parentNode&&(l=this.getAdjacentMergeableTextNode(u.parentNode,!0),l&&(i||(i=new r(u),o.push(i)),i.textNodes.push(l))),o.length){for(e=0,c=o.length;e<c;++e)o[e].doMerge();t.setStart(h,y);t.setEnd(v,p)}},getAdjacentMergeableTextNode:function(t,i){var u=t.nodeType==n.TEXT_NODE,e=u?t.parentNode:t,r,f=i?"nextSibling":"previousSibling";if(u){if(r=t[f],r&&r.nodeType==n.TEXT_NODE)return r}else if(r=e[f],r&&this.areElementsMergeable(t,r))return r[i?"firstChild":"lastChild"];return null},areElementsMergeable:function(n,i){return t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase())&&k(n,i)&&g(n,i)},createContainer:function(n){var t=n.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(n){var i=n.parentNode,r;i.childNodes.length==1&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())?(this.cssClass&&p(i,this.cssClass,this.similarClassRegExp),this.cssStyle&&f(i,this.cssStyle,this.similarStyleRegExp)):(r=this.createContainer(t.dom.getDocument(n)),n.parentNode.insertBefore(r,n),r.appendChild(n))},isRemovable:function(i){return t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&n.lang.string(i.className).trim()===""&&(!i.getAttribute("style")||n.lang.string(i.getAttribute("style")).trim()==="")},undoToTextNode:function(n,t,r,u){var s=r?!1:!0,f=r||u,h=!1,o;t.containsNode(f)||(o=t.cloneRange(),o.selectNode(f),o.isPointInRange(t.endContainer,t.endOffset)&&c(t.endContainer,t.endOffset)&&(i(f,t.endContainer,t.endOffset,this.container),t.setEndAfter(f)),o.isPointInRange(t.startContainer,t.startOffset)&&c(t.startContainer,t.startOffset)&&(f=i(f,t.startContainer,t.startOffset,this.container)));!s&&this.similarClassRegExp&&e(f,this.similarClassRegExp);s&&this.similarStyleRegExp&&(h=b(f,this.cssStyle,this.similarStyleRegExp)==="change");this.isRemovable(f)&&!h&&d(f)},applyToRange:function(t){for(var e,u,f,o,i,r=t.length;r--;){if(i=t[r].getNodes([n.TEXT_NODE]),!i.length)try{e=this.createContainer(t[r].endContainer.ownerDocument);t[r].surroundContents(e);this.selectNode(t[r],e);return}catch(s){}if(t[r].splitBoundaries(),i=t[r].getNodes([n.TEXT_NODE]),i.length){for(f=0,o=i.length;f<o;++f)u=i[f],this.getMatchingAncestor(u).element||this.applyToTextNode(u);t[r].setStart(i[0],0);u=i[i.length-1];t[r].setEnd(u,u.length);this.normalize&&this.postApply(i,t[r])}}},undoToRange:function(t){for(var h,e,o,s,r,u,f,i=t.length;i--;){for(r=t[i].getNodes([n.TEXT_NODE]),r.length?(t[i].splitBoundaries(),r=t[i].getNodes([n.TEXT_NODE])):(h=t[i].endContainer.ownerDocument,e=h.createTextNode(n.INVISIBLE_SPACE),t[i].insertNode(e),t[i].selectNode(e),r=[e]),o=0,s=r.length;o<s;++o)t[i].isValid()&&(u=r[o],f=this.getMatchingAncestor(u),f.type==="style"?this.undoToTextNode(u,t[i],!1,f.element):f.element&&this.undoToTextNode(u,t[i],f.element));s==1?this.selectNode(t[i],r[0]):(t[i].setStart(r[0],0),u=r[r.length-1],t[i].setEnd(u,u.length),this.normalize&&this.postApply(r,t[i]))}},selectNode:function(t,i){var r=i.nodeType===n.ELEMENT_NODE,e="canHaveHTML"in i?i.canHaveHTML:!0,f=r?i.innerHTML:i.data,u=f===""||f===n.INVISIBLE_SPACE;if(u&&r&&e)try{i.innerHTML=n.INVISIBLE_SPACE}catch(o){}t.selectNodeContents(i);u&&r?t.collapse(!1):u&&(t.setStartAfter(i),t.setEndAfter(i))},getTextSelectedByRange:function(n,t){var i=t.cloneRange(),r,u;return i.selectNodeContents(n),r=i.intersection(t),u=r?r.toString():"",i.detach(),u},isAppliedToRange:function(t){for(var f,s,h,o=[],r="full",i,u,e=t.length;e--;){if(u=t[e].getNodes([n.TEXT_NODE]),!u.length)return i=this.getMatchingAncestor(t[e].startContainer).element,i?{elements:[i],coverage:r}:!1;for(f=0,s=u.length;f<s;++f)h=this.getTextSelectedByRange(u[f],t[e]),i=this.getMatchingAncestor(u[f]).element,i&&h!=""?(o.push(i),n.dom.getTextNodes(i,!0).length===1?r="full":r==="full"&&(r="inline")):i||(r="partial")}return o.length?{elements:o,coverage:r}:!1},toggleRange:function(n){var t=this.isAppliedToRange(n),i;t?t.coverage==="full"?this.undoToRange(n):t.coverage==="inline"?(i=h(t.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(n),i||this.applyToRange(n)):(h(t.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(n),this.applyToRange(n)):this.applyToRange(n)}};n.selection.HTMLApplier=l}(wysihtml5,rangy);wysihtml5.Commands=Base.extend({constructor:function(n){this.editor=n;this.composer=n.composer;this.doc=this.composer.doc},support:function(n){return wysihtml5.browser.supportsCommand(this.doc,n)},exec:function(n,t){var i=wysihtml5.commands[n],u=wysihtml5.lang.array(arguments).get(),f=i&&i.exec,r=null;if(this.editor.fire("beforecommand:composer"),f)u.unshift(this.composer),r=f.apply(i,u);else try{r=this.doc.execCommand(n,!1,t)}catch(e){}return this.editor.fire("aftercommand:composer"),r},state:function(n){var t=wysihtml5.commands[n],i=wysihtml5.lang.array(arguments).get(),r=t&&t.state;if(r)return i.unshift(this.composer),r.apply(t,i);try{return this.doc.queryCommandState(n)}catch(u){return!1}},stateValue:function(n){var t=wysihtml5.commands[n],i=wysihtml5.lang.array(arguments).get(),r=t&&t.stateValue;return r?(i.unshift(this.composer),r.apply(t,i)):!1}});wysihtml5.commands.bold={exec:function(n,t){wysihtml5.commands.formatInline.execWithToggle(n,t,"b")},state:function(n,t){return wysihtml5.commands.formatInline.state(n,t,"b")}},function(n){function u(u,f){var y=u.doc,p="_wysihtml5-temp-"+ +new Date,s=0,h,c,e,w,b,l,a,v,o;for(n.commands.formatInline.exec(u,t,r,p,/non-matching-class/g,t,t,!0,!0),c=y.querySelectorAll(r+"."+p),h=c.length;s<h;s++){e=c[s];e.removeAttribute("class");for(o in f)o!=="text"&&e.setAttribute(o,f[o])}l=e;h===1&&(a=i.getTextContent(e),w=!!e.querySelector("*"),b=a===""||a===n.INVISIBLE_SPACE,!w&&b&&(i.setTextContent(e,f.text||e.href),v=y.createTextNode(" "),u.selection.setAfter(e),i.insert(v).after(e),l=v));u.selection.setAfter(l)}function f(n,t,i){for(var e,u,f,r=t.length;r--;){for(f=t[r].attributes,e=f.length;e--;)t[r].removeAttribute(f.item(e).name);for(u in i)i.hasOwnProperty(u)&&t[r].setAttribute(u,i[u])}}var t,r="A",i=n.dom;n.commands.createLink={exec:function(n,t,i){var r=this.state(n,t);r?n.selection.executeAndRestore(function(){f(n,r,i)}):(i=typeof i=="object"?i:{href:i},u(n,i))},state:function(t,i){return n.commands.formatInline.state(t,i,"A")}}}(wysihtml5),function(n){function i(n,i){for(var o=i.length,u=0,r,f,e;u<o;u++)r=i[u],f=t.getParentElement(r,{nodeName:"code"}),e=t.getTextContent(r),e.match(t.autoLink.URL_REG_EXP)&&!f?f=t.renameElement(r,"code"):t.replaceWithChildNodes(r)}var t=n.dom;n.commands.removeLink={exec:function(n,t){var r=this.state(n,t);r&&n.selection.executeAndRestore(function(){i(n,r)})},state:function(t,i){return n.commands.formatInline.state(t,i,"A")}}}(wysihtml5),function(n){var t=/wysiwyg-font-size-[0-9a-z\-]+/g;n.commands.fontSize={exec:function(i,r,u){n.commands.formatInline.execWithToggle(i,r,"span","wysiwyg-font-size-"+u,t)},state:function(i,r,u){return n.commands.formatInline.state(i,r,"span","wysiwyg-font-size-"+u,t)}}}(wysihtml5),function(n){var t=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;n.commands.fontSizeStyle={exec:function(i,r,u){u=typeof u=="object"?u.size:u;/^\s*$/.test(u)||n.commands.formatInline.execWithToggle(i,r,"span",!1,!1,"font-size:"+u,t)},state:function(i,r){return n.commands.formatInline.state(i,r,"span",!1,!1,"font-size",t)},stateValue:function(t,i){var r=this.state(t,i),u;return(r&&n.lang.object(r).isArray()&&(r=r[0]),r&&(u=r.getAttribute("style"),u))?n.quirks.styleParser.parseFontSize(u):!1}}}(wysihtml5),function(n){var t=/wysiwyg-color-[0-9a-z]+/g;n.commands.foreColor={exec:function(i,r,u){n.commands.formatInline.execWithToggle(i,r,"span","wysiwyg-color-"+u,t)},state:function(i,r,u){return n.commands.formatInline.state(i,r,"span","wysiwyg-color-"+u,t)}}}(wysihtml5),function(n){var t=/(\s|^)color\s*:\s*[^;\s]+;?/gi;n.commands.foreColorStyle={exec:function(i,r,u){var f=n.quirks.styleParser.parseColor(typeof u=="object"?"color:"+u.color:"color:"+u,"color"),e;f&&(e="color: rgb("+f[0]+","+f[1]+","+f[2]+");",f[3]!==1&&(e+="color: rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+");"),n.commands.formatInline.execWithToggle(i,r,"span",!1,!1,e,t))},state:function(i,r){return n.commands.formatInline.state(i,r,"span",!1,!1,"color",t)},stateValue:function(t,i,r){var u=this.state(t,i),f;return(u&&n.lang.object(u).isArray()&&(u=u[0]),u&&(f=u.getAttribute("style"),f&&f))?(val=n.quirks.styleParser.parseColor(f,"color"),n.quirks.styleParser.unparseColor(val,r)):!1}}}(wysihtml5),function(n){var t=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;n.commands.bgColorStyle={exec:function(i,r,u){var f=n.quirks.styleParser.parseColor(typeof u=="object"?"background-color:"+u.color:"background-color:"+u,"background-color"),e;f&&(e="background-color: rgb("+f[0]+","+f[1]+","+f[2]+");",f[3]!==1&&(e+="background-color: rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+");"),n.commands.formatInline.execWithToggle(i,r,"span",!1,!1,e,t))},state:function(i,r){return n.commands.formatInline.state(i,r,"span",!1,!1,"background-color",t)},stateValue:function(t,i,r){var u=this.state(t,i),f,e=!1;return(u&&n.lang.object(u).isArray()&&(u=u[0]),u&&(f=u.getAttribute("style"),f))?(e=n.quirks.styleParser.parseColor(f,"background-color"),n.quirks.styleParser.unparseColor(e,r)):!1}}}(wysihtml5),function(n){function f(t,i,u){t.className?(r(t,u),t.className=n.lang.string(t.className+" "+i).trim()):t.className=i}function e(t,i,r){u(t,r);t.getAttribute("style")?t.setAttribute("style",n.lang.string(t.getAttribute("style")+" "+i).trim()):t.setAttribute("style",i)}function r(t,i){var r=i.test(t.className);return t.className=t.className.replace(i,""),n.lang.string(t.className).trim()==""&&t.removeAttribute("class"),r}function u(t,i){var r=i.test(t.getAttribute("style"));return t.setAttribute("style",(t.getAttribute("style")||"").replace(i,"")),n.lang.string(t.getAttribute("style")||"").trim()==""&&t.removeAttribute("style"),r}function o(n){var t=n.lastChild;t&&s(t)&&t.parentNode.removeChild(t)}function s(n){return n.nodeName==="BR"}function h(t,i){var u,r,f;for(t.selection.isCollapsed()&&t.selection.selectLine(),u=t.selection.surround(i),r=0,f=u.length;r<f;r++)n.dom.lineBreaks(u[r]).remove(),o(u[r])}function c(t){return!!n.lang.string(t.className).trim()}function l(t){return!!n.lang.string(t.getAttribute("style")||"").trim()}var t=n.dom,i=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];n.commands.formatBlock={exec:function(o,s,a,v,y,p,w){var ut=o.doc,b=this.state(o,s,a,v,y,p,w),nt=o.config.useLineBreaks,d=nt?"DIV":"P",g,tt,it,rt,k;if(a=typeof a=="string"?a.toUpperCase():a,b.length){o.selection.executeAndRestoreRangy(function(){for(var f,e,i=b.length;i--;){if(y&&(tt=r(b[i],y)),w&&(rt=u(b[i],w)),(rt||tt)&&a===null&&b[i].nodeName!=d)return;f=c(b[i]);e=l(b[i]);f||e||!nt&&a!=="P"?t.renameElement(b[i],a==="P"?"DIV":d):(n.dom.lineBreaks(b[i]).add(),t.replaceWithChildNodes(b[i]))}});return}(a===null||n.lang.array(i).contains(a))&&(g=o.selection.findNodesInSelection(i).concat(o.selection.getSelectedOwnNodes()),o.selection.executeAndRestoreRangy(function(){for(var n=g.length;n--;)k=t.getParentElement(g[n],{nodeName:i}),k==o.element&&(k=null),k&&(a&&(k=t.renameElement(k,a)),v&&f(k,v,y),p&&e(k,p,w),it=!0)}),it)||h(o,{nodeName:a||d,className:v||null,cssStyle:p||null})},state:function(i,r,u,f,e,o,s){var a=i.selection.getSelectedOwnNodes(),h=[],c,l,v;for(u=typeof u=="string"?u.toUpperCase():u,l=0,v=a.length;l<v;l++)c=t.getParentElement(a[l],{nodeName:u,className:f,classRegExp:e,cssStyle:o,styleRegExp:s}),c&&n.lang.array(h).indexOf(c)==-1&&h.push(c);return h.length==0?!1:h}}}(wysihtml5);wysihtml5.commands.formatCode={exec:function(n,t,i){var r=this.state(n),u,f,e;r?n.selection.executeAndRestore(function(){u=r.querySelector("code");wysihtml5.dom.replaceWithChildNodes(r);u&&wysihtml5.dom.replaceWithChildNodes(u)}):(f=n.selection.getRange(),e=f.extractContents(),r=n.doc.createElement("pre"),u=n.doc.createElement("code"),i&&(u.className=i),r.appendChild(u),u.appendChild(e),f.insertNode(r),n.selection.selectNode(r))},state:function(n){var t=n.selection.getSelectedNode();return t&&t.nodeName&&t.nodeName=="PRE"&&t.firstChild&&t.firstChild.nodeName&&t.firstChild.nodeName=="CODE"?t:wysihtml5.dom.getParentElement(t,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(t,{nodeName:"PRE"})}},function(n){function u(n){var t=i[n];return t?[n.toLowerCase(),t.toLowerCase()]:[n.toLowerCase()]}function r(i,r,f,e,o,s){var h=i;return r&&(h+=":"+r),e&&(h+=":"+e),t[h]||(t[h]=new n.selection.HTMLApplier(u(i),r,f,!0,e,o,s)),t[h]}var i={strong:"b",em:"i",b:"strong",i:"em"},t={};n.commands.formatInline={exec:function(n,t,i,u,f,e,o,s,h){var l=n.selection.createRange(),c=n.selection.getOwnRanges();if(!c||c.length==0)return!1;n.selection.getSelection().removeAllRanges();r(i,u,f,e,o,n.element).toggleRange(c);s?h||n.cleanUp():(l.setStart(c[0].startContainer,c[0].startOffset),l.setEnd(c[c.length-1].endContainer,c[c.length-1].endOffset),n.selection.setSelection(l),n.selection.executeAndRestore(function(){h||n.cleanUp()},!0,!0))},execWithToggle:function(t,i,r,u,f,e,o){var h=this,s;this.state(t,i,r,u,f,e,o)&&t.selection.isCollapsed()&&!t.selection.caretIsLastInSelection()&&!t.selection.caretIsFirstInSelection()?(s=h.state(t,i,r,u,f)[0],t.selection.executeAndRestoreRangy(function(){var h=s.parentNode;t.selection.selectNode(s,!0);n.commands.formatInline.exec(t,i,r,u,f,e,o,!0,!0)})):this.state(t,i,r,u,f,e,o)&&!t.selection.isCollapsed()?t.selection.executeAndRestoreRangy(function(){n.commands.formatInline.exec(t,i,r,u,f,e,o,!0,!0)}):n.commands.formatInline.exec(t,i,r,u,f,e,o)},state:function(t,u,f,e,o,s,h){var a=t.doc,v=i[f]||f,c,l;return!n.dom.hasElementWithTagName(a,f)&&!n.dom.hasElementWithTagName(a,v)?!1:e&&!n.dom.hasElementWithClassName(a,e)?!1:(c=t.selection.getOwnRanges(),!c||c.length===0)?!1:(l=r(f,e,o,s,h,t.element).isAppliedToRange(c),l&&l.elements?l.elements:!1)}}}(wysihtml5),function(n){n.commands.insertBlockQuote={exec:function(t,i){var u=this.state(t,i),r=t.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);t.selection.executeAndRestore(function(){if(u)t.config.useLineBreaks&&n.dom.lineBreaks(u).add(),n.dom.unwrap(u);else if(t.selection.isCollapsed()&&t.selection.selectLine(),r){var i=r.ownerDocument.createElement("blockquote");n.dom.insert(i).after(r);i.appendChild(r)}else t.selection.surround({nodeName:"blockquote"})})},state:function(t){var r=t.selection.getSelectedNode(),i=n.dom.getParentElement(r,{nodeName:"BLOCKQUOTE"},!1,t.element);return i?i:!1}}}(wysihtml5);wysihtml5.commands.insertHTML={exec:function(n,t,i){n.commands.support(t)?n.doc.execCommand(t,!1,i):n.selection.insertHTML(i)},state:function(){return!1}},function(n){var t="IMG";n.commands.insertImage={exec:function(i,r,u){var s,f,h,e,o;if(u=typeof u=="object"?u:{src:u},s=i.doc,f=this.state(i),f){i.selection.setBefore(f);e=f.parentNode;e.removeChild(f);n.dom.removeEmptyTextNodes(e);e.nodeName!=="A"||e.firstChild||(i.selection.setAfter(e),e.parentNode.removeChild(e));n.quirks.redraw(i.element);return}f=s.createElement(t);for(o in u)f.setAttribute(o==="className"?"class":o,u[o]);i.selection.insertNode(f);n.browser.hasProblemsSettingCaretAfterImg()?(h=s.createTextNode(n.INVISIBLE_SPACE),i.selection.insertNode(h),i.selection.setAfter(h)):i.selection.setAfter(f)},state:function(i){var e=i.doc,r,u,f;return n.dom.hasElementWithTagName(e,t)?(r=i.selection.getSelectedNode(),!r)?!1:r.nodeName===t?r:r.nodeType!==n.ELEMENT_NODE?!1:(u=i.selection.getText(),u=n.lang.string(u).trim(),u)?!1:(f=i.selection.getNodes(n.ELEMENT_NODE,function(n){return n.nodeName==="IMG"}),f.length!==1)?!1:f[0]:!1}}}(wysihtml5),function(n){var t="<br>"+(n.browser.needsSpaceAfterLineBreak()?" ":"");n.commands.insertLineBreak={exec:function(i,r){i.commands.support(r)?(i.doc.execCommand(r,!1,null),n.browser.autoScrollsToCaret()||i.selection.scrollIntoView()):i.commands.exec("insertHTML",t)},state:function(){return!1}}}(wysihtml5);wysihtml5.commands.insertOrderedList={exec:function(n,t){wysihtml5.commands.insertList.exec(n,t,"OL")},state:function(n,t){return wysihtml5.commands.insertList.state(n,t,"OL")}};wysihtml5.commands.insertUnorderedList={exec:function(n,t){wysihtml5.commands.insertList.exec(n,t,"UL")},state:function(n,t){return wysihtml5.commands.insertList.state(n,t,"UL")}};wysihtml5.commands.insertList=function(n){var t=function(n,t){if(n&&n.nodeName){typeof t=="string"&&(t=[t]);for(var i=t.length;i--;)if(n.nodeName===t[i])return!0}return!1},r=function(i,r,u){var f={el:null,other:!1},e,o;return i&&(e=n.dom.getParentElement(i,{nodeName:"LI"}),o=r==="UL"?"OL":"UL",t(i,r)?f.el=i:t(i,o)?f={el:i,other:!0}:e&&(t(e.parentNode,r)?f.el=e.parentNode:t(e.parentNode,o)&&(f={el:e.parentNode,other:!0}))),f.el&&!u.element.contains(f.el)&&(f.el=null),f},u=function(t,r,u){var e=r==="UL"?"OL":"UL",f;u.selection.executeAndRestore(function(){var o=i(e,u),s,h;if(o.length)for(s=o.length;s--;)n.dom.renameElement(o[s],r.toLowerCase());else{for(f=i(["OL","UL"],u),h=f.length;h--;)n.dom.resolveList(f[h],u.config.useLineBreaks);n.dom.resolveList(t,u.config.useLineBreaks)}})},f=function(t,r,u){var f=r==="UL"?"OL":"UL";u.selection.executeAndRestore(function(){for(var e=[t].concat(i(f,u)),o=e.length;o--;)n.dom.renameElement(e[o],r.toLowerCase())})},i=function(n,i){for(var u=i.selection.getOwnRanges(),r=[],f=u.length;f--;)r=r.concat(u[f].getNodes([1],function(i){return t(i,n)}));return r},e=function(t,i){i.selection.executeAndRestoreRangy(function(){var e="_wysihtml5-temp-"+(new Date).getTime(),r=i.selection.deblockAndSurround({nodeName:"div",className:e}),u,f;r.innerHTML=r.innerHTML.replace(/\uFEFF/g,"");r&&(u=n.lang.array(["","<br>",n.INVISIBLE_SPACE]).contains(r.innerHTML),f=n.dom.convertToList(r,t.toLowerCase(),i.parent.config.uneditableContainerClassname),u&&i.selection.selectNode(f.querySelector("li"),!0))})};return{exec:function(n,t,i){var h=n.doc,s=i==="OL"?"insertOrderedList":"insertUnorderedList",c=n.selection.getSelectedNode(),o=r(c,i,n);o.el?o.other?f(o.el,i,n):u(o.el,i,n):n.commands.support(s)?h.execCommand(s,!1,null):e(i,n)},state:function(n,t,i){var f=n.selection.getSelectedNode(),u=r(f,i,n);return u.el&&!u.other?u.el:!1}}}(wysihtml5);wysihtml5.commands.italic={exec:function(n,t){wysihtml5.commands.formatInline.execWithToggle(n,t,"i")},state:function(n,t){return wysihtml5.commands.formatInline.state(n,t,"i")}},function(n){var t="wysiwyg-text-align-center",i=/wysiwyg-text-align-[0-9a-z]+/g;n.commands.justifyCenter={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,t,i)}}}(wysihtml5),function(n){var t="wysiwyg-text-align-left",i=/wysiwyg-text-align-[0-9a-z]+/g;n.commands.justifyLeft={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,t,i)}}}(wysihtml5),function(n){var t="wysiwyg-text-align-right",i=/wysiwyg-text-align-[0-9a-z]+/g;n.commands.justifyRight={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,t,i)}}}(wysihtml5),function(n){var t="wysiwyg-text-align-justify",i=/wysiwyg-text-align-[0-9a-z]+/g;n.commands.justifyFull={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,t,i)}}}(wysihtml5),function(n){var t="text-align: right;",i=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;n.commands.alignRightStyle={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,null,null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,null,null,t,i)}}}(wysihtml5),function(n){var t="text-align: left;",i=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;n.commands.alignLeftStyle={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,null,null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,null,null,t,i)}}}(wysihtml5),function(n){var t="text-align: center;",i=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;n.commands.alignCenterStyle={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,null,null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,null,null,t,i)}}}(wysihtml5);wysihtml5.commands.redo={exec:function(n){return n.undoManager.redo()},state:function(){return!1}};wysihtml5.commands.underline={exec:function(n,t){wysihtml5.commands.formatInline.execWithToggle(n,t,"u")},state:function(n,t){return wysihtml5.commands.formatInline.state(n,t,"u")}};wysihtml5.commands.undo={exec:function(n){return n.undoManager.undo()},state:function(){return!1}};wysihtml5.commands.createTable={exec:function(n,t,i){var u,f,r;if(i&&i.cols&&i.rows&&parseInt(i.cols,10)>0&&parseInt(i.rows,10)>0){for(r=i.tableStyle?'<table style="'+i.tableStyle+'">':"<table>",r+="<tbody>",f=0;f<i.rows;f++){for(r+="<tr>",u=0;u<i.cols;u++)r+="<td>&nbsp;<\/td>";r+="<\/tr>"}r+="<\/tbody><\/table>";n.commands.exec("insertHTML",r)}},state:function(){return!1}};wysihtml5.commands.mergeTableCells={exec:function(n,t){n.tableSelection&&n.tableSelection.start&&n.tableSelection.end&&(this.state(n,t)?wysihtml5.dom.table.unmergeCell(n.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(n.tableSelection.start,n.tableSelection.end))},state:function(n){if(n.tableSelection){var t=n.tableSelection.start,i=n.tableSelection.end;if(t&&i&&t==i&&(wysihtml5.dom.getAttribute(t,"colspan")&&parseInt(wysihtml5.dom.getAttribute(t,"colspan"),10)>1||wysihtml5.dom.getAttribute(t,"rowspan")&&parseInt(wysihtml5.dom.getAttribute(t,"rowspan"),10)>1))return[t]}return!1}};wysihtml5.commands.addTableCells={exec:function(n,t,i){if(n.tableSelection&&n.tableSelection.start&&n.tableSelection.end){var r=wysihtml5.dom.table.orderSelectionEnds(n.tableSelection.start,n.tableSelection.end);i=="before"||i=="above"?wysihtml5.dom.table.addCells(r.start,i):(i=="after"||i=="below")&&wysihtml5.dom.table.addCells(r.end,i);setTimeout(function(){n.tableSelection.select(r.start,r.end)},0)}},state:function(){return!1}};wysihtml5.commands.deleteTableCells={exec:function(n,t,i){if(n.tableSelection&&n.tableSelection.start&&n.tableSelection.end){var e=wysihtml5.dom.table.orderSelectionEnds(n.tableSelection.start,n.tableSelection.end),u=wysihtml5.dom.table.indexOf(e.start),r,f=n.tableSelection.table;wysihtml5.dom.table.removeCells(e.start,i);setTimeout(function(){r=wysihtml5.dom.table.findCell(f,u);r||(i=="row"&&(r=wysihtml5.dom.table.findCell(f,{row:u.row-1,col:u.col})),i=="column"&&(r=wysihtml5.dom.table.findCell(f,{row:u.row,col:u.col-1})));r&&n.tableSelection.select(r,r)},0)}},state:function(){return!1}};wysihtml5.commands.indentList={exec:function(n){var t=n.selection.getSelectionParentsByTag("LI");return t?this.tryToPushLiLevel(t,n.selection):!1},state:function(){return!1},tryToPushLiLevel:function(n,t){var e,u,r,i,f,o=!1;return t.executeAndRestoreRangy(function(){for(var t=n.length;t--;)i=n[t],e=i.parentNode.nodeName==="OL"?"OL":"UL",u=i.ownerDocument.createElement(e),r=wysihtml5.dom.domNode(i).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}),f=r?r.querySelector("ul, ol"):null,r&&(f?f.appendChild(i):(u.appendChild(i),r.appendChild(u)),o=!0)}),o}};wysihtml5.commands.outdentList={exec:function(n){var t=n.selection.getSelectionParentsByTag("LI");return t?this.tryToPullLiLevel(t,n):!1},state:function(){return!1},tryToPullLiLevel:function(n,t){var i,f,e,r,u,o=!1,s=this;return t.selection.executeAndRestoreRangy(function(){for(var c,h=n.length;h--;)if(r=n[h],r.parentNode&&(i=r.parentNode,i.tagName==="OL"||i.tagName==="UL")){if(o=!0,f=wysihtml5.dom.getParentElement(i.parentNode,{nodeName:["OL","UL"]},!1,t.element),e=wysihtml5.dom.getParentElement(i.parentNode,{nodeName:["LI"]},!1,t.element),f&&e)r.nextSibling&&(u=s.getAfterList(i,r),r.appendChild(u)),f.insertBefore(r,e.nextSibling);else{for(r.nextSibling&&(u=s.getAfterList(i,r),r.appendChild(u)),c=r.childNodes.length;c--;)i.parentNode.insertBefore(r.childNodes[c],i.nextSibling);i.parentNode.insertBefore(document.createElement("br"),i.nextSibling);r.parentNode.removeChild(r)}i.childNodes.length===0&&i.parentNode.removeChild(i)}}),o},getAfterList:function(n,t){for(var r=n.nodeName,i=document.createElement(r);t.nextSibling;)i.appendChild(t.nextSibling);return i}},function(n){var r=90,f=89,e=8,o=46,s=25,i="data-wysihtml5-selection-node",t="data-wysihtml5-selection-offset",h='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"<\/span>",c='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"<\/span>",u=n.dom;n.UndoManager=n.lang.Dispatcher.extend({constructor:function(n){this.editor=n;this.composer=n.composer;this.element=this.composer.element;this.position=0;this.historyStr=[];this.historyDom=[];this.transact();this._observe()},_observe:function(){var n=this,i=this.composer.sandbox.getDocument(),t;u.observe(this.element,"keydown",function(t){if(!t.altKey&&(t.ctrlKey||t.metaKey)){var i=t.keyCode,u=i===r&&!t.shiftKey,e=i===r&&t.shiftKey||i===f;u?(n.undo(),t.preventDefault()):e&&(n.redo(),t.preventDefault())}});u.observe(this.element,"keydown",function(i){var r=i.keyCode;r!==t&&(t=r,(r===e||r===o)&&n.transact())});this.editor.on("newword:composer",function(){n.transact()}).on("beforecommand:composer",function(){n.transact()})},transact:function(){var a=this.historyStr[this.position-1],e=this.composer.getValue(!1,!1),v=this.element.offsetWidth>0&&this.element.offsetHeight>0,u,f,h,r,o,c,l;e!==a&&(c=this.historyStr.length=this.historyDom.length=this.position,c>s&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,v&&(u=this.composer.selection.getRange(),f=u&&u.startContainer?u.startContainer:this.element,h=u&&u.startOffset?u.startOffset:0,f.nodeType===n.ELEMENT_NODE?r=f:(r=f.parentNode,o=this.getChildNodeIndex(r,f)),r.setAttribute(t,h),typeof o!="undefined"&&r.setAttribute(i,o)),l=this.element.cloneNode(!!e),this.historyDom.push(l),this.historyStr.push(e),r&&(r.removeAttribute(t),r.removeAttribute(i)))},undo:function(){(this.transact(),this.undoPossible())&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(n){var e,r,u;this.element.innerHTML="";for(var f=0,o=n.childNodes,s=n.childNodes.length;f<s;f++)this.element.appendChild(o[f].cloneNode(!0));n.hasAttribute(t)?(e=n.getAttribute(t),u=n.getAttribute(i),r=this.element):(r=this.element.querySelector("["+t+"]")||this.element,e=r.getAttribute(t),u=r.getAttribute(i),r.removeAttribute(t),r.removeAttribute(i));u!==null&&(r=this.getChildNodeByIndex(r,+u));this.composer.selection.set(r,e)},getChildNodeIndex:function(n,t){for(var i=0,r=n.childNodes,u=r.length;i<u;i++)if(r[i]===t)return i},getChildNodeByIndex:function(n,t){return n.childNodes[t]}})}(wysihtml5);wysihtml5.views.View=Base.extend({constructor:function(n,t,i){this.parent=n;this.element=t;this.config=i;this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var n=this;this.parent.on("beforeload",function(){n.parent.on("change_view",function(t){t===n.name?(n.parent.currentView=n,n.show(),setTimeout(function(){n.focus()},0)):n.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(n){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(n){var t=n.dom,i=n.browser;n.views.Composer=n.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(n,t,i){this.base(n,t,i);this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea;this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=i.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t,i){var r=this.isEmpty()?"":n.quirks.getCorrectInnerHTML(this.element);return t!==!1&&(r=this.parent.parse(r,i===!1?!1:!0)),r},setValue:function(n,t){t&&(n=this.parent.parse(n));try{this.element.innerHTML=n}catch(i){this.element.innerText=n}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"";this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.editableArea);this._displayStyle==="none"&&(this._displayStyle=null);this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer");this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer");this.element.setAttribute("contentEditable","true")},focus:function(t){n.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear();this.base();var i=this.element.lastChild;t&&i&&this.selection&&(i.nodeName==="BR"?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var n=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(n)||n===""||n==="<br>"||n==="<p><\/p>"||n==="<p><br><\/p>"||this.hasPlaceholderSet()},_initContentEditableArea:function(){var n=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea(function(){n._create()},{},this.editableArea):(this.sandbox=new t.ContentEditableArea(function(){n._create()}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var i=this,n;this.sandbox=new t.Sandbox(function(){i._create()},{stylesheets:this.config.stylesheets});this.editableArea=this.sandbox.getIframe();n=this.textarea.element;t.insert(this.editableArea).after(n);this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var n=document.createElement("input");n.type="hidden";n.name="_wysihtml5_mode";n.value=1;t.insert(n).after(this.textarea.element)}},_create:function(){var f=this,r,u;this.doc=this.sandbox.getDocument();this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body;this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1));this.selection=new n.Selection(this.parent,this.element,this.config.uneditableContainerClassname);this.commands=new n.Commands(this.parent);this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element);t.addClass(this.element,this.config.composerClassName);this.config.style&&!this.config.contentEditableMode&&this.style();this.observe();r=this.config.name;r&&(t.addClass(this.element,r),this.config.contentEditableMode||t.addClass(this.editableArea,r));this.enable();!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();u=typeof this.config.placeholder=="string"?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");u&&t.simulatePlaceholder(this.parent,this,u);this.commands.exec("styleWithCSS",!1);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();this._initLineBreaking();this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||i.isIos()||setTimeout(function(){f.focus(!0)},100);i.clearsContentEditableCorrectly()||n.quirks.ensureProperClearing(this);this.initSync&&this.config.sync&&this.initSync();this.config.noTextarea||this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var r=this,u=i.canDisableAutoLinking(),f=i.doesAutoLinkingInContentEditable();if(u&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){if(!f||f&&u){this.parent.on("newword:composer",function(){t.getTextContent(r.element).match(t.autoLink.URL_REG_EXP)&&r.selection.executeAndRestore(function(i,u){for(var f=r.element.querySelectorAll("."+r.config.uneditableContainerClassname),e=!1,o=f.length;o--;)n.dom.contains(f[o],u)&&(e=!0);e||t.autoLink(u.parentNode,[r.config.uneditableContainerClassname])})});t.observe(this.element,"blur",function(){t.autoLink(r.element,[r.config.uneditableContainerClassname])})}var o=this.sandbox.getDocument().getElementsByTagName("a"),s=t.autoLink.URL_REG_EXP,e=function(i){var r=n.lang.string(t.getTextContent(i)).trim();return r.substr(0,4)==="www."&&(r="http://"+r),r};t.observe(this.element,"keydown",function(n){if(o.length){var f=r.selection.getSelectedNode(n.target.ownerDocument),i=t.getParentElement(f,{nodeName:"A"},4),u;i&&(u=e(i),setTimeout(function(){var n=e(i);n!==u&&n.match(s)&&i.setAttribute("href",n)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),i.supportsEvent("resizeend")){var r=["width","height"],f=r.length,u=this.element;t.observe(u,"resizeend",function(t){var e=t.target||t.srcElement,o=e.style,s=0,i;if(e.nodeName==="IMG"){for(;s<f;s++)i=r[s],o[i]&&(e.setAttribute(i,parseInt(o[i],10)),o[i]="");n.quirks.redraw(u)}})}},_initUndoManager:function(){this.undoManager=new n.UndoManager(this.parent)},_initLineBreaking:function(){function u(n){var i=t.getParentElement(n,{nodeName:["P","DIV"]},2);i&&t.contains(r.element,i)&&r.selection.executeAndRestore(function(){r.config.useLineBreaks?t.replaceWithChildNodes(i):i.nodeName!=="P"&&t.renameElement(i,"p")})}var r=this,f=["LI","P","H1","H2","H3","H4","H5","H6"],e=["UL","OL","MENU"];this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(r.isEmpty()){var n=r.doc.createElement("P");r.element.innerHTML="";r.element.appendChild(n);i.displaysCaretInEmptyContentEditableCorrectly()?r.selection.selectNode(n,!0):(n.innerHTML="<br>",r.selection.setBefore(n.firstChild))}});t.observe(this.element,"keydown",function(i){var o=i.keyCode,s;if(!i.shiftKey&&(o===n.ENTER_KEY||o===n.BACKSPACE_KEY)){if(s=t.getParentElement(r.selection.getSelectedNode(),{nodeName:f},4),s){setTimeout(function(){var i=r.selection.getSelectedNode(),f;if(s.nodeName==="LI"){if(!i)return;f=t.getParentElement(i,{nodeName:e},2);f||u(i)}o===n.ENTER_KEY&&s.nodeName.match(/^H[1-6]$/)&&u(i)},0);return}r.config.useLineBreaks&&o===n.ENTER_KEY&&!n.browser.insertsLineBreaksOnReturn()&&(i.preventDefault(),r.commands.exec("insertLineBreak"))}})}})}(wysihtml5),function(n){var t=n.dom,r=document,e=window,f=r.createElement("div"),i=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],u=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],o=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",n.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],s=function(n){if(n.setActive)try{n.setActive()}catch(s){}else{var i=n.style,u=r.documentElement.scrollTop||r.body.scrollTop,f=r.documentElement.scrollLeft||r.body.scrollLeft,o={position:i.position,top:i.top,left:i.left,WebkitUserSelect:i.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(n);n.focus();t.setStyles(o).on(n);e.scrollTo&&e.scrollTo(f,u)}};n.views.Composer.prototype.style=function(){var h=this,l=r.querySelector(":focus"),e=this.textarea.element,a=e.hasAttribute("placeholder"),p=a&&e.getAttribute("placeholder"),v=e.style.display,w=e.disabled,y,c;this.focusStylesHost=f.cloneNode(!1);this.blurStylesHost=f.cloneNode(!1);this.disabledStylesHost=f.cloneNode(!1);a&&e.removeAttribute("placeholder");e===l&&e.blur();e.disabled=!1;e.style.display=y="none";(e.getAttribute("rows")&&t.getStyle("height").from(e)==="auto"||e.getAttribute("cols")&&t.getStyle("width").from(e)==="auto")&&(e.style.display=y=v);t.copyStyles(u).from(e).to(this.editableArea).andTo(this.blurStylesHost);t.copyStyles(i).from(e).to(this.element).andTo(this.blurStylesHost);t.insertCSS(o).into(this.element.ownerDocument);e.disabled=!0;t.copyStyles(u).from(e).to(this.disabledStylesHost);t.copyStyles(i).from(e).to(this.disabledStylesHost);e.disabled=w;e.style.display=v;s(e);e.style.display=y;t.copyStyles(u).from(e).to(this.focusStylesHost);t.copyStyles(i).from(e).to(this.focusStylesHost);e.style.display=v;t.copyStyles(["display"]).from(e).to(this.editableArea);c=n.lang.array(u).without(["display"]);l?l.focus():e.blur();a&&e.setAttribute("placeholder",p);this.parent.on("focus:composer",function(){t.copyStyles(c).from(h.focusStylesHost).to(h.editableArea);t.copyStyles(i).from(h.focusStylesHost).to(h.element)});this.parent.on("blur:composer",function(){t.copyStyles(c).from(h.blurStylesHost).to(h.editableArea);t.copyStyles(i).from(h.blurStylesHost).to(h.element)});return this.parent.observe("disable:composer",function(){t.copyStyles(c).from(h.disabledStylesHost).to(h.editableArea);t.copyStyles(i).from(h.disabledStylesHost).to(h.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(c).from(h.blurStylesHost).to(h.editableArea);t.copyStyles(i).from(h.blurStylesHost).to(h.element)}),this}}(wysihtml5),function(n){var t=n.dom,i=n.browser,r={"66":"bold","73":"italic","85":"underline"},u=function(n,t,i){var u=n.getPreviousNode(t,!0),r=n.getSelectedNode(),f;if(r.nodeType!==1&&r.parentNode!==i&&(r=r.parentNode),u)if(r.nodeType==1){if(f=r.firstChild,u.nodeType==1)while(r.firstChild)u.appendChild(r.firstChild);else while(r.firstChild)t.parentNode.insertBefore(r.firstChild,t);r.parentNode&&r.parentNode.removeChild(r);n.setBefore(f)}else u.nodeType==1?u.appendChild(r):t.parentNode.insertBefore(r,t),n.setBefore(r)},f=function(n,t,i,r){var f,e,o;t.isCollapsed()?t.caretIsInTheBeginnig("LI")?(n.preventDefault(),r.commands.exec("outdentList")):t.caretIsInTheBeginnig()?n.preventDefault():(t.caretIsFirstInSelection()&&t.getPreviousNode()&&t.getPreviousNode().nodeName&&/^H\d$/gi.test(t.getPreviousNode().nodeName)&&(f=t.getPreviousNode(),n.preventDefault(),/^\s*$/.test(f.textContent||f.innerText)?f.parentNode.removeChild(f):(e=f.ownerDocument.createRange(),e.selectNodeContents(f),e.collapse(!1),t.setSelection(e))),o=t.caretIsBeforeUneditable(),o&&(n.preventDefault(),u(t,o,i))):t.containsUneditable()&&(n.preventDefault(),t.deleteContents())},e=function(n){if(n.selection.isCollapsed()){if(n.selection.caretIsInTheBeginnig("LI")&&n.commands.exec("indentList"))return}else n.selection.deleteContents();n.commands.exec("insertHTML","&emsp;")};n.views.Composer.prototype.observe=function(){var u=this,l=this.getValue(!1,!1),s=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),o=this.element,h=i.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?o:this.sandbox.getWindow(),c,a;t.observe(s,"DOMNodeRemoved",function(){clearInterval(c);u.parent.fire("destroy:composer")});i.supportsMutationEvents()||(c=setInterval(function(){t.contains(document.documentElement,s)||(clearInterval(c),u.parent.fire("destroy:composer"))},250));t.observe(h,["drop","paste","mouseup","focus","keyup"],function(){setTimeout(function(){u.parent.fire("interaction").fire("interaction:composer")},0)});this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&n.browser.supportsCommand(this.doc,"enableObjectResizing")&&n.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=t.observe(s,["focus","mouseup","mouseover"],function(){u.doc.execCommand("enableObjectResizing",!1,"false");u.doc.execCommand("enableInlineTableEditing",!1,"false");u.tableClickHandle.stop()}):setTimeout(function(){u.doc.execCommand("enableObjectResizing",!1,"false");u.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=n.quirks.tableCellsSelection(o,u.parent));t.observe(h,"focus",function(n){u.parent.fire("focus",n).fire("focus:composer",n);setTimeout(function(){l=u.getValue(!1,!1)},0)});t.observe(h,"blur",function(n){if(l!==u.getValue(!1,!1)){var t=n;typeof Object.create=="function"&&(t=Object.create(n,{type:{value:"change"}}));u.parent.fire("change",t).fire("change:composer",t)}u.parent.fire("blur",n).fire("blur:composer",n)});t.observe(o,"dragenter",function(){u.parent.fire("unset_placeholder")});t.observe(o,["drop","paste","beforepaste"],function(n){u.parent.fire(n.type,n).fire(n.type+":composer",n)});this.config.copyedFromMarking&&t.observe(o,"copy",function(n){n.clipboardData&&(n.clipboardData.setData("text/html",u.config.copyedFromMarking+u.selection.getHtml()),n.preventDefault());u.parent.fire(n.type,n).fire(n.type+":composer",n)});t.observe(o,"keyup",function(t){var i=t.keyCode;(i===n.SPACE_KEY||i===n.ENTER_KEY)&&u.parent.fire("newword:composer")});this.parent.on("paste:composer",function(){setTimeout(function(){u.parent.fire("newword:composer")},0)});i.canSelectImagesInContentEditable()||t.observe(o,"mousedown",function(t){var i=t.target,r=o.querySelectorAll("img"),f=o.querySelectorAll("."+u.config.uneditableContainerClassname+" img"),e=n.lang.array(r).without(f);i.nodeName==="IMG"&&n.lang.array(e).contains(i)&&u.selection.selectNode(i)});i.canSelectImagesInContentEditable()||t.observe(o,"drop",function(){setTimeout(function(){u.selection.getSelection().removeAllRanges()},0)});i.hasHistoryIssue()&&i.supportsSelectionModify()&&t.observe(o,"keydown",function(n){if(n.metaKey||n.ctrlKey){var t=n.keyCode,r=o.ownerDocument.defaultView,i=r.getSelection();(t===37||t===39)&&(t===37&&(i.modify("extend","left","lineboundary"),n.shiftKey||i.collapseToStart()),t===39&&(i.modify("extend","right","lineboundary"),n.shiftKey||i.collapseToEnd()),n.preventDefault())}});t.observe(o,"keydown",function(n){var t=n.keyCode,i=r[t];(n.ctrlKey||n.metaKey)&&!n.altKey&&i&&(u.commands.exec(i),n.preventDefault());t===8?f(n,u.selection,o,u):u.config.handleTabKey&&t===9&&(n.preventDefault(),e(u,o))});t.observe(o,"keydown",function(t){var r=u.selection.getSelectedNode(!0),f=t.keyCode,i;r&&r.nodeName==="IMG"&&(f===n.BACKSPACE_KEY||f===n.DELETE_KEY)&&(i=r.parentNode,i.removeChild(r),i.nodeName!=="A"||i.firstChild||i.parentNode.removeChild(i),setTimeout(function(){n.quirks.redraw(o)},0),t.preventDefault())});!this.config.contentEditableMode&&i.hasIframeFocusIssue()&&(t.observe(s,"focus",function(){setTimeout(function(){u.doc.querySelector(":focus")!==u.element&&u.focus()},0)}),t.observe(this.element,"blur",function(){setTimeout(function(){u.selection.getSelection().removeAllRanges()},0)}));a={IMG:"Image: ",A:"Link: "};t.observe(o,"mouseover",function(n){var t=n.target,i=t.nodeName,r,u;(i==="A"||i==="IMG")&&(u=t.hasAttribute("title"),u||(r=a[i]+(t.getAttribute("href")||t.getAttribute("src")),t.setAttribute("title",r)))})}}(wysihtml5),function(n){var t=400;n.views.Synchronizer=Base.extend({constructor:function(n,t,i){this.editor=n;this.textarea=t;this.composer=i;this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(n.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function(n){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,n):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(n){this.editor.currentView.name==="textarea"?this.fromTextareaToComposer(n):this.fromComposerToTextarea(n)},_observe:function(){var r,i=this,u=this.textarea.element.form,f=function(){r=setInterval(function(){i.fromComposerToTextarea()},t)},e=function(){clearInterval(r);r=null};f();u&&(n.dom.observe(u,"submit",function(){i.sync(!0)}),n.dom.observe(u,"reset",function(){setTimeout(function(){i.fromTextareaToComposer()},0)}));this.editor.on("change_view",function(n){n!=="composer"||r?n==="textarea"&&(i.fromComposerToTextarea(!0),e()):(i.fromTextareaToComposer(!0),f())});this.editor.on("destroy:composer",e)}})}(wysihtml5);wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(n,t,i){this.base(n,t,i);this._observe()},clear:function(){this.element.value=""},getValue:function(n){var t=this.isEmpty()?"":this.element.value;return n!==!1&&(t=this.parent.parse(t)),t},setValue:function(n,t){t&&(n=this.parent.parse(n));this.element.value=n},cleanUp:function(){var n=this.parent.parse(this.element.value);this.element.value=n},hasPlaceholderSet:function(){var t=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),i=this.element.getAttribute("placeholder")||null,n=this.element.value,r=!n;return t&&r||n===i},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var t=this.element,n=this.parent,i={focusin:"focus",focusout:"blur"},r=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];n.on("beforeload",function(){wysihtml5.dom.observe(t,r,function(t){var r=i[t.type]||t.type;n.fire(r).fire(r+":textarea")});wysihtml5.dom.observe(t,["paste","drop"],function(){setTimeout(function(){n.fire("paste").fire("paste:textarea")},0)})})}}),function(n){var t,i={name:t,style:!0,toolbar:t,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:n.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};n.Editor=n.lang.Dispatcher.extend({constructor:function(t,r){if(this.editableElement=typeof t=="string"?document.getElementById(t):t,this.config=n.lang.object({}).merge(i).merge(r).get(),this._isCompatible=n.browser.supported(),this.editableElement.nodeName.toLowerCase()!="textarea"&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new n.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&n.browser.isTouchDevice()){var u=this;setTimeout(function(){u.fire("beforeload").fire("load")},0);return}n.dom.addClass(document.body,this.config.bodyClassName);this.composer=new n.views.Composer(this,this.editableElement,this.config);this.currentView=this.composer;typeof this.config.parser=="function"&&this._initParser();this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new n.views.Synchronizer(this,this.textarea,this.composer));this.config.toolbar&&(this.toolbar=new n.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(n,t){return this.currentView.getValue(n,t)},setValue:function(n,t){return(this.fire("unset_placeholder"),!n)?this.clear():(this.currentView.setValue(n,t),this)},cleanUp:function(){this.currentView.cleanUp()},focus:function(n){return this.currentView.focus(n),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t,i){var r=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,u=this.config.parser(t,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:r,uneditableClass:this.config.uneditableContainerClassname,clearInternals:i});return typeof t=="object"&&n.quirks.redraw(t),u},_initParser:function(){var t=this,i;if(n.browser.supportsModenPaste())this.on("paste:composer",function(r){r.preventDefault();i=n.dom.getPastedHtml(r);i&&t._cleanAndPaste(i)});else this.on("beforepaste:composer",function(i){i.preventDefault();n.dom.getPastedHtmlWithDiv(t.composer,function(n){n&&t._cleanAndPaste(n)})})},_cleanAndPaste:function(t){var i=n.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.uneditableContainerClassname});this.composer.selection.deleteContents();this.composer.selection.insertHTML(i)}})}(wysihtml5),function(n){var t=n.dom,i="wysihtml5-command-dialog-opened",r="input, select, textarea",u="[data-wysihtml5-dialog-field]",f="data-wysihtml5-dialog-field";n.toolbar.Dialog=n.lang.Dispatcher.extend({constructor:function(n,t){this.link=n;this.container=t},_observe:function(){var u,f;if(!this._observed){u=this;f=function(n){var t=u._serialize();t==u.elementToChange?u.fire("edit",t):u.fire("save",t);u.hide();n.preventDefault();n.stopPropagation()};t.observe(u.link,"click",function(){t.hasClass(u.link,i)&&setTimeout(function(){u.hide()},0)});t.observe(this.container,"keydown",function(t){var i=t.keyCode;i===n.ENTER_KEY&&f(t);i===n.ESCAPE_KEY&&(u.fire("cancel"),u.hide())});t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",f);t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(n){u.fire("cancel");u.hide();n.preventDefault();n.stopPropagation()});for(var o=this.container.querySelectorAll(r),e=0,s=o.length,h=function(){clearInterval(u.interval)};e<s;e++)t.observe(o[e],"change",h);this._observed=!0}},_serialize:function(){for(var i=this.elementToChange||{},t=this.container.querySelectorAll(u),r=t.length,n=0;n<r;n++)i[t[n].getAttribute(f)]=t[n].value;return i},_interpolate:function(n){for(var t,r,e,s=document.querySelector(":focus"),o=this.container.querySelectorAll(u),h=o.length,i=0;i<h;i++)(t=o[i],t!==s)&&(n&&t.type==="hidden"||(r=t.getAttribute(f),e=this.elementToChange&&typeof this.elementToChange!="boolean"?this.elementToChange.getAttribute(r)||"":t.defaultValue,t.value=e))},show:function(n){if(!t.hasClass(this.link,i)){var f=this,u=this.container.querySelector(r);if(this.elementToChange=n,this._observe(),this._interpolate(),n&&(this.interval=setInterval(function(){f._interpolate(!0)},500)),t.addClass(this.link,i),this.container.style.display="",this.fire("show"),u&&!n)try{u.focus()}catch(e){}}},hide:function(){clearInterval(this.interval);this.elementToChange=null;t.removeClass(this.link,i);this.container.style.display="none";this.fire("hide")}})}(wysihtml5),function(n){var t=n.dom,u={position:"relative"},i={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},f={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},r={"x-webkit-speech":"",speech:""};n.toolbar.Speech=function(e,o){var s=document.createElement("input"),c,h,l;if(!n.browser.supportsSpeechApiOn(s)){o.style.display="none";return}c=e.editor.textarea.element.getAttribute("lang");c&&(r.lang=c);h=document.createElement("div");n.lang.object(i).merge({width:o.offsetWidth+"px",height:o.offsetHeight+"px"});t.insert(s).into(h);t.insert(h).into(o);t.setStyles(f).on(s);t.setAttributes(r).on(s);t.setStyles(i).on(h);t.setStyles(u).on(o);l="onwebkitspeechchange"in s?"webkitspeechchange":"speechchange";t.observe(s,l,function(){e.execCommand("insertText",s.value);s.value=""});t.observe(s,"click",function(n){t.hasClass(o,"wysihtml5-command-disabled")&&n.preventDefault();n.stopPropagation()})}}(wysihtml5),function(n){var r="wysihtml5-command-disabled",u="wysihtml5-commands-disabled",i="wysihtml5-command-active",f="wysihtml5-action-active",t=n.dom;n.toolbar.Toolbar=Base.extend({constructor:function(t,e,o){this.editor=t;this.container=typeof e=="string"?document.getElementById(e):e;this.composer=t.composer;this._getLinks("command");this._getLinks("action");this._observe();o&&this.show();t.config.classNameCommandDisabled!=null&&(r=t.config.classNameCommandDisabled);t.config.classNameCommandsDisabled!=null&&(u=t.config.classNameCommandsDisabled);t.config.classNameCommandActive!=null&&(i=t.config.classNameCommandActive);t.config.classNameActionActive!=null&&(f=t.config.classNameActionActive);for(var h=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),c=h.length,s=0;s<c;s++)new n.toolbar.Speech(this,h[s])},_getLinks:function(t){for(var e=this[t+"Links"]=n.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),h=e.length,u=0,c=this[t+"Mapping"]={},i,o,r,f,s;u<h;u++)i=e[u],r=i.getAttribute("data-wysihtml5-"+t),f=i.getAttribute("data-wysihtml5-"+t+"-value"),o=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+r+"']"),s=this._getDialog(i,r),c[r+":"+f]={link:i,group:o,name:r,value:f,dialog:s,state:!1}},_getDialog:function(t,i){var r=this,u=this.container.querySelector("[data-wysihtml5-dialog='"+i+"']"),f,e;if(u){f=n.toolbar["Dialog_"+i]?new n.toolbar["Dialog_"+i](t,u):new n.toolbar.Dialog(t,u);f.on("show",function(){e=r.composer.selection.getBookmark();r.editor.fire("show:dialog",{command:i,dialogContainer:u,commandLink:t})});f.on("save",function(n){e&&r.composer.selection.setBookmark(e);r._execCommand(i,n);r.editor.fire("save:dialog",{command:i,dialogContainer:u,commandLink:t})});f.on("cancel",function(){r.editor.focus(!1);r.editor.fire("cancel:dialog",{command:i,dialogContainer:u,commandLink:t})})}return f},execCommand:function(n,t){if(!this.commandsDisabled){var i=this.commandMapping[n+":"+t];i&&i.dialog&&!i.state?i.dialog.show():this._execCommand(n,t)}},_execCommand:function(n,t){this.editor.focus(!1);this.composer.commands.exec(n,t);this._updateLinkStates()},execAction:function(n){var t=this.editor;n==="change_view"&&t.textarea&&(t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea"));n=="showSource"&&t.fire("showSource")},_observe:function(){for(var n=this,i=this.editor,r=this.container,e=this.commandLinks.concat(this.actionLinks),o=e.length,f=0;f<o;f++)if(e[f].nodeName==="A")t.setAttributes({href:"javascript:;",unselectable:"on"}).on(e[f]);else t.setAttributes({unselectable:"on"}).on(e[f]);t.delegate(r,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(n){n.preventDefault()});t.delegate(r,"[data-wysihtml5-command]","click",function(t){var i=this,r=i.getAttribute("data-wysihtml5-command"),u=i.getAttribute("data-wysihtml5-command-value");n.execCommand(r,u);t.preventDefault()});t.delegate(r,"[data-wysihtml5-action]","click",function(t){var i=this.getAttribute("data-wysihtml5-action");n.execAction(i);t.preventDefault()});i.on("interaction:composer",function(){n._updateLinkStates()});i.on("focus:composer",function(){n.bookmark=null});if(this.editor.config.handleTables){i.on("tableselect:composer",function(){n.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""});i.on("tableunselect:composer",function(){n.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})}i.on("change_view",function(f){i.textarea&&setTimeout(function(){n.commandsDisabled=f!=="composer";n._updateLinkStates();n.commandsDisabled?t.addClass(r,u):t.removeClass(r,u)},0)})},_updateLinkStates:function(){var h=this.commandMapping,c=this.actionMapping,s,e,o,u;for(s in h)(u=h[s],this.commandsDisabled?(e=!1,t.removeClass(u.link,i),u.group&&t.removeClass(u.group,i),u.dialog&&u.dialog.hide()):(e=this.composer.commands.state(u.name,u.value),t.removeClass(u.link,r),u.group&&t.removeClass(u.group,r)),u.state!==e)&&(u.state=e,e?(t.addClass(u.link,i),u.group&&t.addClass(u.group,i),u.dialog&&(typeof e=="object"||n.lang.object(e).isArray()?(!u.dialog.multiselect&&n.lang.object(e).isArray()&&(e=e.length===1?e[0]:!0,u.state=e),u.dialog.show(e)):u.dialog.hide())):(t.removeClass(u.link,i),u.group&&t.removeClass(u.group,i),u.dialog&&u.dialog.hide()));for(s in c)o=c[s],o.name==="change_view"&&(o.state=this.editor.currentView===this.editor.textarea,o.state?t.addClass(o.link,f):t.removeClass(o.link,f))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(n){n.toolbar.Dialog_createTable=n.toolbar.Dialog.extend({show:function(n){this.base(n)}})}(wysihtml5),function(n){var r=n.dom,t="[data-wysihtml5-dialog-field]",i="data-wysihtml5-dialog-field";n.toolbar.Dialog_foreColorStyle=n.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var u={},r=this.container.querySelectorAll(t),f=r.length,n=0;n<f;n++)u[r[n].getAttribute(i)]=r[n].value;return u},_interpolate:function(r){for(var f,c=document.querySelector(":focus"),o=this.container.querySelectorAll(t),l=o.length,e=0,s=this.elementToChange?n.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,h=s?s.getAttribute("style"):null,u=h?n.quirks.styleParser.parseColor(h,"color"):null;e<l;e++)(f=o[e],f!==c)&&(r&&f.type==="hidden"||f.getAttribute(i)==="color"&&(f.value=u?u[3]&&u[3]!=1?"rgba("+u[0]+","+u[1]+","+u[2]+","+u[3]+");":"rgb("+u[0]+","+u[1]+","+u[2]+");":"rgb(0,0,0);"))}})}(wysihtml5),function(n){var t=n.dom;n.toolbar.Dialog_fontSizeStyle=n.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(){var f=document.querySelector(":focus"),t=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),r=this.elementToChange?n.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,u=r?r.getAttribute("style"):null,i=u?n.quirks.styleParser.parseFontSize(u):null;t&&t!==f&&i&&!/^\s*$/.test(i)&&(t.value=i)}})}(wysihtml5);
/*!
 handlebars v1.3.0
Copyright (C) 2011 by Yehuda Katz
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
@license
*/
Handlebars=function(){var i=function(){"use strict";function n(n){this.string=n}var t;return n.prototype.toString=function(){return""+this.string},t=n}(),n=function(n){"use strict";function f(n){return c[n]||"&amp;"}function e(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}function o(n){return n instanceof h?n.toString():n||0===n?(n=""+n,a.test(n)?n.replace(l,f):n):""}function s(n){return n||0===n?u(n)&&0===n.length?!0:!1:!0}var t={},h=n,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},l=/[&<>"'`]/g,a=/[&<>"'`]/,i,r,u;return t.extend=e,i=Object.prototype.toString,t.toString=i,r=function(n){return"function"==typeof n},r(/x/)&&(r=function(n){return"function"==typeof n&&"[object Function]"===i.call(n)}),t.isFunction=r,u=Array.isArray||function(n){return n&&"object"==typeof n?"[object Array]"===i.call(n):!1},t.isArray=u,t.escapeExpression=o,t.isEmpty=s,t}(i),t=function(){"use strict";function t(t,i){var u,f,r;for(i&&i.firstLine&&(u=i.firstLine,t+=" - "+u+":"+i.firstColumn),f=Error.prototype.constructor.call(this,t),r=0;r<n.length;r++)this[n[r]]=f[n[r]];u&&(this.lineNumber=u,this.column=i.firstColumn)}var i,n=["description","fileName","lineNumber","message","name","number","stack"];return t.prototype=new Error,i=t}(),r=function(n,t){"use strict";function e(n,t){this.helpers=n||{};this.partials=t||{};p(this)}function p(n){n.registerHelper("helperMissing",function(n){if(2===arguments.length)return void 0;throw new h("Missing helper: '"+n+"'");});n.registerHelper("blockHelperMissing",function(t,i){var r=i.inverse||function(){},u=i.fn;return f(t)&&(t=t.call(this)),t===!0?u(this):t===!1||null==t?r(this):a(t)?t.length>0?n.helpers.each(t,i):r(this):u(t)});n.registerHelper("each",function(n,t){var i,s=t.fn,c=t.inverse,r=0,u="",h,e;if(f(n)&&(n=n.call(this)),t.data&&(i=o(t.data)),n&&"object"==typeof n)if(a(n))for(h=n.length;h>r;r++)i&&(i.index=r,i.first=0===r,i.last=r===n.length-1),u+=s(n[r],{data:i});else for(e in n)n.hasOwnProperty(e)&&(i&&(i.key=e,i.index=r,i.first=0===r),u+=s(n[e],{data:i}),r++);return 0===r&&(u=c(this)),u});n.registerHelper("if",function(n,t){return f(n)&&(n=n.call(this)),!t.hash.includeZero&&!n||r.isEmpty(n)?t.inverse(this):t.fn(this)});n.registerHelper("unless",function(t,i){return n.helpers["if"].call(this,t,{fn:i.inverse,inverse:i.fn,hash:i.hash})});n.registerHelper("with",function(n,t){return f(n)&&(n=n.call(this)),r.isEmpty(n)?void 0:t.fn(n)});n.registerHelper("log",function(t,i){var r=i.data&&null!=i.data.level?parseInt(i.data.level,10):1;n.log(r,t)})}function s(n,t){u.log(n,t)}var i={},r=n,h=t,c,l,u,o;i.VERSION="1.3.0";c=4;i.COMPILER_REVISION=c;l={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};i.REVISION_CHANGES=l;var a=r.isArray,f=r.isFunction,v=r.toString,y="[object Object]";return i.HandlebarsEnvironment=e,e.prototype={constructor:e,logger:u,log:s,registerHelper:function(n,t,i){if(v.call(n)===y){if(i||t)throw new h("Arg not supported with multiple helpers");r.extend(this.helpers,n)}else i&&(t.not=i),this.helpers[n]=t},registerPartial:function(n,t){v.call(n)===y?r.extend(this.partials,n):this.partials[n]=t}},u={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(n,t){if(u.level<=n){var i=u.methodMap[n];"undefined"!=typeof console&&console[i]&&console[i].call(console,t)}}},i.logger=u,i.log=s,o=function(n){var t={};return r.extend(t,n),t},i.createFrame=o,i}(n,t),u=function(n,t,i){"use strict";function s(n){var t=n&&n[0]||1,i=v,r,f;if(t!==i){if(i>t){r=o[i];f=o[t];throw new u("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+f+").");}throw new u("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+n[1]+").");}}function h(n,t){if(!t)throw new u("No environment passed to template");var r=function(n,i,r,f,e,o){var s=t.VM.invokePartial.apply(this,arguments),h;if(null!=s)return s;if(t.compile)return h={helpers:f,partials:e,data:o},e[i]=t.compile(n,{data:void 0!==o},t),e[i](r,h);throw new u("The partial "+i+" could not be compiled when running in runtime-only mode");},i={escapeExpression:e.escapeExpression,invokePartial:r,programs:[],program:function(n,t,i){var r=this.programs[n];return i?r=f(n,t,i):r||(r=this.programs[n]=f(n,t)),r},merge:function(n,t){var i=n||t;return n&&t&&n!==t&&(i={},e.extend(i,t),e.extend(i,n)),i},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(r,u){var f,e,o,s;return u=u||{},o=u.partial?u:t,u.partial||(f=u.helpers,e=u.partials),s=n.call(i,o,r,f,e,u.data),u.partial||t.VM.checkRevision(i.compilerInfo),s}}function c(n,t,i){var u=Array.prototype.slice.call(arguments,3),r=function(n,r){return r=r||{},t.apply(this,[n,r.data||i].concat(u))};return r.program=n,r.depth=u.length,r}function f(n,t,i){var r=function(n,r){return r=r||{},t(n,r.data||i)};return r.program=n,r.depth=0,r}function l(n,t,i,r,f,e){var o={partial:!0,helpers:r,partials:f,data:e};if(void 0===n)throw new u("The partial "+t+" could not be found");if(n instanceof Function)return n(i,o)}function a(){return""}var r={},e=n,u=t,v=i.COMPILER_REVISION,o=i.REVISION_CHANGES;return r.checkRevision=s,r.template=h,r.programWithDepth=c,r.program=f,r.invokePartial=l,r.noop=a,r}(n,t,r);return function(n,t,i,r,u){"use strict";var c,f=n,l=t,a=i,e=r,o=u,s=function(){var n=new f.HandlebarsEnvironment;return e.extend(n,f),n.SafeString=l,n.Exception=a,n.Utils=e,n.VM=o,n.template=function(t){return o.template(t,n)},n},h=s();return h.create=s,c=h}(r,i,t,n,u)}();this.wysihtml5=this.wysihtml5||{};this.wysihtml5.tpl=this.wysihtml5.tpl||{};this.wysihtml5.tpl.blockquote=Handlebars.template(function(n,t,i,r,u){function c(n){var t;return"btn-"+h((t=(t=(t=n&&n.options,t==null||t===!1?t:t.toolbar),t==null||t===!1?t:t.size),typeof t===s?t.apply(n):t))}function l(){return' \n      <span class="fa fa-quote-left"><\/span>\n    '}function a(){return'\n      <span class="glyphicon glyphicon-quote"><\/span>\n    '}this.compilerInfo=[4,">= 1.0.0"];i=this.merge(i,n.helpers);u=u||{};var e="",f,s="function",h=this.escapeExpression,o=this;return e+='<li>\n  <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:o.noop,fn:o.program(1,c,u),data:u}),(f||f===0)&&(e+=f),e+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:o.program(5,a,u),fn:o.program(3,l,u),data:u}),(f||f===0)&&(e+=f),e+"\n  <\/a>\n<\/li>\n"});this.wysihtml5.tpl.color=Handlebars.template(function(n,t,i,r,u){function c(n){var t;return"btn-"+o((t=(t=(t=n&&n.options,t==null||t===!1?t:t.toolbar),t==null||t===!1?t:t.size),typeof t===e?t.apply(n):t))}this.compilerInfo=[4,">= 1.0.0"];i=this.merge(i,n.helpers);u=u||{};var s="",f,e="function",o=this.escapeExpression,h=this;return s+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:h.noop,fn:h.program(1,c,u),data:u}),(f||f===0)&&(s+=f),s+('" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.black),typeof f===e?f.apply(t):f))+'<\/span>\n    <b class="caret"><\/b>\n  <\/a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.black),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.silver),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.gray),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.maroon),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.red),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.purple),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.green),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.olive),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.navy),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.blue),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"><\/div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.colours),f==null||f===!1?f:f.orange),typeof f===e?f.apply(t):f))+"<\/a><\/li>\n  <\/ul>\n<\/li>\n")});this.wysihtml5.tpl.emphasis=Handlebars.template(function(n,t,i,r,u){function c(n){var t;return"btn-"+h((t=(t=(t=n&&n.options,t==null||t===!1?t:t.toolbar),t==null||t===!1?t:t.size),typeof t===s?t.apply(n):t))}function l(n,t){var u="",r;return u+='\n    <a class="btn ',r=i["if"].call(n,(r=(r=n&&n.options,r==null||r===!1?r:r.toolbar),r==null||r===!1?r:r.size),{hash:{},inverse:e.noop,fn:e.program(1,c,t),data:t}),(r||r===0)&&(u+=r),u+(' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">'+h((r=(r=(r=n&&n.locale,r==null||r===!1?r:r.emphasis),r==null||r===!1?r:r.small),typeof r===s?r.apply(n):r))+"<\/a>\n    ")}this.compilerInfo=[4,">= 1.0.0"];i=this.merge(i,n.helpers);u=u||{};var o="",f,s="function",h=this.escapeExpression,e=this;return o+='<li>\n  <div class="btn-group">\n    <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:e.noop,fn:e.program(1,c,u),data:u}),(f||f===0)&&(o+=f),o+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.emphasis),f==null||f===!1?f:f.bold),typeof f===s?f.apply(t):f))+'<\/a>\n    <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:e.noop,fn:e.program(1,c,u),data:u}),(f||f===0)&&(o+=f),o+=' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.emphasis),f==null||f===!1?f:f.italic),typeof f===s?f.apply(t):f))+'<\/a>\n    <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:e.noop,fn:e.program(1,c,u),data:u}),(f||f===0)&&(o+=f),o+=' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.emphasis),f==null||f===!1?f:f.underline),typeof f===s?f.apply(t):f))+"<\/a>\n    ",f=i["if"].call(t,(f=(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.emphasis),f==null||f===!1?f:f.small),{hash:{},inverse:e.noop,fn:e.program(3,l,u),data:u}),(f||f===0)&&(o+=f),o+"\n  <\/div>\n<\/li>\n"});this.wysihtml5.tpl["font-styles"]=Handlebars.template(function(n,t,i,r,u){function c(n){var t;return"btn-"+o((t=(t=(t=n&&n.options,t==null||t===!1?t:t.toolbar),t==null||t===!1?t:t.size),typeof t===e?t.apply(n):t))}function l(){return'\n      <span class="fa fa-font"><\/span>\n    '}function a(){return'\n      <span class="glyphicon glyphicon-font"><\/span>\n    '}this.compilerInfo=[4,">= 1.0.0"];i=this.merge(i,n.helpers);u=u||{};var s="",f,e="function",o=this.escapeExpression,h=this;return s+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:h.noop,fn:h.program(1,c,u),data:u}),(f||f===0)&&(s+=f),s+='" data-toggle="dropdown">\n    ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:h.program(5,a,u),fn:h.program(3,l,u),data:u}),(f||f===0)&&(s+=f),s+('\n    <span class="current-font">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.font_styles),f==null||f===!1?f:f.normal),typeof f===e?f.apply(t):f))+'<\/span>\n    <b class="caret"><\/b>\n  <\/a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.font_styles),f==null||f===!1?f:f.normal),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.font_styles),f==null||f===!1?f:f.h1),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.font_styles),f==null||f===!1?f:f.h2),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.font_styles),f==null||f===!1?f:f.h3),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.font_styles),f==null||f===!1?f:f.h4),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.font_styles),f==null||f===!1?f:f.h5),typeof f===e?f.apply(t):f))+'<\/a><\/li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+o((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.font_styles),f==null||f===!1?f:f.h6),typeof f===e?f.apply(t):f))+"<\/a><\/li>\n  <\/ul>\n<\/li>\n")});this.wysihtml5.tpl.html=Handlebars.template(function(n,t,i,r,u){function c(n){var t;return"btn-"+h((t=(t=(t=n&&n.options,t==null||t===!1?t:t.toolbar),t==null||t===!1?t:t.size),typeof t===s?t.apply(n):t))}function l(){return'\n        <span class="fa fa-pencil"><\/span>\n      '}function a(){return'\n        <span class="glyphicon glyphicon-pencil"><\/span>\n      '}this.compilerInfo=[4,">= 1.0.0"];i=this.merge(i,n.helpers);u=u||{};var e="",f,s="function",h=this.escapeExpression,o=this;return e+='<li>\n  <div class="btn-group">\n    <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:o.noop,fn:o.program(1,c,u),data:u}),(f||f===0)&&(e+=f),e+=' btn-default" data-wysihtml5-action="change_view" title="'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.html),f==null||f===!1?f:f.edit),typeof f===s?f.apply(t):f))+'" tabindex="-1">\n      ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:o.program(5,a,u),fn:o.program(3,l,u),data:u}),(f||f===0)&&(e+=f),e+"\n    <\/a>\n  <\/div>\n<\/li>\n"});this.wysihtml5.tpl.image=Handlebars.template(function(n,t,i,r,u){function c(){return"modal-sm"}function l(n){var t;return"btn-"+h((t=(t=(t=n&&n.options,t==null||t===!1?t:t.toolbar),t==null||t===!1?t:t.size),typeof t===s?t.apply(n):t))}function a(){return'\n      <span class="fa fa-file-image-o"><\/span>\n    '}function v(){return'\n      <span class="glyphicon glyphicon-picture"><\/span>\n    '}this.compilerInfo=[4,">= 1.0.0"];i=this.merge(i,n.helpers);u=u||{};var e="",f,s="function",h=this.escapeExpression,o=this;return e+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.smallmodals),{hash:{},inverse:o.noop,fn:o.program(1,c,u),data:u}),(f||f===0)&&(e+=f),e+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;<\/a>\n          <h3>'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.image),f==null||f===!1?f:f.insert),typeof f===s?f.apply(t):f))+'<\/h3>\n        <\/div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          <\/div> \n        <\/div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.image),f==null||f===!1?f:f.cancel),typeof f===s?f.apply(t):f))+'<\/a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.image),f==null||f===!1?f:f.insert),typeof f===s?f.apply(t):f))+'<\/a>\n        <\/div>\n      <\/div>\n    <\/div>\n  <\/div>\n  <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:o.noop,fn:o.program(3,l,u),data:u}),(f||f===0)&&(e+=f),e+=' btn-default" data-wysihtml5-command="insertImage" title="'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.image),f==null||f===!1?f:f.insert),typeof f===s?f.apply(t):f))+'" tabindex="-1">\n    ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:o.program(7,v,u),fn:o.program(5,a,u),data:u}),(f||f===0)&&(e+=f),e+"\n  <\/a>\n<\/li>\n"});this.wysihtml5.tpl.link=Handlebars.template(function(n,t,i,r,u){function c(){return"modal-sm"}function l(n){var t;return"btn-"+s((t=(t=(t=n&&n.options,t==null||t===!1?t:t.toolbar),t==null||t===!1?t:t.size),typeof t===o?t.apply(n):t))}function a(){return'\n      <span class="fa fa-share-square-o"><\/span>\n    '}function v(){return'\n      <span class="glyphicon glyphicon-share"><\/span>\n    '}this.compilerInfo=[4,">= 1.0.0"];i=this.merge(i,n.helpers);u=u||{};var e="",f,o="function",s=this.escapeExpression,h=this;return e+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.smallmodals),{hash:{},inverse:h.noop,fn:h.program(1,c,u),data:u}),(f||f===0)&&(e+=f),e+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;<\/a>\n          <h3>'+s((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.link),f==null||f===!1?f:f.insert),typeof f===o?f.apply(t):f))+'<\/h3>\n        <\/div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          <\/div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+s((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.link),f==null||f===!1?f:f.target),typeof f===o?f.apply(t):f))+'\n            <\/label>\n          <\/div>\n        <\/div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+s((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.link),f==null||f===!1?f:f.cancel),typeof f===o?f.apply(t):f))+'<\/a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+s((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.link),f==null||f===!1?f:f.insert),typeof f===o?f.apply(t):f))+'<\/a>\n        <\/div>\n      <\/div>\n    <\/div>\n  <\/div>\n  <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:h.noop,fn:h.program(3,l,u),data:u}),(f||f===0)&&(e+=f),e+=' btn-default" data-wysihtml5-command="createLink" title="'+s((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.link),f==null||f===!1?f:f.insert),typeof f===o?f.apply(t):f))+'" tabindex="-1">\n    ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:h.program(7,v,u),fn:h.program(5,a,u),data:u}),(f||f===0)&&(e+=f),e+"\n  <\/a>\n<\/li>\n"});this.wysihtml5.tpl.lists=Handlebars.template(function(n,t,i,r,u){function c(n){var t;return"btn-"+h((t=(t=(t=n&&n.options,t==null||t===!1?t:t.toolbar),t==null||t===!1?t:t.size),typeof t===s?t.apply(n):t))}function l(){return'\n      <span class="fa fa-list-ul"><\/span>\n    '}function a(){return'\n      <span class="glyphicon glyphicon-list"><\/span>\n    '}function v(){return'\n      <span class="fa fa-list-ol"><\/span>\n    '}function y(){return'\n      <span class="glyphicon glyphicon-th-list"><\/span>\n    '}function p(){return'\n      <span class="fa fa-outdent"><\/span>\n    '}function w(){return'\n      <span class="glyphicon glyphicon-indent-right"><\/span>\n    '}function b(){return'\n      <span class="fa fa-indent"><\/span>\n    '}function k(){return'\n      <span class="glyphicon glyphicon-indent-left"><\/span>\n    '}this.compilerInfo=[4,">= 1.0.0"];i=this.merge(i,n.helpers);u=u||{};var e="",f,s="function",h=this.escapeExpression,o=this;return e+='<li>\n  <div class="btn-group">\n    <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:o.noop,fn:o.program(1,c,u),data:u}),(f||f===0)&&(e+=f),e+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.lists),f==null||f===!1?f:f.unordered),typeof f===s?f.apply(t):f))+'" tabindex="-1">\n    ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:o.program(5,a,u),fn:o.program(3,l,u),data:u}),(f||f===0)&&(e+=f),e+='\n    <\/a>\n    <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:o.noop,fn:o.program(1,c,u),data:u}),(f||f===0)&&(e+=f),e+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.lists),f==null||f===!1?f:f.ordered),typeof f===s?f.apply(t):f))+'" tabindex="-1">\n    ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:o.program(9,y,u),fn:o.program(7,v,u),data:u}),(f||f===0)&&(e+=f),e+='\n    <\/a>\n    <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:o.noop,fn:o.program(1,c,u),data:u}),(f||f===0)&&(e+=f),e+=' btn-default" data-wysihtml5-command="Outdent" title="'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.lists),f==null||f===!1?f:f.outdent),typeof f===s?f.apply(t):f))+'" tabindex="-1">\n    ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:o.program(13,w,u),fn:o.program(11,p,u),data:u}),(f||f===0)&&(e+=f),e+='\n    <\/a>\n    <a class="btn ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.size),{hash:{},inverse:o.noop,fn:o.program(1,c,u),data:u}),(f||f===0)&&(e+=f),e+=' btn-default" data-wysihtml5-command="Indent" title="'+h((f=(f=(f=t&&t.locale,f==null||f===!1?f:f.lists),f==null||f===!1?f:f.indent),typeof f===s?f.apply(t):f))+'" tabindex="-1">\n    ',f=i["if"].call(t,(f=(f=t&&t.options,f==null||f===!1?f:f.toolbar),f==null||f===!1?f:f.fa),{hash:{},inverse:o.program(17,k,u),fn:o.program(15,b,u),data:u}),(f||f===0)&&(e+=f),e+"\n    <\/a>\n  <\/div>\n<\/li>\n"}),function(n){"use strict";typeof define=="function"&&define.amd?define("bootstrap.wysihtml5",["jquery","wysihtml5","bootstrap","bootstrap.wysihtml5.templates","bootstrap.wysihtml5.commands"],n):n(jQuery,wysihtml5)}(function(n,t){"use strict";var i=function(n,t){var e=function(n,i,r){if(t.tpl[n])return t.tpl[n]({locale:i,options:r})},u=function(i,r){var u,e;this.el=i;u=n.extend(!0,{},f,r);for(e in u.customTemplates)u.customTemplates.hasOwnProperty(e)&&(t.tpl[e]=u.customTemplates[e]);this.toolbar=this.createToolbar(i,u);this.editor=this.createEditor(u)},i,f,r;u.prototype={constructor:u,createEditor:function(t){t=t||{};t=n.extend(!0,{},t);t.toolbar=this.toolbar[0];this.initializeEditor(this.el[0],t)},initializeEditor:function(n,i){var r=new t.Editor(this.el[0],i),u;r.on("beforeload",this.syncBootstrapDialogEvents);r.on("beforeload",this.loadParserRules);if(r.composer.editableArea.contentDocument?this.addMoreShortcuts(r,r.composer.editableArea.contentDocument.body||r.composer.editableArea.contentDocument,i.shortcuts):this.addMoreShortcuts(r,r.composer.editableArea,i.shortcuts),i&&i.events)for(u in i.events)if(i.events.hasOwnProperty(u))r.on(u,i.events[u]);return r},loadParserRules:function(){n.type(this.config.parserRules)==="string"&&n.ajax({dataType:"json",url:this.config.parserRules,context:this,error:function(n,t,i){console.log(i)},success:function(n){this.config.parserRules=n;console.log("parserrules loaded")}});this.config.pasteParserRulesets&&n.type(this.config.pasteParserRulesets)==="string"&&n.ajax({dataType:"json",url:this.config.pasteParserRulesets,context:this,error:function(n,t,i){console.log(i)},success:function(n){this.config.pasteParserRulesets=n}})},syncBootstrapDialogEvents:function(){var t=this;n.map(this.toolbar.commandMapping,function(n){return[n]}).filter(function(n){return n.dialog}).map(function(n){return n.dialog}).forEach(function(i){i.on("show",function(){n(this.container).modal("show")});i.on("hide",function(){n(this.container).modal("hide");setTimeout(t.composer.focus,0)});n(i.container).on("shown.bs.modal",function(){n(this).find("input, select, textarea").first().focus()})});this.on("change_view",function(){n(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled")})},createToolbar:function(t,i){var h=this,u=n("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"}),o=i.locale||f.locale||"en",c,s;r.hasOwnProperty(o)||(console.debug("Locale '"+o+"' not found. Available locales are: "+Object.keys(r)+". Falling back to 'en'."),o="en");c=n.extend(!0,{},r.en,r[o]);for(s in i.toolbar)i.toolbar[s]&&u.append(e(s,c,i));return u.find('a[data-wysihtml5-command="formatBlock"]').click(function(t){var u=t.delegateTarget||t.target||t.srcElement,i=n(u),r=i.data("wysihtml5-display-format-name"),f=i.data("wysihtml5-format-name")||i.html();(r===undefined||r==="true")&&h.toolbar.find(".current-font").text(f)}),u.find('a[data-wysihtml5-command="foreColor"]').click(function(t){var i=t.target||t.srcElement,r=n(i);h.toolbar.find(".current-color").text(r.html())}),this.el.before(u),u},addMoreShortcuts:function(n,i,r){t.dom.observe(i,"keydown",function(i){var e=i.keyCode,u=r[e],f;(i.ctrlKey||i.metaKey||i.altKey)&&u&&t.commands[u]&&(f=n.toolbar.commandMapping[u+":null"],f&&f.dialog&&!f.state?f.dialog.show():t.commands[u].exec(n.composer,u),i.preventDefault())})}};i={resetDefaults:function(){n.fn.wysihtml5.defaultOptions=n.extend(!0,{},n.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(t){return this.each(function(){var i=n(this);i.data("wysihtml5",new u(i,t))})},shallowExtend:function(t){var r=n.extend({},n.fn.wysihtml5.defaultOptions,t||{},n(this).data()),u=this;return i.bypassDefaults.apply(u,[r])},deepExtend:function(t){var r=n.extend(!0,{},n.fn.wysihtml5.defaultOptions,t||{}),u=this;return i.bypassDefaults.apply(u,[r])},init:function(n){var t=this;return i.shallowExtend.apply(t,[n])}};n.fn.wysihtml5=function(t){if(i[t])return i[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on jQuery.wysihtml5");else return i.init.apply(this,arguments)};n.fn.wysihtml5.Constructor=u;f=n.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},useLineBreaks:!1,parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{"83":"small","75":"createLink"}};typeof n.fn.wysihtml5.defaultOptionsCache=="undefined"&&(n.fn.wysihtml5.defaultOptionsCache=n.extend(!0,{},n.fn.wysihtml5.defaultOptions));r=n.fn.wysihtml5.locale={}};i(n,t)}),function(n){n.commands.small={exec:function(t,i){return n.commands.formatInline.exec(t,i,"small")},state:function(t,i){return n.commands.formatInline.state(t,i,"small")}}}(wysihtml5),function(n){typeof define=="function"&&define.amd?define("bootstrap.wysihtml5.en-US",["jquery","bootstrap.wysihtml5"],n):n(jQuery)}(function(n){n.fn.wysihtml5.locale.en=n.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}});